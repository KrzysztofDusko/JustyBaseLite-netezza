"use strict";var Ut=Object.create;var Se=Object.defineProperty;var zt=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Ht=Object.getPrototypeOf,Wt=Object.prototype.hasOwnProperty;var te=(d,e)=>()=>(d&&(e=d(d=0)),e);var ot=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports),ne=(d,e)=>{for(var t in e)Se(d,t,{get:e[t],enumerable:!0})},it=(d,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of kt(e))!Wt.call(d,n)&&n!==t&&Se(d,n,{get:()=>e[n],enumerable:!(s=zt(e,n))||s.enumerable});return d};var U=(d,e,t)=>(t=d!=null?Ut(Ht(d)):{},it(e||!d||!d.__esModule?Se(t,"default",{value:d,enumerable:!0}):t,d)),qt=d=>it(Se({},"__esModule",{value:!0}),d);var Ae,de,We=te(()=>{"use strict";Ae=U(require("vscode")),de=class d{constructor(e){this.context=e;this._connections={};this._activeConnectionName=null;this._documentConnections=new Map;this._persistentConnections=new Map;this._keepConnectionOpen=!1;this._onDidChangeConnections=new Ae.EventEmitter;this.onDidChangeConnections=this._onDidChangeConnections.event;this._onDidChangeActiveConnection=new Ae.EventEmitter;this.onDidChangeActiveConnection=this._onDidChangeActiveConnection.event;this._onDidChangeDocumentConnection=new Ae.EventEmitter;this.onDidChangeDocumentConnection=this._onDidChangeDocumentConnection.event;this._loadingPromise=this.loadConnections()}static{this.SERVICE_NAME="netezza-vscode-connections"}static{this.ACTIVE_CONN_KEY="netezza-active-connection"}async loadConnections(){this._activeConnectionName=this.context.globalState.get(d.ACTIVE_CONN_KEY)||null;let e=await this.context.secrets.get(d.SERVICE_NAME);if(e)try{this._connections=JSON.parse(e)}catch(t){console.error("Failed to parse connections:",t),this._connections={}}else{let t=await this.context.secrets.get("netezza-vscode");if(t)try{let s=JSON.parse(t);if(s&&s.host){let n=`Default (${s.host})`;this._connections={[n]:{...s,name:n}},this._activeConnectionName=n,await this.saveConnectionsToStorage()}}catch{}}this._onDidChangeConnections.fire()}async ensureLoaded(){await this._loadingPromise}async saveConnectionsToStorage(){await this.context.secrets.store(d.SERVICE_NAME,JSON.stringify(this._connections)),this._activeConnectionName?await this.context.globalState.update(d.ACTIVE_CONN_KEY,this._activeConnectionName):await this.context.globalState.update(d.ACTIVE_CONN_KEY,void 0)}async saveConnection(e){if(await this.ensureLoaded(),!e.name)throw new Error("Connection name is required");this._connections[e.name]=e,this._activeConnectionName||await this.setActiveConnection(e.name),await this.saveConnectionsToStorage(),this._onDidChangeConnections.fire()}async deleteConnection(e){if(await this.ensureLoaded(),this._connections[e]){if(await this.closePersistentConnection(e),delete this._connections[e],this._activeConnectionName===e){let t=Object.keys(this._connections);await this.setActiveConnection(t.length>0?t[0]:null)}await this.saveConnectionsToStorage(),this._onDidChangeConnections.fire()}}async getConnections(){return await this.ensureLoaded(),Object.values(this._connections)}async getConnection(e){return await this.ensureLoaded(),this._connections[e]}async setActiveConnection(e){await this.ensureLoaded(),this._activeConnectionName=e,await this.context.globalState.update(d.ACTIVE_CONN_KEY,e),this._onDidChangeActiveConnection.fire(e)}getActiveConnectionName(){return this._activeConnectionName}async getConnectionString(e){await this.ensureLoaded();let t=e||this._activeConnectionName;if(!t)return null;let s=this._connections[t];return s?`DRIVER={NetezzaSQL};SERVER=${s.host};PORT=${s.port};DATABASE=${s.database};UID=${s.user};PWD=${s.password};`:(console.error(`[ConnectionManager] Connection '${t}' not found in registry. Available keys: ${Object.keys(this._connections).join(", ")}`),null)}async getCurrentDatabase(e){await this.ensureLoaded();let t=e||this._activeConnectionName;return t&&this._connections[t]?.database||null}setKeepConnectionOpen(e){this._keepConnectionOpen=e,e||this.closeAllPersistentConnections()}getKeepConnectionOpen(){return this._keepConnectionOpen}async getPersistentConnection(e){let t=e||this._activeConnectionName;if(!t)throw new Error("No connection selected");let s=await this.getConnectionString(t);if(!s)throw new Error(`Connection '${t}' not found or invalid`);let n=this._persistentConnections.get(t);return n||(n=await require("odbc").connect({connectionString:s,fetchArray:!0}),this._persistentConnections.set(t,n)),n}async closePersistentConnection(e){let t=this._persistentConnections.get(e);if(t){try{await t.close()}catch(s){console.error(`Error closing connection ${e}:`,s)}this._persistentConnections.delete(e)}}async closeAllPersistentConnections(){for(let e of this._persistentConnections.keys())await this.closePersistentConnection(e)}getDocumentConnection(e){return this._documentConnections.get(e)}setDocumentConnection(e,t){this._documentConnections.set(e,t),this._onDidChangeDocumentConnection.fire(e)}clearDocumentConnection(e){this._documentConnections.delete(e),this._onDidChangeDocumentConnection.fire(e)}getConnectionForExecution(e){if(e){let t=this._documentConnections.get(e);if(t)return t}return this._activeConnectionName||void 0}}});var rt={};ne(rt,{QueryHistoryManager:()=>j});var ue,Ie,j,Re=te(()=>{"use strict";ue=U(require("fs")),Ie=U(require("path")),j=class d{constructor(e){this.context=e;this.cache=[];this.initialized=!1;this.initialize()}static{this.STORAGE_KEY="queryHistory"}static{this.MAX_ENTRIES=5e4}static{this.CLEANUP_KEEP=4e4}static{this.STORAGE_VERSION=1}async initialize(){try{let e=this.context.globalState.get(d.STORAGE_KEY);e&&e.entries?(this.cache=e.entries,console.log(`\u2705 Loaded ${this.cache.length} entries from VS Code storage`)):await this.migrateFromLegacyStorage(),this.initialized=!0}catch(e){console.error("\u274C Error initializing query history:",e),this.cache=[],this.initialized=!0}}async migrateFromLegacyStorage(){try{let e=this.context.globalStorageUri.fsPath,t=Ie.join(e,"query-history.db");ue.existsSync(t)&&(console.log("\u26A0\uFE0F SQLite database found but migration not implemented"),console.log("\u{1F4A1} Consider manually exporting data before switching"));let s=Ie.join(e,"query-history.json");if(ue.existsSync(s)){let i=ue.readFileSync(s,"utf8");if(i.trim()){let a=JSON.parse(i);this.cache=a,await this.saveToStorage(),console.log(`\u2705 Migrated ${a.length} entries from JSON`)}}let n=Ie.join(e,"query-history-archive.json");if(ue.existsSync(n)){let i=ue.readFileSync(n,"utf8");if(i.trim()){let a=JSON.parse(i);this.cache.push(...a),await this.saveToStorage(),console.log(`\u2705 Migrated archive with ${a.length} entries`)}}}catch(e){console.error("Error during migration:",e)}}async saveToStorage(){try{let e={entries:this.cache,version:d.STORAGE_VERSION};await this.context.globalState.update(d.STORAGE_KEY,e)}catch(e){console.error("Error saving to storage:",e)}}async addEntry(e,t,s,n,i,a,o){try{this.initialized||await this.initialize();let r=`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,p=Date.now(),l={id:r,host:e,database:t,schema:s,query:n.trim(),timestamp:p,connectionName:i,is_favorite:!1,tags:a||"",description:o||""};this.cache.unshift(l),this.cache.length>d.MAX_ENTRIES&&(this.cache=this.cache.slice(0,d.CLEANUP_KEEP),console.log(`Cleaned up old entries, keeping ${d.CLEANUP_KEEP} newest`)),await this.saveToStorage()}catch(r){console.error("Error adding query to history:",r)}}async getHistory(){return this.initialized||await this.initialize(),[...this.cache]}async deleteEntry(e){try{this.cache=this.cache.filter(t=>t.id!==e),await this.saveToStorage()}catch(t){console.error("Error deleting entry:",t)}}async clearHistory(){try{this.cache=[],await this.saveToStorage(),console.log("All query history cleared")}catch(e){console.error("Error clearing history:",e)}}async getStats(){try{let e=this.cache.length,t=JSON.stringify(this.cache).length,s=parseFloat((t/(1024*1024)).toFixed(2));return{activeEntries:e,archivedEntries:0,totalEntries:e,activeFileSizeMB:s,archiveFileSizeMB:0,totalFileSizeMB:s}}catch(e){return console.error("Error getting stats:",e),{activeEntries:0,archivedEntries:0,totalEntries:0,activeFileSizeMB:0,archiveFileSizeMB:0,totalFileSizeMB:0}}}async toggleFavorite(e){try{let t=this.cache.find(s=>s.id===e);t&&(t.is_favorite=!t.is_favorite,await this.saveToStorage())}catch(t){console.error("Error toggling favorite:",t)}}async updateEntry(e,t,s){try{let n=this.cache.find(i=>i.id===e);n&&(t!==void 0&&(n.tags=t),s!==void 0&&(n.description=s),await this.saveToStorage())}catch(n){console.error("Error updating entry:",n)}}async getFavorites(){return this.initialized||await this.initialize(),this.cache.filter(e=>e.is_favorite)}async getByTag(e){return this.initialized||await this.initialize(),this.cache.filter(t=>t.tags?.toLowerCase().includes(e.toLowerCase()))}async getAllTags(){this.initialized||await this.initialize();let e=new Set;return this.cache.forEach(t=>{t.tags&&t.tags.split(",").forEach(n=>{let i=n.trim();i&&e.add(i)})}),Array.from(e).sort()}async searchAll(e){this.initialized||await this.initialize();let t=e.toLowerCase();return this.cache.filter(s=>s.query.toLowerCase().includes(t)||s.host.toLowerCase().includes(t)||s.database.toLowerCase().includes(t)||s.schema.toLowerCase().includes(t)||s.tags?.toLowerCase().includes(t)||s.description?.toLowerCase().includes(t))}async getFilteredHistory(e,t,s,n){this.initialized||await this.initialize();let i=this.cache.filter(a=>!(e&&a.host!==e||t&&a.database!==t||s&&a.schema!==s));return n&&(i=i.slice(0,n)),i}async getArchivedHistory(){return[]}async clearArchive(){}close(){console.log("Query history manager closed")}}});var xt={};ne(xt,{runQueriesSequentially:()=>Je,runQuery:()=>B,runQueryRaw:()=>pt});function at(d){let e=d.match(/SERVER=([^;]+)/i),t=d.match(/DATABASE=([^;]+)/i);return{host:e?e[1]:"unknown",database:t?t[1]:"unknown"}}function ct(d){let e=new Set;if(!d)return e;for(let t of d.matchAll(/\$\{([A-Za-z0-9_]+)\}/g))t[1]&&e.add(t[1]);return e}function lt(d){if(!d)return{sql:"",setValues:{}};let e=d.split(/\r?\n/),t=[],s={};for(let n of e){let i=n.match(/^\s*@SET\s+([A-Za-z0-9_]+)\s*=\s*(.+)$/i);if(i){let a=i[2].trim();a.endsWith(";")&&(a=a.slice(0,-1).trim());let o=a.match(/^'(.*)'$/s)||a.match(/^"(.*)"$/s);o&&(a=o[1]),s[i[1]]=a}else t.push(n)}return{sql:t.join(`
`),setValues:s}}async function dt(d,e,t){let s={};if(d.size===0)return s;if(e){let i=Array.from(d).filter(a=>!(t&&t[a]!==void 0));if(i.length>0)throw new Error("Query contains variables but silent mode is enabled; cannot prompt for values. Missing: "+i.join(", "));for(let a of d)s[a]=t[a];return s}let n=[];for(let i of d)t&&t[i]!==void 0?s[i]=t[i]:n.push(i);for(let i of n){let a=await De.window.showInputBox({prompt:`Enter value for ${i}`,placeHolder:"",value:t&&t[i]?t[i]:void 0,ignoreFocusOut:!0});if(a===void 0)throw new Error("Variable input cancelled by user");s[i]=a}return s}function ut(d,e){return d.replace(/\$\{([A-Za-z0-9_]+)\}/g,(t,s)=>e[s]??"")}async function pt(d,e,t=!1,s,n,i){if(!Ee)throw new Error("odbc package not installed. Please run: npm install odbc");let a=s||new de(d),o=a.getKeepConnectionOpen(),r;t||(r=De.window.createOutputChannel("Netezza SQL"),r.show(!0),r.appendLine("Executing query..."),n&&r.appendLine(`Target Connection: ${n}`));try{let p=lt(e),l=p.sql,h=p.setValues,x=ct(l);if(x.size>0){let R=await dt(x,t,h);l=ut(l,R)}let m,v=!0,b,E=n;if(!E&&i&&(E=a.getConnectionForExecution(i)),E||(E=a.getActiveConnectionName()||void 0),o){m=await a.getPersistentConnection(E),v=!1;let R=await a.getConnectionString(E);if(!R)throw new Error("Connection not configured. Please connect via Netezza: Connect...");b=R}else{let R=await a.getConnectionString(E);if(!R)throw new Error("Connection not configured. Please connect via Netezza: Connect...");b=R,m=await Ee.connect({connectionString:b,fetchArray:!0})}try{let R=await ht(m,l,2e5),N="unknown";try{let M=await m.query("SELECT CURRENT_SCHEMA");M&&M.length>0&&(Array.isArray(M[0])?N=M[0][0]||"unknown":N=M[0].CURRENT_SCHEMA||"unknown")}catch(M){console.debug("Could not retrieve current schema:",M)}let O=at(b);if(new j(d).addEntry(O.host,O.database,N,e,E).catch(M=>{console.error("Failed to log query to history:",M)}),R&&Array.isArray(R)){let M=R.columns?R.columns.map(F=>({name:F.name,type:F.dataType})):[];return r&&r.appendLine("Query completed."),{columns:M,data:R,rowsAffected:R.count,limitReached:R.limitReached,sql:l}}else return r&&r.appendLine("Query executed successfully (no results)."),{columns:[],data:[],rowsAffected:R?.count,message:"Query executed successfully (no results).",sql:l}}finally{v&&await m.close()}}catch(p){let l=qe(p);throw r&&r.appendLine(l),new Error(l)}}async function B(d,e,t=!1,s,n,i){try{let a=await pt(d,e,t,n,s,i);if(a.data&&a.data.length>0){let o=a.data.map(p=>{let l={};return a.columns.forEach((h,x)=>{l[h.name]=p[x]}),l});return JSON.stringify(o,(p,l)=>typeof l=="bigint"?l>=Number.MIN_SAFE_INTEGER&&l<=Number.MAX_SAFE_INTEGER?Number(l):l.toString():l,2)}else if(a.message)return a.message;return}catch(a){throw a}}async function Je(d,e,t,s){if(!Ee)throw new Error("odbc package not installed. Please run: npm install odbc");let n=t||new de(d),i=n.getKeepConnectionOpen(),a=De.window.createOutputChannel("Netezza SQL");a.show(!0),a.appendLine(`Executing ${e.length} queries sequentially...`);let o=[],r=t?t.getConnectionForExecution(s):void 0;r||(r=n.getActiveConnectionName()||void 0);try{let p,l=!0,h;if(i){p=await n.getPersistentConnection(r),l=!1;let x=await n.getConnectionString(r);if(!x)throw new Error("Connection not configured. Please connect via Netezza: Connect...");h=x}else{let x=await n.getConnectionString(r);if(!x)throw new Error("Connection not configured. Please connect via Netezza: Connect...");h=x,p=await Ee.connect({connectionString:h,fetchArray:!0})}try{let x="unknown";try{let E=await p.query("SELECT CURRENT_SCHEMA");E&&E.length>0&&(Array.isArray(E[0])?x=E[0][0]||"unknown":x=E[0].CURRENT_SCHEMA||"unknown")}catch(E){console.debug("Could not retrieve current schema:",E)}let m=at(h),v=new j(d),b=r;for(let E=0;E<e.length;E++){let R=e[E];a.appendLine(`Executing query ${E+1}/${e.length}...`);try{let N=lt(R),O=N.sql,$=N.setValues,M=ct(O);if(M.size>0){let X=await dt(M,!1,$);O=ut(O,X)}let F=await ht(p,O,2e5);if(v.addEntry(m.host,m.database,x,R,b).catch(X=>{console.error("Failed to log query to history:",X)}),F&&Array.isArray(F)){let X=F.columns?F.columns.map(Q=>({name:Q.name,type:Q.dataType})):[];o.push({columns:X,data:F,rowsAffected:F.count,limitReached:F.limitReached,sql:O})}else o.push({columns:[],data:[],rowsAffected:F?.count,message:"Query executed successfully",sql:O})}catch(N){let O=qe(N);throw a.appendLine(`Error in query ${E+1}: ${O}`),new Error(O)}}a.appendLine("All queries completed.")}finally{l&&await p.close()}}catch(p){let l=qe(p);throw a.appendLine(l),new Error(l)}return o}function qe(d){return d.odbcErrors&&Array.isArray(d.odbcErrors)&&d.odbcErrors.length>0?d.odbcErrors.map(e=>`[ODBC Error] State: ${e.state}, Native Code: ${e.code}
Message: ${e.message}`).join(`

`):`Error: ${d.message||d}`}async function ht(d,e,t){let s=await d.createStatement();try{await s.prepare(e);let n=await s.execute({cursor:!0,fetchSize:5e3}),i=[],a=0,o=await n.fetch(),r=o?o.columns:void 0,p=o.count;for(;o&&o.length>0;){!r&&o.columns&&(r=o.columns);for(let l of o)if(i.push(l),a++,a>=t){i.limitReached=!0;break}if(a>=t){i.limitReached=!0;break}o=await n.fetch()}return await n.close(),r&&(i.columns=r),i.count=p,i}catch(n){throw n}finally{await s.close()}}var De,Ee,xe=te(()=>{"use strict";De=U(require("vscode"));We();Re();try{Ee=require("odbc")}catch{console.error("odbc package not installed. Run: npm install odbc")}});var Ve={};ne(Ve,{SchemaItem:()=>ee,SchemaProvider:()=>ye});var _,ye,ee,Me=te(()=>{"use strict";_=U(require("vscode"));xe();ye=class{constructor(e,t,s){this.context=e;this.connectionManager=t;this.metadataCache=s;this._onDidChangeTreeData=new _.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.connectionManager.onDidChangeConnections(()=>this.refresh())}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getParent(e){if(e.contextValue!=="serverInstance"){if(e.contextValue==="database")return new ee(e.connectionName,_.TreeItemCollapsibleState.Collapsed,"serverInstance",void 0,void 0,void 0,void 0,void 0,e.connectionName);if(e.contextValue==="typeGroup")return new ee(e.dbName,_.TreeItemCollapsibleState.Collapsed,"database",e.dbName,void 0,void 0,void 0,void 0,e.connectionName);if(e.contextValue.startsWith("netezza:"))return new ee(e.objType,_.TreeItemCollapsibleState.Collapsed,"typeGroup",e.dbName,e.objType,void 0,void 0,void 0,e.connectionName)}}async getChildren(e){if(e){if(e.contextValue==="serverInstance")try{if(!e.connectionName)return[];let t=await B(this.context,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0,e.connectionName,this.connectionManager);return t?JSON.parse(t).map(n=>new ee(n.DATABASE,_.TreeItemCollapsibleState.Collapsed,"database",n.DATABASE,void 0,void 0,void 0,void 0,e.connectionName)):[]}catch(t){return _.window.showErrorMessage(`Failed to load databases for ${e.connectionName}: ${t}`),[]}else if(e.contextValue==="database")try{let t=`SELECT DISTINCT OBJTYPE FROM ${e.dbName}.._V_OBJECT_DATA WHERE DBNAME = '${e.dbName}' ORDER BY OBJTYPE`,s=await B(this.context,t,!0,e.connectionName,this.connectionManager);return JSON.parse(s||"[]").map(i=>new ee(i.OBJTYPE,_.TreeItemCollapsibleState.Collapsed,"typeGroup",e.dbName,i.OBJTYPE,void 0,void 0,void 0,e.connectionName))}catch(t){return _.window.showErrorMessage("Failed to load object types: "+t),[]}else if(e.contextValue==="typeGroup")try{let t=`SELECT OBJNAME, SCHEMA, OBJID, COALESCE(DESCRIPTION, '') AS DESCRIPTION FROM ${e.dbName}.._V_OBJECT_DATA WHERE DBNAME = '${e.dbName}' AND OBJTYPE = '${e.objType}' ORDER BY OBJNAME`,s=await B(this.context,t,!0,e.connectionName,this.connectionManager);return JSON.parse(s||"[]").map(i=>{let o=["TABLE","VIEW","EXTERNAL TABLE","SYSTEM VIEW","SYSTEM TABLE"].includes(e.objType||"");return new ee(i.OBJNAME,o?_.TreeItemCollapsibleState.Collapsed:_.TreeItemCollapsibleState.None,`netezza:${e.objType}`,e.dbName,e.objType,i.SCHEMA,i.OBJID,i.DESCRIPTION,e.connectionName)})}catch(t){return _.window.showErrorMessage("Failed to load objects: "+t),[]}else if(e.contextValue.startsWith("netezza:")&&e.objId)try{let t=`SELECT 
                        X.ATTNAME
                        , X.FORMAT_TYPE
                        , X.ATTNOTNULL::BOOL AS ATTNOTNULL
                        , X.COLDEFAULT
                        , COALESCE(X.DESCRIPTION, '') AS DESCRIPTION
                    FROM
                        ${e.dbName}.._V_RELATION_COLUMN X
                    WHERE
                        X.OBJID = ${e.objId}
                    ORDER BY 
                        X.ATTNUM`,s=await B(this.context,t,!0,e.connectionName,this.connectionManager);return JSON.parse(s||"[]").map(i=>new ee(`${i.ATTNAME} (${i.FORMAT_TYPE})`,_.TreeItemCollapsibleState.None,"column",e.dbName,void 0,void 0,void 0,i.DESCRIPTION,e.connectionName))}catch(t){return _.window.showErrorMessage("Failed to load columns: "+t),[]}}else return(await this.connectionManager.getConnections()).map(s=>new ee(s.name,_.TreeItemCollapsibleState.Collapsed,"serverInstance",void 0,void 0,void 0,void 0,void 0,s.name));return[]}},ee=class extends _.TreeItem{constructor(t,s,n,i,a,o,r,p,l){super(t,s);this.label=t;this.collapsibleState=s;this.contextValue=n;this.dbName=i;this.objType=a;this.schema=o;this.objId=r;this.objectDescription=p;this.connectionName=l;let h=this.label;l&&(h+=`
[Server: ${l}]`),p&&p.trim()&&(h+=`

${p.trim()}`),o&&n.startsWith("netezza:")&&(h+=`

Schema: ${o}`),this.tooltip=h,this.description=o?`(${o})`:"",n==="serverInstance"?this.iconPath=new _.ThemeIcon("server"):n==="database"?this.iconPath=new _.ThemeIcon("database"):n==="typeGroup"?this.iconPath=new _.ThemeIcon("folder"):n.startsWith("netezza:")?this.iconPath=this.getIconForType(a):n==="column"&&(this.iconPath=new _.ThemeIcon("symbol-field"))}getIconForType(t){switch(t){case"TABLE":return new _.ThemeIcon("table");case"VIEW":return new _.ThemeIcon("eye");case"PROCEDURE":return new _.ThemeIcon("gear");case"FUNCTION":return new _.ThemeIcon("symbol-function");case"AGGREGATE":return new _.ThemeIcon("symbol-operator");case"EXTERNAL TABLE":return new _.ThemeIcon("server");default:return new _.ThemeIcon("file")}}}});var ft={};ne(ft,{generateDDL:()=>tn});function k(d){return!d||/^[A-Z_][A-Z0-9_]*$/i.test(d)&&d===d.toUpperCase()?d:`"${d.replace(/"/g,'""')}"`}async function gt(d,e,t,s){let n=`
        SELECT 
            X.OBJID::INT AS OBJID
            , X.ATTNAME
            , X.DESCRIPTION
            , X.FORMAT_TYPE AS FULL_TYPE
            , X.ATTNOTNULL::BOOL AS ATTNOTNULL
            , X.COLDEFAULT
        FROM
            ${e.toUpperCase()}.._V_RELATION_COLUMN X
        INNER JOIN
            ${e.toUpperCase()}.._V_OBJECT_DATA D ON X.OBJID = D.OBJID
        WHERE
            X.TYPE IN ('TABLE','VIEW','EXTERNAL TABLE', 'SEQUENCE','SYSTEM VIEW','SYSTEM TABLE')
            AND X.OBJID NOT IN (4,5)
            AND D.SCHEMA = '${t.toUpperCase()}'
            AND D.OBJNAME = '${s.toUpperCase()}'
        ORDER BY 
            X.OBJID, X.ATTNUM
    `,i=await d.query(n),a=[];for(let o of i)a.push({name:o.ATTNAME,description:o.DESCRIPTION||null,fullTypeName:o.FULL_TYPE,notNull:!!o.ATTNOTNULL,defaultValue:o.COLDEFAULT||null});return a}async function Vt(d,e,t,s){try{let n=`
            SELECT ATTNAME
            FROM ${e.toUpperCase()}.._V_TABLE_DIST_MAP
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND TABLENAME = '${s.toUpperCase()}'
            ORDER BY DISTSEQNO
        `;return(await d.query(n)).map(a=>a.ATTNAME)}catch{return[]}}async function Xt(d,e,t,s){try{let n=`
            SELECT ATTNAME
            FROM ${e.toUpperCase()}.._V_TABLE_ORGANIZE_COLUMN
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND TABLENAME = '${s.toUpperCase()}'
            ORDER BY ORGSEQNO
        `;return(await d.query(n)).map(a=>a.ATTNAME)}catch{return[]}}async function Yt(d,e,t,s){let n=`
        SELECT 
            X.SCHEMA
            , X.RELATION
            , X.CONSTRAINTNAME
            , X.CONTYPE
            , X.ATTNAME
            , X.PKDATABASE
            , X.PKSCHEMA
            , X.PKRELATION
            , X.PKATTNAME
            , X.UPDT_TYPE
            , X.DEL_TYPE
        FROM 
            ${e.toUpperCase()}.._V_RELATION_KEYDATA X
        WHERE 
            X.OBJID NOT IN (4,5)
            AND X.SCHEMA = '${t.toUpperCase()}'
            AND X.RELATION = '${s.toUpperCase()}'
        ORDER BY
            X.SCHEMA, X.RELATION, X.CONSEQ
    `,i=new Map;try{let a=await d.query(n);for(let o of a){let r=o.CONSTRAINTNAME;if(!i.has(r)){let l={p:"PRIMARY KEY",f:"FOREIGN KEY",u:"UNIQUE"};i.set(r,{type:l[o.CONTYPE]||"UNKNOWN",typeChar:o.CONTYPE,columns:[],pkDatabase:o.PKDATABASE||null,pkSchema:o.PKSCHEMA||null,pkRelation:o.PKRELATION||null,pkColumns:[],updateType:o.UPDT_TYPE||"NO ACTION",deleteType:o.DEL_TYPE||"NO ACTION"})}let p=i.get(r);p.columns.push(o.ATTNAME),o.PKATTNAME&&p.pkColumns.push(o.PKATTNAME)}}catch(a){console.warn("Cannot retrieve keys info:",a)}return i}async function jt(d,e,t,s){try{let n=`
            SELECT DESCRIPTION
            FROM ${e.toUpperCase()}.._V_OBJECT_DATA
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND OBJNAME = '${s.toUpperCase()}'
                AND OBJTYPE = 'TABLE'
        `,i=await d.query(n);if(i.length>0&&i[0].DESCRIPTION)return i[0].DESCRIPTION}catch{try{let n=`
                SELECT DESCRIPTION
                FROM ${e.toUpperCase()}.._V_OBJECT_DATA
                WHERE SCHEMA = '${t.toUpperCase()}'
                    AND OBJNAME = '${s.toUpperCase()}'
            `,i=await d.query(n);if(i.length>0&&i[0].DESCRIPTION)return i[0].DESCRIPTION}catch{}}return null}async function Qt(d,e,t,s){let n=await gt(d,e,t,s);if(n.length===0)throw new Error(`Table ${e}.${t}.${s} not found or has no columns`);let i=await Vt(d,e,t,s),a=await Xt(d,e,t,s),o=await Yt(d,e,t,s),r=await jt(d,e,t,s),p=k(e),l=k(t),h=k(s),x=[];x.push(`CREATE TABLE ${p}.${l}.${h}`),x.push("(");let m=[];for(let v of n){let E=`    ${k(v.name)} ${v.fullTypeName}`;v.notNull&&(E+=" NOT NULL"),v.defaultValue!==null&&(E+=` DEFAULT ${v.defaultValue}`),m.push(E)}if(x.push(m.join(`,
`)),i.length>0){let v=i.map(b=>k(b));x.push(`)
DISTRIBUTE ON (${v.join(", ")})`)}else x.push(`)
DISTRIBUTE ON RANDOM`);if(a.length>0){let v=a.map(b=>k(b));x.push(`ORGANIZE ON (${v.join(", ")})`)}x.push(";"),x.push("");for(let[v,b]of o){let E=k(v),R=b.columns.map(N=>k(N));if(b.typeChar==="f"){let N=b.pkColumns.filter(O=>O).map(O=>k(O));N.length>0&&x.push(`ALTER TABLE ${p}.${l}.${h} ADD CONSTRAINT ${E} ${b.type} (${R.join(", ")}) REFERENCES ${b.pkDatabase}.${b.pkSchema}.${b.pkRelation} (${N.join(", ")}) ON DELETE ${b.deleteType} ON UPDATE ${b.updateType};`)}else(b.typeChar==="p"||b.typeChar==="u")&&x.push(`ALTER TABLE ${p}.${l}.${h} ADD CONSTRAINT ${E} ${b.type} (${R.join(", ")});`)}if(r){let v=r.replace(/'/g,"''");x.push(""),x.push(`COMMENT ON TABLE ${p}.${l}.${h} IS '${v}';`)}for(let v of n)if(v.description){let b=k(v.name),E=v.description.replace(/'/g,"''");x.push(`COMMENT ON COLUMN ${p}.${l}.${h}.${b} IS '${E}';`)}return x.join(`
`)}async function Gt(d,e,t,s){let n=`
        SELECT 
            SCHEMA,
            VIEWNAME,
            DEFINITION,
            OBJID::INT
        FROM ${e.toUpperCase()}.._V_VIEW
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND VIEWNAME = '${s.toUpperCase()}'
    `,a=await d.query(n);if(a.length===0)throw new Error(`View ${e}.${t}.${s} not found`);let o=a[0],r=k(e),p=k(t),l=k(s),h=[];return h.push(`CREATE OR REPLACE VIEW ${r}.${p}.${l} AS`),h.push(o.DEFINITION||""),h.join(`
`)}async function Kt(d,e,t,s){let n=`
        SELECT 
            SCHEMA,
            PROCEDURESOURCE,
            OBJID::INT,
            RETURNS,
            EXECUTEDASOWNER,
            DESCRIPTION,
            PROCEDURESIGNATURE,
            ARGUMENTS,
            NULL AS LANGUAGE
        FROM ${e.toUpperCase()}.._V_PROCEDURE
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND PROCEDURE = '${s.toUpperCase()}'
        ORDER BY 1, 2, 3
    `,a=await d.query(n);if(a.length===0)throw new Error(`Procedure ${e}.${t}.${s} not found`);let o=a[0],r={schema:o.SCHEMA,procedureSource:o.PROCEDURESOURCE,objId:o.OBJID,returns:o.RETURNS,executeAsOwner:!!o.EXECUTEDASOWNER,description:o.DESCRIPTION||null,procedureSignature:o.PROCEDURESIGNATURE,arguments:o.ARGUMENTS||null},p=k(e),l=k(t),h=k(s),x=[];if(x.push(`CREATE OR REPLACE PROCEDURE ${p}.${l}.${h}`),x.push(`RETURNS ${r.returns}`),r.executeAsOwner?x.push("EXECUTE AS OWNER"):x.push("EXECUTE AS CALLER"),x.push("LANGUAGE NZPLSQL AS"),x.push("BEGIN_PROC"),x.push(r.procedureSource),x.push("END_PROC;"),r.description){let m=r.description.replace(/'/g,"''");x.push(`COMMENT ON PROCEDURE ${h} IS '${m}';`)}return x.join(`
`)}async function Zt(d,e,t,s){let n=`
        SELECT 
            E1.SCHEMA,
            E1.TABLENAME,
            E2.EXTOBJNAME,
            E2.OBJID::INT,
            E1.DELIM,
            E1.ENCODING,
            E1.TIMESTYLE,
            E1.REMOTESOURCE,
            E1.SKIPROWS,
            E1.MAXERRORS,
            E1.ESCAPE,
            E1.LOGDIR,
            E1.DECIMALDELIM,
            E1.QUOTEDVALUE,
            E1.NULLVALUE,
            E1.CRINSTRING,
            E1.TRUNCSTRING,
            E1.CTRLCHARS,
            E1.IGNOREZERO,
            E1.TIMEEXTRAZEROS,
            E1.Y2BASE,
            E1.FILLRECORD,
            E1.COMPRESS,
            E1.INCLUDEHEADER,
            E1.LFINSTRING,
            E1.DATESTYLE,
            E1.DATEDELIM,
            E1.TIMEDELIM,
            E1.BOOLSTYLE,
            E1.FORMAT,
            E1.SOCKETBUFSIZE,
            E1.RECORDDELIM,
            E1.MAXROWS,
            E1.REQUIREQUOTES,
            E1.RECORDLENGTH,
            E1.DATETIMEDELIM,
            E1.REJECTFILE
        FROM 
            ${e.toUpperCase()}.._V_EXTERNAL E1
            JOIN ${e.toUpperCase()}.._V_EXTOBJECT E2 ON E1.DATABASE = E2.DATABASE
                AND E1.SCHEMA = E2.SCHEMA
                AND E1.TABLENAME = E2.TABLENAME
        WHERE 
            E1.DATABASE = '${e.toUpperCase()}'
            AND E1.SCHEMA = '${t.toUpperCase()}'
            AND E1.TABLENAME = '${s.toUpperCase()}'
    `,a=await d.query(n);if(a.length===0)throw new Error(`External table ${e}.${t}.${s} not found`);let o=a[0],r={schema:o.SCHEMA,tableName:o.TABLENAME,dataObject:o.EXTOBJNAME||null,delimiter:o.DELIM||null,encoding:o.ENCODING||null,timeStyle:o.TIMESTYLE||null,remoteSource:o.REMOTESOURCE||null,skipRows:o.SKIPROWS||null,maxErrors:o.MAXERRORS||null,escapeChar:o.ESCAPE||null,logDir:o.LOGDIR||null,decimalDelim:o.DECIMALDELIM||null,quotedValue:o.QUOTEDVALUE||null,nullValue:o.NULLVALUE||null,crInString:o.CRINSTRING??null,truncString:o.TRUNCSTRING??null,ctrlChars:o.CTRLCHARS??null,ignoreZero:o.IGNOREZERO??null,timeExtraZeros:o.TIMEEXTRAZEROS??null,y2Base:o.Y2BASE||null,fillRecord:o.FILLRECORD??null,compress:o.COMPRESS||null,includeHeader:o.INCLUDEHEADER??null,lfInString:o.LFINSTRING??null,dateStyle:o.DATESTYLE||null,dateDelim:o.DATEDELIM||null,timeDelim:o.TIMEDELIM||null,boolStyle:o.BOOLSTYLE||null,format:o.FORMAT||null,socketBufSize:o.SOCKETBUFSIZE||null,recordDelim:o.RECORDDELIM?String(o.RECORDDELIM).replace(/\r/g,"\\r").replace(/\n/g,"\\n"):null,maxRows:o.MAXROWS||null,requireQuotes:o.REQUIREQUOTES??null,recordLength:o.RECORDLENGTH||null,dateTimeDelim:o.DATETIMEDELIM||null,rejectFile:o.REJECTFILE||null},p=await gt(d,e,t,s),l=k(e),h=k(t),x=k(s),m=[];m.push(`CREATE EXTERNAL TABLE ${l}.${h}.${x}`),m.push("(");let v=p.map(b=>{let E=`    ${k(b.name)} ${b.fullTypeName}`;return b.notNull&&(E+=" NOT NULL"),E});return m.push(v.join(`,
`)),m.push(")"),m.push("USING"),m.push("("),r.dataObject!==null&&m.push(`    DATAOBJECT('${r.dataObject}')`),r.delimiter!==null&&m.push(`    DELIMITER '${r.delimiter}'`),r.encoding!==null&&m.push(`    ENCODING '${r.encoding}'`),r.timeStyle!==null&&m.push(`    TIMESTYLE '${r.timeStyle}'`),r.remoteSource!==null&&m.push(`    REMOTESOURCE '${r.remoteSource}'`),r.maxErrors!==null&&m.push(`    MAXERRORS ${r.maxErrors}`),r.escapeChar!==null&&m.push(`    ESCAPECHAR '${r.escapeChar}'`),r.decimalDelim!==null&&m.push(`    DECIMALDELIM '${r.decimalDelim}'`),r.logDir!==null&&m.push(`    LOGDIR '${r.logDir}'`),r.quotedValue!==null&&m.push(`    QUOTEDVALUE '${r.quotedValue}'`),r.nullValue!==null&&m.push(`    NULLVALUE '${r.nullValue}'`),r.crInString!==null&&m.push(`    CRINSTRING ${r.crInString}`),r.truncString!==null&&m.push(`    TRUNCSTRING ${r.truncString}`),r.ctrlChars!==null&&m.push(`    CTRLCHARS ${r.ctrlChars}`),r.ignoreZero!==null&&m.push(`    IGNOREZERO ${r.ignoreZero}`),r.timeExtraZeros!==null&&m.push(`    TIMEEXTRAZEROS ${r.timeExtraZeros}`),r.y2Base!==null&&m.push(`    Y2BASE ${r.y2Base}`),r.fillRecord!==null&&m.push(`    FILLRECORD ${r.fillRecord}`),r.compress!==null&&m.push(`    COMPRESS ${r.compress}`),r.includeHeader!==null&&m.push(`    INCLUDEHEADER ${r.includeHeader}`),r.lfInString!==null&&m.push(`    LFINSTRING ${r.lfInString}`),r.dateStyle!==null&&m.push(`    DATESTYLE '${r.dateStyle}'`),r.dateDelim!==null&&m.push(`    DATEDELIM '${r.dateDelim}'`),r.timeDelim!==null&&m.push(`    TIMEDELIM '${r.timeDelim}'`),r.boolStyle!==null&&m.push(`    BOOLSTYLE '${r.boolStyle}'`),r.format!==null&&m.push(`    FORMAT '${r.format}'`),r.socketBufSize!==null&&m.push(`    SOCKETBUFSIZE ${r.socketBufSize}`),r.recordDelim!==null&&m.push(`    RECORDDELIM '${r.recordDelim}'`),r.maxRows!==null&&m.push(`    MAXROWS ${r.maxRows}`),r.requireQuotes!==null&&m.push(`    REQUIREQUOTES ${r.requireQuotes}`),r.recordLength!==null&&m.push(`    RECORDLENGTH ${r.recordLength}`),r.dateTimeDelim!==null&&m.push(`    DATETIMEDELIM '${r.dateTimeDelim}'`),r.rejectFile!==null&&m.push(`    REJECTFILE '${r.rejectFile}'`),m.push(");"),m.join(`
`)}async function en(d,e,t,s){let n=`
        SELECT 
            SCHEMA,
            OWNER,
            SYNONYM_NAME,
            REFOBJNAME,
            DESCRIPTION
        FROM ${e.toUpperCase()}.._V_SYNONYM
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND SYNONYM_NAME = '${s.toUpperCase()}'
    `,a=await d.query(n);if(a.length===0)throw new Error(`Synonym ${e}.${t}.${s} not found`);let o=a[0],r=k(e),p=k(o.OWNER||t),l=k(s),h=o.REFOBJNAME,x=[];if(x.push(`CREATE SYNONYM ${r}.${p}.${l} FOR ${h};`),o.DESCRIPTION){let m=o.DESCRIPTION.replace(/'/g,"''");x.push(`COMMENT ON SYNONYM ${l} IS '${m}';`)}return x.join(`
`)}async function tn(d,e,t,s,n){let i=null;try{i=await mt.connect(d);let a=n.toUpperCase();return a==="TABLE"?{success:!0,ddlCode:await Qt(i,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:a==="VIEW"?{success:!0,ddlCode:await Gt(i,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:a==="PROCEDURE"?{success:!0,ddlCode:await Kt(i,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:a==="EXTERNAL TABLE"?{success:!0,ddlCode:await Zt(i,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:a==="SYNONYM"?{success:!0,ddlCode:await en(i,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:{success:!0,ddlCode:`-- DDL generation for ${n} not yet implemented
-- Object: ${e}.${t}.${s}
-- Type: ${n}
--
-- This feature can be extended to support:
-- - FUNCTION: Query _V_FUNCTION system table
-- - AGGREGATE: Query _V_AGGREGATE system table
`,objectInfo:{database:e,schema:t,objectName:s,objectType:n},note:`${n} DDL generation not yet implemented`}}catch(a){return{success:!1,error:`DDL generation error: ${a.message||a}`}}finally{if(i)try{await i.close()}catch{}}}var mt,wt=te(()=>{"use strict";mt=U(require("odbc"))});var yt=ot((Fn,Et)=>{"use strict";var{Buffer:ge}=require("buffer"),Xe=class{constructor(e=65536){this.chunkSize=e,this.chunks=[],this.currentBuffer=ge.alloc(e),this.cursor=0}_ensureCapacity(e){this.cursor+e>this.chunkSize&&this._flush()}_flush(){this.cursor>0&&(this.chunks.push(this.currentBuffer.subarray(0,this.cursor)),this.currentBuffer=ge.alloc(this.chunkSize),this.cursor=0)}write(e){let t=e.length,s=0;for(;t>0;){let n=this.chunkSize-this.cursor;n===0&&(this._flush(),n=this.chunkSize);let i=Math.min(t,n);e.copy(this.currentBuffer,this.cursor,s,s+i),this.cursor+=i,s+=i,t-=i}}writeByte(e){this._ensureCapacity(1),this.currentBuffer[this.cursor]=e,this.cursor++}writeInt32LE(e){this._ensureCapacity(4),this.currentBuffer.writeInt32LE(e,this.cursor),this.cursor+=4}writeDoubleLE(e){this._ensureCapacity(8),this.currentBuffer.writeDoubleLE(e,this.cursor),this.cursor+=8}writeString(e){let t=ge.byteLength(e,"utf8");if(this.cursor+t<=this.chunkSize){this.cursor+=this.currentBuffer.write(e,this.cursor,"utf8");return}this._flush(),t>this.chunkSize?this.chunks.push(ge.from(e,"utf8")):this.cursor+=this.currentBuffer.write(e,this.cursor,"utf8")}writeUtf16LE(e){let t=e.length*2;if(this.cursor+t<=this.chunkSize){for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);this.currentBuffer[this.cursor++]=n&255,this.currentBuffer[this.cursor++]=n>>8&255}return}if(this._flush(),t>this.chunkSize)this.chunks.push(ge.from(e,"utf16le"));else for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);this.currentBuffer[this.cursor++]=n&255,this.currentBuffer[this.cursor++]=n>>8&255}}getChunks(){return this.cursor>0&&(this.chunks.push(this.currentBuffer.subarray(0,this.cursor)),this.currentBuffer=ge.alloc(this.chunkSize),this.cursor=0),this.chunks}reset(){this.chunks=[],this.cursor=0}};Et.exports=Xe});var Tt=ot((Un,bt)=>{"use strict";var nn=require("fs"),sn=require("archiver"),{Readable:vt}=require("stream"),Ct=yt(),on=/[\\\/*?\[\]:]/g,Ye=class{constructor(e){this.filePath=e,this.output=nn.createWriteStream(e),this.archive=sn("zip"),this.archive.pipe(this.output),this.sheetCount=0,this.sheetList=[],this.sstDic=new Map,this.sstCntUnique=0,this.sstCntAll=0,this.colWidths=[],this._autofilterIsOn=!1,this._oaEpoch=new Date(1899,11,30).getTime(),this._sheet1Bytes=Buffer.from([129,1,0,147,1,23,203,4,2,0,64,0,0,0,0,0,0,255,255,255,255,255,255,255,255,0,0,0,0,148,1,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,1,0,137,1,30,220,3,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,100,0,0,0,0,0,0,0,0,0,0,0,152,1,36,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,1,0,134,1,0,37,6,1,0,2,14,0,128,149,8,2,5,0,38,0,229,3,12,255,255,255,255,8,0,44,1,0,0,0,0,145,1,0,37,6,1,0,2,14,0,128,128,8,2,5,0,38,0,0,25,0,0,0,0,0,0,0,0,44,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,7,12,0,0,0,0,0,0,0,0,0,0,0,0,146,1,0,151,4,66,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,221,3,2,16,0,220,3,48,102,102,102,102,102,102,230,63,102,102,102,102,102,102,230,63,0,0,0,0,0,0,232,63,0,0,0,0,0,0,232,63,51,51,51,51,51,51,211,63,51,51,51,51,51,51,211,63,37,6,1,0,0,16,0,128,128,24,16,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,38,0,130,1,0]),this._workbookBinStart=Buffer.from([131,1,0,128,1,50,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,120,0,108,0,1,0,0,0,55,0,1,0,0,0,54,0,5,0,0,0,50,0,52,0,51,0,50,0,54,0,153,1,12,32,0,1,0,0,0,0,0,0,0,0,0,37,6,1,0,3,15,0,128,151,16,52,24,0,0,0,67,0,58,0,92,0,115,0,113,0,108,0,115,0,92,0,84,0,101,0,115,0,116,0,121,0,90,0,97,0,112,0,105,0,115,0,117,0,88,0,108,0,115,0,98,0,92,0,38,0,37,6,1,0,0,16,0,128,129,24,130,1,0,0,0,0,0,0,0,0,47,0,0,0,49,0,51,0,95,0,110,0,99,0,114,0,58,0,49,0,95,0,123,0,49,0,54,0,53,0,48,0,56,0,68,0,54,0,57,0,45,0,67,0,70,0,56,0,55,0,45,0,52,0,55,0,54,0,57,0,45,0,56,0,52,0,53,0,54,0,45,0,68,0,52,0,65,0,52,0,48,0,49,0,49,0,51,0,49,0,53,0,54,0,55,0,125,0,47,0,0,0,47,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,135,1,0,37,6,1,0,2,16,0,128,128,24,16,0,0,0,0,13,0,0,0,255,255,255,255,0,0,0,0,38,0,158,1,29,0,0,0,0,158,22,0,0,180,105,0,0,232,38,0,0,88,2,0,0,0,0,0,0,0,0,0,0,120,136,1,0,143,1,0]),this._workbookBinMiddle=Buffer.from([144,1,0]),this._workbookBinEnd=Buffer.from([157,1,26,53,234,2,0,1,0,0,0,100,0,0,0,252,169,241,210,77,98,80,63,1,0,0,0,106,0,155,1,1,0,35,4,3,15,0,0,171,16,1,1,36,0,132,1,0]),this._stylesBin=Buffer.from([150,2,0,231,4,4,2,0,0,0,44,44,164,0,19,0,0,0,121,0,121,0,121,0,121,0,92,0,45,0,109,0,109,0,92,0,45,0,100,0,100,0,92,0,32,0,104,0,104,0,58,0,109,0,109,0,44,30,166,0,12,0,0,0,121,0,121,0,121,0,121,0,92,0,45,0,109,0,109,0,92,0,45,0,100,0,100,0,232,4,0,227,4,4,1,0,0,0,43,39,220,0,0,0,144,1,0,0,0,2,0,0,7,1,0,0,0,0,0,255,2,7,0,0,0,67,0,97,0,108,0,105,0,98,0,114,0,105,0,43,39,220,0,1,0,188,2,0,0,0,2,238,0,7,1,0,0,0,0,0,255,2,7,0,0,0,67,0,97,0,108,0,105,0,98,0,114,0,105,0,37,6,1,0,2,14,0,128,129,8,0,38,0,228,4,0,219,4,4,2,0,0,0,45,68,0,0,0,0,3,64,0,0,0,0,0,255,3,65,0,0,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,45,68,17,0,0,0,3,64,0,0,0,0,0,255,3,65,0,0,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,220,4,0,229,4,4,1,0,0,0,46,51,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,230,4,0,242,4,4,1,0,0,0,47,16,255,255,0,0,0,0,0,0,0,0,0,0,16,16,0,0,243,4,0,233,4,4,4,0,0,0,47,16,0,0,0,0,0,0,0,0,0,0,0,0,16,16,0,0,47,16,0,0,164,0,0,0,0,0,0,0,0,0,16,16,1,0,47,16,0,0,166,0,0,0,0,0,0,0,0,0,16,16,1,0,47,16,0,0,0,1,1,0,0,0,0,0,0,0,16,16,0,0,234,4,0,235,4,4,1,0,0,0,37,6,1,0,2,17,0,128,128,24,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,48,28,0,0,0,0,1,0,0,0,8,0,0,0,78,0,111,0,114,0,109,0,97,0,108,0,110,0,121,0,236,4,0,249,3,4,0,0,0,0,250,3,0,252,3,80,0,0,0,0,17,0,0,0,84,0,97,0,98,0,108,0,101,0,83,0,116,0,121,0,108,0,101,0,77,0,101,0,100,0,105,0,117,0,109,0,50,0,17,0,0,0,80,0,105,0,118,0,111,0,116,0,83,0,116,0,121,0,108,0,101,0,76,0,105,0,103,0,104,0,116,0,49,0,54,0,253,3,0,35,4,2,14,0,0,235,8,0,246,8,42,0,0,0,0,17,0,0,0,83,0,108,0,105,0,99,0,101,0,114,0,83,0,116,0,121,0,108,0,101,0,76,0,105,0,103,0,104,0,116,0,49,0,247,8,0,236,8,0,36,0,35,4,3,15,0,0,176,16,0,178,16,50,0,0,0,0,21,0,0,0,84,0,105,0,109,0,101,0,83,0,108,0,105,0,99,0,101,0,114,0,83,0,116,0,121,0,108,0,101,0,76,0,105,0,103,0,104,0,116,0,49,0,179,16,0,177,16,0,36,0,151,2,0]),this._binaryIndexBin=Buffer.from([42,24,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,149,2,0]),this._rRkIntegerLowerLimit=-1<<29,this._rRkIntegerUpperLimit=(1<<29)-1,this._autoFilterStartBytes=Buffer.from([161,1,16]),this._autoFilterEndBytes=Buffer.from([162,1,0]),this._stickHeaderA1bytes=Buffer.from([151,1,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,63,1,0,0,0,0,0,0,0,2,0,0,0,3]),this._magicFilterExcel2016Fix0=Buffer.from([225,2,0,229,2,0,234,2]),this._magicFilterExcel2016Fix1=Buffer.from([39,70,33,0,0,0,0,255,0,0,0,15,0,0,0,95,0,70,0,105,0,108,0,116,0,101,0,114,0,68,0,97,0,116,0,97,0,98,0,97,0,115,0,101,0,15,0,0,0,59,255,0]),this._magicFilterExcel2016Fix2=Buffer.from([0,0,0,0,255,255,255,255])}_sanitizeSheetName(e){if(!e||typeof e!="string")return`Sheet${this.sheetCount+1}`;let t=e.replace(on,"_");return t.length>31&&(t=t.substring(0,31)),t.trim().length===0&&(t=`Sheet${this.sheetCount+1}`),t}addSheet(e,t=!1){let s=this._sanitizeSheetName(e);this.sheetCount++,this.sheetList.push({name:s,pathInArchive:`xl/worksheets/sheet${this.sheetCount}.bin`,hidden:t,nameInArchive:`sheet${this.sheetCount}.bin`,sheetId:this.sheetCount,filterHeaderRange:null})}writeSheet(e,t=null,s=!0){let n=new Ct,i=0;if(e.length>0?i=e[0].length:t&&(i=t.length),this.colWidths=new Array(i).fill(-1),t)for(let l=0;l<i;l++){let x=1.25*(t[l]?t[l].length:0)+2;x>80&&(x=80),this.colWidths[l]<x&&(this.colWidths[l]=x)}for(let l=0;l<Math.min(e.length,100);l++){let h=e[l];for(let x=0;x<h.length;x++){let m=h[x],b=1.25*(m?m.toString().length:0)+2;b>80&&(b=80),this.colWidths[x]<b&&(this.colWidths[x]=b)}}let a=Buffer.from(this._sheet1Bytes),o=0,r=i;a.writeInt32LE(o,40),a.writeInt32LE(r,44),this.sheetCount!==1&&(a[54]=156),n.write(a.subarray(0,84)),s&&t&&n.write(this._stickHeaderA1bytes),n.write(a.subarray(84,159)),n.writeByte(134),n.writeByte(3);for(let l=o;l<r;l++){n.writeByte(0),n.writeByte(60),n.writeByte(18),n.writeInt32LE(l),n.writeInt32LE(l);let h=this.colWidths[l]>0?Math.floor(this.colWidths[l]):10;n.writeByte(0),n.writeByte(Math.max(0,Math.min(255,h))),n.writeByte(0),n.writeByte(0),n.writeByte(0),n.writeByte(0),n.writeByte(0),n.writeByte(0),n.writeByte(2)}n.writeByte(0),n.writeByte(135),n.writeByte(3),n.writeByte(0),n.write(a.subarray(159,175)),n.write(Buffer.from([38,0]));let p=0;if(t){this.createRowHeader(n,p,o,r);for(let l=0;l<t.length;l++)this.writeString(n,t[l],l,!0);p++}for(let l=0;l<e.length;l++){this.createRowHeader(n,p,o,r);let h=e[l];for(let x=0;x<h.length;x++){let m=h[x];m!=null&&(typeof m=="number"?Number.isInteger(m)?m>=this._rRkIntegerLowerLimit&&m<=this._rRkIntegerUpperLimit?this.writeRkNumberInteger(n,m,x):this.writeDouble(n,m,x):this.writeDouble(n,m,x):typeof m=="bigint"?this.writeString(n,m.toString(),x):typeof m=="boolean"?this.writeBool(n,m,x):m instanceof Date?this.writeDateTime(n,m,x):this.writeString(n,m.toString(),x))}p++}if(n.write(a.subarray(218,290)),s&&t){this._autofilterIsOn=!0;let l=0,h=e.length+1;n.write(this._autoFilterStartBytes);let x=Buffer.alloc(8);x.writeInt32LE(0,0),x.writeInt32LE(h-1,4),n.write(x);let m=Buffer.alloc(8);m.writeInt32LE(o,0),m.writeInt32LE(r-1,4),n.write(m),n.write(this._autoFilterEndBytes);let v=this.sheetList[this.sheetCount-1];v.filterData={startRow:0,endRow:e.length,startColumn:o,endColumn:r-1}}n.write(a.subarray(290)),this.archive.append(vt.from(n.getChunks()),{name:this.sheetList[this.sheetCount-1].pathInArchive})}_getColumnLetter(e){if(e<26)return String.fromCharCode(65+e);if(e<702){let t=Math.floor(e/26)-1,s=e%26;return String.fromCharCode(65+t)+String.fromCharCode(65+s)}return"A"}createRowHeader(e,t,s,n){e.writeByte(0),e.writeByte(25),e.writeInt32LE(t),e.writeInt32LE(0),e.writeByte(44),e.writeByte(1),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(1),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeInt32LE(s),e.writeInt32LE(n)}writeRkNumberInteger(e,t,s,n=0){e.writeByte(2),e.writeByte(12),e.writeInt32LE(s),e.writeByte(n),e.writeByte(0),e.writeByte(0),e.writeByte(0);let i=t<<2|2;e.writeInt32LE(i)}writeDouble(e,t,s,n=0){e.writeByte(5),e.writeByte(16),e.writeInt32LE(s),e.writeByte(n),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeDoubleLE(t)}writeBool(e,t,s){e.writeByte(4),e.writeByte(9),e.writeInt32LE(s),e.writeInt32LE(0),e.writeByte(t?1:0)}writeDateTime(e,t,s){let n=t.getTimezoneOffset()*6e4,i=(t.getTime()-n-this._oaEpoch)/864e5;this.writeDouble(e,i,s,1)}writeString(e,t,s,n=!1){let i;this.sstDic.has(t)?i=this.sstDic.get(t):(i=this.sstCntUnique,this.sstDic.set(t,i),this.sstCntUnique++),this.sstCntAll++,e.writeByte(7),e.writeByte(12),e.writeInt32LE(s),e.writeByte(n?3:0),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeInt32LE(i)}saveSst(){let e=new Ct;e.writeByte(159),e.writeByte(1),e.writeByte(8),e.writeInt32LE(this.sstCntUnique),e.writeInt32LE(this.sstCntAll);for(let[t,s]of this.sstDic){let n=t.length;e.writeByte(19);let i=5+2*n;if(i>=128){e.writeByte(128+i%128);let a=i>>7;a>=256?e.writeByte(128+a%128):e.writeByte(a),e.writeByte(i>>14),i>>14>0&&e.writeByte(0)}else e.writeByte(i&255),e.writeByte(i>>8&255);e.writeInt32LE(n),e.writeUtf16LE(t)}e.writeByte(160),e.writeByte(1),e.writeByte(0),this.archive.append(vt.from(e.getChunks()),{name:"xl/sharedStrings.bin"})}_writeFilterDefinedName(e,t,s){let n=t.filterData,i=t.sheetId-1,a=Buffer.alloc(this._magicFilterExcel2016Fix1.length);this._magicFilterExcel2016Fix1.copy(a);let o=this._magicFilterExcel2016Fix1.length-2;a[7]=i,a[o]=s,e.push(a);let r=Buffer.alloc(8);r.writeInt32LE(n.startRow,0),r.writeInt32LE(n.endRow,4),e.push(r);let p=Buffer.alloc(4);p.writeInt16LE(n.startColumn,0),p.writeInt16LE(n.endColumn,2),e.push(p),e.push(this._magicFilterExcel2016Fix2)}finalize(){return new Promise((e,t)=>{try{this.saveSst(),this.archive.append(this._stylesBin,{name:"xl/styles.bin"});let s=[];s.push(this._workbookBinStart);for(let o of this.sheetList){let r=`rId${o.sheetId}`,p=16+o.name.length*2+r.length*2,l=Buffer.alloc(3+p);l[0]=156,l[1]=1,l[2]=p;let h=3;l.writeInt32LE(o.hidden?1:0,h),h+=4,l.writeInt32LE(o.sheetId,h),h+=4,l.writeInt32LE(r.length,h),h+=4;for(let x=0;x<r.length;x++){let m=r.charCodeAt(x);l[h++]=m&255,l[h++]=m>>8&255}l.writeInt32LE(o.name.length,h),h+=4;for(let x=0;x<o.name.length;x++){let m=o.name.charCodeAt(x);l[h++]=m&255,l[h++]=m>>8&255}s.push(l)}if(s.push(this._workbookBinMiddle),this._autofilterIsOn){let o=this.sheetList.filter(p=>p.filterData),r=o.length;if(r>0){s.push(this._magicFilterExcel2016Fix0);let p=16+(r-1)*12,l=Buffer.from([p,r,0,0,0]);s.push(l);for(let h=0;h<r;h++){let x=o[h].sheetId-1,m=Buffer.alloc(12);m.writeInt32LE(0,0),m[4]=x,m[8]=x,s.push(m)}s.push(Buffer.from([226,2,0]));for(let h=0;h<r;h++){let x=o[h];this._writeFilterDefinedName(s,x,h)}}}s.push(this._workbookBinEnd),this.archive.append(Buffer.concat(s),{name:"xl/workbook.bin"});for(let o of this.sheetList)this.archive.append(this._binaryIndexBin,{name:`xl/worksheets/binaryIndex${o.sheetId}.bin`});let n=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="bin" ContentType="application/vnd.ms-excel.sheet.binary.macroEnabled.main"/>
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
<Default Extension="xml" ContentType="application/xml"/>`;for(let o of this.sheetList)n+=`<Override PartName="/${o.pathInArchive}" ContentType="application/vnd.ms-excel.worksheet"/>`,n+=`<Override PartName="/xl/worksheets/binaryIndex${o.sheetId}.bin" ContentType="application/vnd.ms-excel.binIndexWs"/>`;n+=`<Override PartName="/xl/styles.bin" ContentType="application/vnd.ms-excel.styles"/>
<Override PartName="/xl/sharedStrings.bin" ContentType="application/vnd.ms-excel.sharedStrings"/>
</Types>`,this.archive.append(n,{name:"[Content_Types].xml"});let i=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">`;for(let o of this.sheetList){let r=`rId${o.sheetId}`;i+=`<Relationship Id="${r}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/${o.nameInArchive}"/>`}i+=`<Relationship Id="rId${this.sheetList.length+2}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.bin"/>
<Relationship Id="rId${this.sheetList.length+3}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.bin"/>
</Relationships>`,this.archive.append(i,{name:"xl/_rels/workbook.bin.rels"}),this.archive.append(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.bin"/>
</Relationships>`,{name:"_rels/.rels"});for(let o of this.sheetList){let r=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.microsoft.com/office/2006/relationships/xlBinaryIndex" Target="binaryIndex${o.sheetId}.bin"/>
</Relationships>`;this.archive.append(r,{name:`xl/worksheets/_rels/${o.nameInArchive}.rels`})}this.output.on("close",()=>e()),this.archive.on("error",o=>t(o)),this.archive.finalize()}catch(s){t(s)}})}};bt.exports=Ye});var pe={};ne(pe,{copyFileToClipboard:()=>Qe,exportCsvToXlsb:()=>cn,exportQueryToXlsb:()=>an,getTempFilePath:()=>ln});async function an(d,e,t,s=!1,n){let i=null;try{n&&n("Connecting to database..."),i=await rn.connect(d),n&&n("Executing query...");let a=await i.query(e);if(!a||!a.columns||a.columns.length===0)return{success:!1,message:"Query did not return any results (no columns)"};let o=a.columns.length;n&&n(`Query returned ${o} columns`);let r=a.columns.map(E=>E.name),p=a.map(E=>r.map(R=>E[R])),l=p.length;n&&n(`Writing ${l.toLocaleString()} rows to XLSB: ${t}`);let h=new At(t);h.addSheet("Query Results"),h.writeSheet(p,r),h.addSheet("SQL Code");let x=[["SQL Query:"],...e.split(`
`).map(E=>[E])];h.writeSheet(x,null,!1),await h.finalize();let v=je.statSync(t).size/(1024*1024);n&&(n("XLSB file created successfully (via XlsbWriter)"),n(`  - Rows: ${l.toLocaleString()}`),n(`  - Columns: ${o}`),n(`  - File size: ${v.toFixed(1)} MB`),n(`  - Location: ${t}`));let b={success:!0,message:`Successfully exported ${l} rows to ${t}`,details:{rows_exported:l,columns:o,file_size_mb:parseFloat(v.toFixed(1)),file_path:t}};if(s){n&&n("Copying to clipboard...");let E=await Qe(t);b.details&&(b.details.clipboard_success=E)}return b}catch(a){return{success:!1,message:`Export error: ${a.message||a}`}}finally{if(i)try{await i.close()}catch{}}}async function cn(d,e,t=!1,s,n){try{n&&n("Reading CSV content...");let i=E=>{let R=[],N=0,O=!1;for(let M=0;M<E.length;M++)if(E[M]==='"')O=!O;else if(E[M]===","&&!O){let F=E.substring(N,M);F.startsWith('"')&&F.endsWith('"')&&(F=F.slice(1,-1).replace(/""/g,'"')),R.push(F),N=M+1}let $=E.substring(N);return $.startsWith('"')&&$.endsWith('"')&&($=$.slice(1,-1).replace(/""/g,'"')),R.push($),R},a=d.split(/\r?\n/),o=[];for(let E of a)E.trim()&&o.push(i(E));if(o.length===0)return{success:!1,message:"CSV content is empty"};let r=o[0],p=o.slice(1),l=p.length,h=r.length;n&&n(`Writing ${l.toLocaleString()} rows to XLSB: ${e}`);let x=new At(e);if(x.addSheet("CSV Data"),x.writeSheet(p,r),s?.sql){x.addSheet("SQL");let E=[["SQL Query:"],...s.sql.split(`
`).map(R=>[R])];x.writeSheet(E,null,!1)}else{let E=s?.source||"Clipboard";x.addSheet("CSV Source");let R=[["CSV Source:"],[E]];x.writeSheet(R,null,!1)}await x.finalize();let v=je.statSync(e).size/(1024*1024);n&&(n("XLSB file created successfully (via XlsbWriter)"),n(`  - Rows: ${l.toLocaleString()}`),n(`  - Columns: ${h}`),n(`  - File size: ${v.toFixed(1)} MB`),n(`  - Location: ${e}`));let b={success:!0,message:`Successfully exported ${l} rows from CSV to ${e}`,details:{rows_exported:l,columns:h,file_size_mb:parseFloat(v.toFixed(1)),file_path:e}};if(t){n&&n("Copying to clipboard...");let E=await Qe(e);b.details&&(b.details.clipboard_success=E)}return b}catch(i){return{success:!1,message:`Export error: ${i.message||i}`}}}async function Qe(d){return Fe.platform()!=="win32"?(console.error("Clipboard file copy is only supported on Windows"),!1):new Promise(e=>{try{let t=fe.normalize(fe.resolve(d)),s=`Set-Clipboard -Path "${t.replace(/"/g,'`"')}"`,n=(0,St.spawn)("powershell.exe",["-NoProfile","-NonInteractive","-Command",s]),i="";n.stderr.on("data",a=>{i+=a.toString()}),n.on("close",a=>{a!==0?(console.error(`PowerShell clipboard copy failed: ${i}`),e(!1)):(console.log(`File copied to clipboard: ${t}`),e(!0))}),n.on("error",a=>{console.error(`Error spawning PowerShell: ${a.message}`),e(!1)})}catch(t){console.error(`Error copying file to clipboard: ${t.message}`),e(!1)}})}function ln(){let d=Fe.tmpdir(),t=`netezza_export_${Date.now()}.xlsb`;return fe.join(d,t)}var je,fe,Fe,St,At,rn,he=te(()=>{"use strict";je=U(require("fs")),fe=U(require("path")),Fe=U(require("os")),St=require("child_process"),At=Tt(),rn=require("odbc")});var Rt={};ne(Rt,{exportToCsv:()=>dn});async function dn(d,e,t,s,n){if(!Ke)throw new Error("odbc package not installed. Please run: npm install odbc");let i=await Ke.connect(e);try{n&&n.report({message:"Executing query..."});let a=await i.query(t,{cursor:!0,fetchSize:1e3});n&&n.report({message:"Writing to CSV..."});let o=It.createWriteStream(s,{encoding:"utf8",highWaterMark:64*1024}),r=[];a.columns&&(r=a.columns.map(m=>m.name)),r.length>0&&o.write(r.map(Ge).join(",")+`
`);let p=0,l=[],h=[],x=100;do{l=await a.fetch();for(let m of l){p++;let v;if(r.length>0?v=r.map(b=>Ge(m[b])):v=Object.values(m).map(b=>Ge(b)),h.push(v.join(",")),h.length>=x){let b=o.write(h.join(`
`)+`
`);h=[],b||await new Promise(E=>o.once("drain",E))}}n&&l.length>0&&n.report({message:`Processed ${p} rows...`})}while(l.length>0&&!a.noData);h.length>0&&o.write(h.join(`
`)+`
`),await a.close(),o.end(),await new Promise((m,v)=>{o.on("finish",m),o.on("error",v)}),n&&n.report({message:`Completed: ${p} rows exported`})}finally{try{await i.close()}catch(a){console.error("Error closing connection:",a)}}}function Ge(d){if(d==null)return"";let e="";return typeof d=="bigint"?d>=Number.MIN_SAFE_INTEGER&&d<=Number.MAX_SAFE_INTEGER?e=Number(d).toString():e=d.toString():d instanceof Date?e=d.toISOString():d instanceof Buffer?e=d.toString("hex"):typeof d=="object"?e=JSON.stringify(d):e=String(d),e.includes('"')||e.includes(",")||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}var It,Ke,Dt=te(()=>{"use strict";It=U(require("fs"));try{Ke=require("odbc")}catch{console.error("odbc package not installed. Run: npm install odbc")}});var Nt={};ne(Nt,{ColumnTypeChooser:()=>we,NetezzaDataType:()=>se,NetezzaImporter:()=>Ue,importDataToNetezza:()=>un});async function un(d,e,t,s,n){let i=Date.now();try{if(!d||!Y.existsSync(d))return{success:!1,message:`Source file not found: ${d}`};if(!e)return{success:!1,message:"Target table name is required"};if(!t)return{success:!1,message:"Connection string is required"};let o=Y.statSync(d).size,r=re.extname(d).toLowerCase(),p=[".csv",".txt",".xlsx",".xlsb"];if(!p.includes(r))return{success:!1,message:`Unsupported file format: ${r}. Supported: ${p.join(", ")}`};if([".xlsx",".xlsb"].includes(r)&&!Te)return{success:!1,message:"XLSX module not available. Please run: npm install xlsx"};n?.("Starting import process..."),n?.(`  Source file: ${d}`),n?.(`  Target table: ${e}`),n?.(`  File size: ${o.toLocaleString()} bytes`),n?.(`  File format: ${r}`);let h=new Ue(d,e,t);await h.analyzeDataTypes(n),n?.("Using file-based import...");let x=await h.createDataFile(n),m=h.generateCreateTableSql();if(n?.("Generated SQL:"),n?.(m),n?.("Connecting to Netezza..."),!Ze)throw new Error("ODBC module not available");let v=await Ze.connect(t);try{n?.("Executing CREATE TABLE with EXTERNAL data..."),await v.query(m),n?.("Import completed successfully")}finally{await v.close();try{Y.existsSync(x)&&(Y.unlinkSync(x),n?.("Temporary data file cleaned up"))}catch(E){n?.(`Warning: Could not clean up temp file: ${E.message}`)}}let b=(Date.now()-i)/1e3;return{success:!0,message:"Import completed successfully",details:{sourceFile:d,targetTable:e,fileSize:o,format:r,rowsProcessed:h.getRowsCount(),rowsInserted:h.getRowsCount(),processingTime:`${b.toFixed(1)}s`,columns:h.getSqlHeaders().length,detectedDelimiter:h.getCsvDelimiter()}}}catch(a){let o=(Date.now()-i)/1e3;return{success:!1,message:`Import failed: ${a.message}`,details:{processingTime:`${o.toFixed(1)}s`}}}}var Y,re,Te,Ze,se,we,Ue,et=te(()=>{"use strict";Y=U(require("fs")),re=U(require("path"));try{Te=require("xlsx")}catch{console.error("XLSX module not available")}try{Ze=require("odbc")}catch{console.error("ODBC module not available")}se=class{constructor(e,t,s,n){this.dbType=e;this.precision=t;this.scale=s;this.length=n}toString(){return["BIGINT","DATE","DATETIME"].includes(this.dbType)?this.dbType:this.dbType==="NUMERIC"?`${this.dbType}(${this.precision},${this.scale})`:this.dbType==="NVARCHAR"?`${this.dbType}(${this.length})`:`TODO !!! ${this.dbType}`}},we=class{constructor(){this.decimalDelimInCsv=".";this.firstTime=!0;this.currentType=new se("BIGINT")}getType(e){let t=this.currentType.dbType,s=e.length;if(t==="BIGINT"&&/^\d+$/.test(e)&&s<15)return this.firstTime=!1,new se("BIGINT");let n=(e.match(new RegExp(`\\${this.decimalDelimInCsv}`,"g"))||[]).length;if(["BIGINT","NUMERIC"].includes(t)&&n<=1){let a=e.replace(this.decimalDelimInCsv,"");if(/^\d+$/.test(a)&&s<15&&(!a.startsWith("0")||n>0))return this.firstTime=!1,new se("NUMERIC",16,6)}if((t==="DATE"||this.firstTime)&&(e.match(/-/g)||[]).length===2&&s>=8&&s<=10){let a=e.split("-");if(a.length===3&&a.every(o=>/^\d+$/.test(o)))try{let o=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]));if(!isNaN(o.getTime()))return this.firstTime=!1,new se("DATE")}catch{}}if((t==="DATETIME"||this.firstTime)&&(e.match(/-/g)||[]).length===2&&s>=12&&s<=20){let a=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})[\s|T](\d{2}):(\d{2})(:?(\d{2}))?$/);if(a)try{let o=a[7]?parseInt(a[7]):0,r=new Date(parseInt(a[1]),parseInt(a[2])-1,parseInt(a[3]),parseInt(a[4]),parseInt(a[5]),o);if(!isNaN(r.getTime()))return this.firstTime=!1,new se("DATETIME")}catch{}}let i=Math.max(s+5,20);return this.currentType.length!==void 0&&i<this.currentType.length&&(i=this.currentType.length),this.firstTime=!1,new se("NVARCHAR",void 0,void 0,i)}refreshCurrentType(e){return this.currentType=this.getType(e),this.currentType}},Ue=class{constructor(e,t,s,n){this.delimiter="	";this.delimiterPlain="\\t";this.recordDelim=`
`;this.recordDelimPlain="\\n";this.escapechar="\\";this.csvDelimiter=",";this.excelData=[];this.isExcelFile=!1;this.sqlHeaders=[];this.dataTypes=[];this.rowsCount=0;this.valuesToEscape=[];this.filePath=e,this.targetTable=t,this.connectionString=s,this.logDir=n||re.join(re.dirname(e),"netezza_logs");let i=re.extname(e).toLowerCase();this.isExcelFile=[".xlsx",".xlsb"].includes(i);let a=Math.floor(Math.random()*1e3);this.pipeName=`\\\\.\\pipe\\NETEZZA_IMPORT_${a}`,this.valuesToEscape=[this.escapechar,this.recordDelim,"\r",this.delimiter],Y.existsSync(this.logDir)||Y.mkdirSync(this.logDir,{recursive:!0})}detectCsvDelimiter(){let t=Y.readFileSync(this.filePath,"utf-8").split(`
`)[0]||"";t.startsWith("\uFEFF")&&(t=t.slice(1));let s=[";","	","|",","],n={};for(let a of s)n[a]=(t.match(new RegExp(a==="|"?"\\|":a,"g"))||[]).length;let i=Math.max(...Object.values(n));i>0&&(this.csvDelimiter=Object.keys(n).find(a=>n[a]===i)||",")}cleanColumnName(e){let t=String(e).trim();return t=t.replace(/[^0-9a-zA-Z]+/g,"_").toUpperCase(),(!t||/^\d/.test(t))&&(t="COL_"+t),t}parseCsvLine(e){let t=[],s="",n=!1;for(let i=0;i<e.length;i++){let a=e[i];a==='"'?n&&e[i+1]==='"'?(s+='"',i++):n=!n:a===this.csvDelimiter&&!n?(t.push(s),s=""):s+=a}return t.push(s),t}readExcelFile(e){if(!Te)throw new Error("XLSX module not available");e?.("Reading Excel file...");let t=Te.readFile(this.filePath,{type:"file"}),s=t.SheetNames[0];if(!s)throw new Error("Excel file has no sheets");e?.(`Processing sheet: ${s}`);let n=t.Sheets[s],a=Te.utils.sheet_to_json(n,{header:1,raw:!1,defval:""}).map(o=>o.map(r=>r!=null?String(r):""));return e?.(`Excel file loaded: ${a.length} rows, ${a[0]?.length||0} columns`),a}async analyzeDataTypes(e){e?.("Analyzing data types...");let t;if(this.isExcelFile)this.excelData=this.readExcelFile(e),t=this.excelData;else{this.detectCsvDelimiter();let n=Y.readFileSync(this.filePath,"utf-8");n.startsWith("\uFEFF")&&(n=n.slice(1));let i=n.split(/\r?\n/);t=[];for(let a of i)a.trim()&&t.push(this.parseCsvLine(a))}if(!t||t.length===0)throw new Error("No data found in file");let s=[];this.sqlHeaders=t[0].map(n=>this.cleanColumnName(n||"COLUMN"));for(let n=0;n<t[0].length;n++)s.push(new we);for(let n=1;n<t.length;n++){let i=t[n];for(let a=0;a<i.length;a++)a<s.length&&i[a]&&i[a].trim()&&s[a].refreshCurrentType(i[a].trim());n%1e4===0&&e?.(`Analyzed ${n.toLocaleString()} rows...`)}return this.rowsCount=t.length-1,e?.(`Analysis complete: ${this.rowsCount.toLocaleString()} rows`),this.dataTypes=s,s}escapeValue(e){let t=String(e).trim();for(let s of this.valuesToEscape)t=t.split(s).join(`${this.escapechar}${s}`);return t}formatValue(e,t){let s=this.escapeValue(e);return t<this.dataTypes.length&&this.dataTypes[t].currentType.dbType==="DATETIME"&&(s=s.replace("T"," ")),s}generateCreateTableSql(){let e=[];for(let s=0;s<this.sqlHeaders.length;s++){let n=this.sqlHeaders[s],i=this.dataTypes[s];e.push(`        ${n} ${i.currentType.toString()}`)}let t=this.logDir.replace(/\\/g,"/");return`CREATE TABLE ${this.targetTable} AS 
(
    SELECT * FROM EXTERNAL '${this.pipeName}'
    (
${e.join(`,
`)}
    )
    USING
    (
        REMOTESOURCE 'odbc'
        DELIMITER '${this.delimiterPlain}'
        RecordDelim '${this.recordDelimPlain}'
        ESCAPECHAR '${this.escapechar}'
        NULLVALUE ''
        ENCODING 'utf-8'
        TIMESTYLE '24HOUR'
        SKIPROWS 0
        MAXERRORS 10
        LOGDIR '${t}'
    )
) DISTRIBUTE ON RANDOM;`}async createDataFile(e){let t=re.join(this.logDir,`netezza_import_data_${Math.floor(Math.random()*1e3)}.txt`);e?.(`Creating temporary data file: ${t}`);try{let s;if(this.isExcelFile){if(!this.excelData||this.excelData.length===0)throw new Error("Excel data not loaded. Call analyzeDataTypes first.");s=this.excelData.slice(1)}else{let i=Y.readFileSync(this.filePath,"utf-8");i.startsWith("\uFEFF")&&(i=i.slice(1));let a=i.split(/\r?\n/);s=[];let o=!0;for(let r of a)if(r.trim()){if(o){o=!1;continue}s.push(this.parseCsvLine(r))}}let n=[];for(let i=0;i<s.length;i++){let o=s[i].map((r,p)=>this.formatValue(r||"",p));n.push(o.join(this.delimiter)),(i+1)%1e4===0&&e?.(`Processed ${(i+1).toLocaleString()} rows...`)}return Y.writeFileSync(t,n.join(this.recordDelim),"utf-8"),this.pipeName=t.replace(/\\/g,"/"),e?.(`Data file created: ${this.pipeName}`),t}catch(s){throw new Error(`Error creating data file: ${s.message}`)}}getRowsCount(){return this.rowsCount}getSqlHeaders(){return this.sqlHeaders}getCsvDelimiter(){return this.csvDelimiter}}});var Ot={};ne(Ot,{ClipboardDataProcessor:()=>ze,importClipboardDataToNetezza:()=>mn});function pn(d){let e=String(d).trim();return e=e.replace(/[^0-9a-zA-Z]+/g,"_").toUpperCase(),(!e||/^\d/.test(e))&&(e="COL_"+e),e}function hn(d,e,t){let s=String(d).trim();for(let n of t)s=s.split(n).join(`${e}${n}`);return s}function xn(d,e,t,s,n){let i=hn(d,s,n);return e<t.length&&t[e].currentType.dbType==="DATETIME"&&(i=i.replace("T"," ")),i}async function mn(d,e,t,s,n){let i=Date.now(),a=null;try{if(!d)return{success:!1,message:"Target table name is required"};if(!e)return{success:!1,message:"Connection string is required"};n?.("Starting clipboard import process..."),n?.(`  Target table: ${d}`),n?.(`  Format preference: ${t||"auto-detect"}`);let o=new ze,[r,p]=await o.processClipboardData(t,n);if(!r||!r.length)return{success:!1,message:"No data found in clipboard"};if(r.length<2)return{success:!1,message:"Clipboard data must contain at least headers and one data row"};n?.(`  Detected format: ${p}`),n?.(`  Rows: ${r.length}`),n?.(`  Columns: ${r[0].length}`);let l=r[0].map(W=>pn(W)),h=r.slice(1);n?.("Analyzing clipboard data types...");let x=l.map(()=>new we);for(let W=0;W<h.length;W++){let ce=h[W];for(let G=0;G<ce.length;G++)G<x.length&&ce[G]&&ce[G].trim()&&x[G].refreshCurrentType(ce[G].trim());(W+1)%1e3===0&&n?.(`Analyzed ${(W+1).toLocaleString()} rows...`)}n?.(`Analysis complete: ${h.length.toLocaleString()} data rows`);let m=tt.join(require("os").tmpdir(),"netezza_clipboard_logs");oe.existsSync(m)||oe.mkdirSync(m,{recursive:!0});let v="	",b="\\t",E=`
`,R="\\n",N="\\",O=[N,E,"\r",v];a=tt.join(m,`netezza_clipboard_import_${Math.floor(Math.random()*1e3)}.txt`),n?.(`Creating temporary data file: ${a}`);let $=[];for(let W=0;W<h.length;W++){let G=h[W].map((st,He)=>xn(st,He,x,N,O));$.push(G.join(v)),(W+1)%1e3===0&&n?.(`Processed ${(W+1).toLocaleString()} rows...`)}oe.writeFileSync(a,$.join(E),"utf-8");let M=a.replace(/\\/g,"/");n?.(`Data file created: ${M}`);let F=[];for(let W=0;W<l.length;W++)F.push(`        ${l[W]} ${x[W].currentType.toString()}`);let X=m.replace(/\\/g,"/"),Q=`CREATE TABLE ${d} AS 
(
    SELECT * FROM EXTERNAL '${M}'
    (
${F.join(`,
`)}
    )
    USING
    (
        REMOTESOURCE 'odbc'
        DELIMITER '${b}'
        RecordDelim '${R}'
        ESCAPECHAR '${N}'
        NULLVALUE ''
        ENCODING 'utf-8'
        TIMESTYLE '24HOUR'
        SKIPROWS 0
        MAXERRORS 10
        LOGDIR '${X}'
    )
) DISTRIBUTE ON RANDOM;`;if(n?.("Generated SQL:"),n?.(Q),n?.("Connecting to Netezza..."),!nt)throw new Error("ODBC module not available");let ae=await nt.connect(e);try{n?.("Executing CREATE TABLE with EXTERNAL clipboard data..."),await ae.query(Q),n?.("Clipboard import completed successfully")}finally{await ae.close()}let ke=(Date.now()-i)/1e3;return{success:!0,message:"Clipboard import completed successfully",details:{targetTable:d,format:p,rowsProcessed:h.length,rowsInserted:h.length,processingTime:`${ke.toFixed(1)}s`,columns:l.length,detectedDelimiter:v}}}catch(o){let r=(Date.now()-i)/1e3;return{success:!1,message:`Clipboard import failed: ${o.message}`,details:{processingTime:`${r.toFixed(1)}s`}}}finally{if(a&&oe.existsSync(a))try{oe.unlinkSync(a),n?.("Temporary clipboard data file cleaned up")}catch(o){n?.(`Warning: Could not clean up temp file: ${o.message}`)}}}var oe,tt,Mt,nt,ze,$t=te(()=>{"use strict";oe=U(require("fs")),tt=U(require("path")),Mt=U(require("vscode"));et();try{nt=require("odbc")}catch{console.error("ODBC module not available")}ze=class{constructor(){this.processedData=[]}processXmlSpreadsheet(e,t){t?.("Processing XML Spreadsheet data...");let s=[],n=0,i=[],a=0,o=e.match(/ExpandedColumnCount="(\d+)"/);o&&(n=parseInt(o[1]),t?.(`Table has ${n} columns`));let r=e.match(/ExpandedRowCount="(\d+)"/);r&&t?.(`Table has ${r[1]} rows`);let p=/<Row[^>]*>([\s\S]*?)<\/Row>/gi,l;for(;(l=p.exec(e))!==null;){let h=l[1];i=new Array(n).fill("");let x=/<Cell(?:\s+[^>]*ss:Index="(\d+)")?[^>]*>[\s\S]*?<Data[^>]*>([^<]*)<\/Data>[\s\S]*?<\/Cell>|<Cell(?:\s+[^>]*ss:Index="(\d+)")?[^>]*\/>/gi,m,v=0,b=/<Cell(?:[^>]*ss:Index="(\d+)")?[^>]*>(?:[\s\S]*?<Data[^>]*(?:\s+ss:Type="([^"]*)")?[^>]*>([^<]*)<\/Data>)?[\s\S]*?<\/Cell>/gi;for(;(m=b.exec(h))!==null;){m[1]&&(v=parseInt(m[1])-1);let E=m[2]||"",R=m[3]||"";E==="Boolean"&&(R=R==="0"?"False":"True"),v<n&&(i[v]=R),v++}i.some(E=>E.trim())&&s.push([...i]),a++,a%1e4===0&&t?.(`Analyzed ${a.toLocaleString()} rows...`)}return t?.(`XML processing complete: ${s.length} rows, ${n} columns`),this.processedData=s,s}processTextData(e,t){if(t?.("Processing text data..."),!e.trim())return[];let s=e.split(`
`);for(;s.length&&!s[s.length-1].trim();)s.pop();if(!s.length)return[];let n=["	",",",";","|"],i={};for(let p of n){let l=[];for(let h of s.slice(0,Math.min(5,s.length)))if(h.trim()){let x=h.split(p);l.push(x.length)}if(l.length){let h=l.reduce((m,v)=>m+v,0)/l.length,x=l.reduce((m,v)=>m+Math.pow(v-h,2),0)/l.length;i[p]=[h,-x]}}let a="	";Object.keys(i).length&&(a=Object.keys(i).reduce((p,l)=>{let[h,x]=i[p]||[0,0],[m,v]=i[l];return m>h||m===h&&v>x?l:p},"	")),t?.(`Auto-detected delimiter: '${a==="	"?"\\t":a}'`);let o=[],r=0;for(let p of s)if(p.trim()){let l=p.split(a).map(h=>h.trim());o.push(l),r=Math.max(r,l.length)}for(let p of o)for(;p.length<r;)p.push("");return t?.(`Text processing complete: ${o.length} rows, ${r} columns`),this.processedData=o,o}async getClipboardText(){return await Mt.env.clipboard.readText()}async processClipboardData(e,t){t?.("Getting clipboard data...");let s=await this.getClipboardText();if(!s)throw new Error("No data found in clipboard");t?.(`Data size: ${s.length} characters`);let n="TEXT";e==="XML Spreadsheet"||!e&&s.includes("<Workbook")&&s.includes("<Worksheet")?n="XML Spreadsheet":e==="TEXT"&&(n="TEXT"),t?.(`Detected format: ${n}`);let i;return n==="XML Spreadsheet"?i=this.processXmlSpreadsheet(s,t):i=this.processTextData(s,t),t?.(`Processed ${i.length} rows`),i.length&&t?.(`Columns per row: ${i[0].length}`),[i,n]}}});var wn={};ne(wn,{activate:()=>gn,deactivate:()=>fn});module.exports=qt(wn);var c=U(require("vscode"));xe();We();var Z=U(require("vscode")),Ne=class d{constructor(e,t,s){this.extensionUri=t;this.connectionManager=s;this._disposables=[];this._panel=e,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.html=this._getHtmlForWebview(this._panel.webview),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"save":try{await this.connectionManager.saveConnection(n.data),Z.window.showInformationMessage(`Connection '${n.data.name}' saved and activated!`),this.sendConnectionsToWebview()}catch(i){Z.window.showErrorMessage(`Error saving: ${i.message}`)}return;case"delete":try{await Z.window.showWarningMessage(`Are you sure you want to delete '${n.name}'?`,{modal:!0},"Yes","No")==="Yes"&&(await this.connectionManager.deleteConnection(n.name),Z.window.showInformationMessage(`Connection '${n.name}' deleted.`),this.sendConnectionsToWebview())}catch(i){Z.window.showErrorMessage(`Error deleting: ${i.message}`)}return;case"loadConnections":this.sendConnectionsToWebview();return}},null,this._disposables)}async sendConnectionsToWebview(){let e=this.connectionManager.getConnections(),t=this.connectionManager.getActiveConnectionName();await this._panel.webview.postMessage({command:"updateConnections",connections:e,activeName:t})}static createOrShow(e,t){let s=Z.window.activeTextEditor?Z.window.activeTextEditor.viewColumn:void 0;if(d.currentPanel){d.currentPanel._panel.reveal(s);return}let n=Z.window.createWebviewPanel("netezzaLogin","Connect to Netezza",s||Z.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0});d.currentPanel=new d(n,e,t)}dispose(){for(d.currentPanel=void 0,this._panel.dispose();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}_getHtmlForWebview(e){return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Connect to Netezza</title>
            <style>
                body { font-family: var(--vscode-font-family); padding: 0; margin: 0; color: var(--vscode-editor-foreground); background-color: var(--vscode-editor-background); display: flex; height: 100vh; }
                .sidebar { width: 250px; border-right: 1px solid var(--vscode-panel-border); background-color: var(--vscode-sideBar-background); padding: 10px; overflow-y: auto; }
                .main { flex: 1; padding: 20px; overflow-y: auto; }
                
                .connection-item { padding: 8px; cursor: pointer; display: flex; align-items: center; border-radius: 3px; margin-bottom: 2px; }
                .connection-item:hover { background-color: var(--vscode-list-hoverBackground); }
                .connection-item.active { background-color: var(--vscode-list-activeSelectionBackground); color: var(--vscode-list-activeSelectionForeground); }
                .connection-item .name { flex: 1; font-weight: 500; }
                .connection-item .status { font-size: 0.8em; margin-left: 5px; opacity: 0.7; }
                
                .form-group { margin-bottom: 15px; }
                label { display: block; margin-bottom: 5px; font-weight: bold; }
                input { width: 100%; padding: 8px; box-sizing: border-box; background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); }
                input:focus { border-color: var(--vscode-focusBorder); outline: none; }
                
                .actions { margin-top: 20px; display: flex; gap: 10px; }
                button { background: var(--vscode-button-background); color: var(--vscode-button-foreground); padding: 8px 16px; border: none; cursor: pointer; border-radius: 2px; }
                button:hover { background: var(--vscode-button-hoverBackground); }
                button.secondary { background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); }
                button.secondary:hover { background: var(--vscode-button-secondaryHoverBackground); }
                button.danger { background: var(--vscode-errorForeground); color: white; }
                
                h2 { margin-top: 0; border-bottom: 1px solid var(--vscode-panel-border); padding-bottom: 10px; margin-bottom: 20px; }
            </style>
        </head>
        <body>
            <div class="sidebar">
                <div style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">Connections</span>
                    <button id="btnNew" style="padding: 4px 8px; font-size: 0.9em;">+</button>
                </div>
                <div id="connectionList"></div>
            </div>
            
            <div class="main">
                <h2 id="formTitle">New Connection</h2>
                <div class="form-group">
                    <label for="name">Connection Name</label>
                    <input type="text" id="name" placeholder="e.g. Production, Dev">
                </div>
                <div class="form-group">
                    <label for="host">Host</label>
                    <input type="text" id="host" placeholder="nzhost">
                </div>
                <div class="form-group">
                    <label for="port">Port</label>
                    <input type="number" id="port" value="5480">
                </div>
                <div class="form-group">
                    <label for="database">Database</label>
                    <input type="text" id="database" placeholder="system">
                </div>
                <div class="form-group">
                    <label for="user">User</label>
                    <input type="text" id="user" placeholder="admin">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password">
                </div>
                
                <div class="actions">
                    <button id="btnSave" onclick="save()">Save & Connect</button>
                    <button id="btnDelete" class="danger" onclick="del()" style="display: none;">Delete</button>
                </div>
            </div>

            <script>
                const vscode = acquireVsCodeApi();
                let connections = [];
                let activeName = null;
                let currentEditName = null;

                // Load initial data
                window.addEventListener('message', event => {
                    const message = event.data;
                    switch (message.command) {
                        case 'updateConnections':
                            connections = message.connections;
                            activeName = message.activeName;
                            renderList();
                            break;
                    }
                });
                
                vscode.postMessage({ command: 'loadConnections' });

                document.getElementById('btnNew').addEventListener('click', () => {
                    clearForm();
                });

                function renderList() {
                    const list = document.getElementById('connectionList');
                    list.innerHTML = '';
                    
                    connections.forEach(conn => {
                        const div = document.createElement('div');
                        div.className = 'connection-item';
                        if (conn.name === currentEditName) { // Mark selected in list
                             // Maybe add style for 'editing'
                             div.style.border = '1px solid var(--vscode-focusBorder)';
                        }
                        
                        div.innerHTML = \`<span class="name">\${conn.name}</span>\`;
                        if (conn.name === activeName) {
                            div.innerHTML += \`<span class="status"> (Active)</span>\`;
                        }
                        
                        div.onclick = () => loadForm(conn);
                        list.appendChild(div);
                    });
                }

                function loadForm(conn) {
                    currentEditName = conn.name;
                    document.getElementById('formTitle').innerText = 'Edit Connection';
                    document.getElementById('name').value = conn.name;
                    document.getElementById('host').value = conn.host;
                    document.getElementById('port').value = conn.port;
                    document.getElementById('database').value = conn.database;
                    document.getElementById('user').value = conn.user;
                    document.getElementById('password').value = conn.password || ''; // Password might not be sent back for security? allow update
                    
                    document.getElementById('btnDelete').style.display = 'block';
                    renderList();
                }

                function clearForm() {
                    currentEditName = null;
                    document.getElementById('formTitle').innerText = 'New Connection';
                    document.getElementById('name').value = '';
                    document.getElementById('host').value = '';
                    document.getElementById('port').value = '5480';
                    document.getElementById('database').value = 'system';
                    document.getElementById('user').value = '';
                    document.getElementById('password').value = '';
                    
                    document.getElementById('btnDelete').style.display = 'none';
                    renderList();
                }

                function save() {
                    const name = document.getElementById('name').value;
                    if (!name) {
                        return; // Add validation UI?
                    }
                    
                    const data = {
                        name: name,
                        host: document.getElementById('host').value,
                        port: parseInt(document.getElementById('port').value),
                        database: document.getElementById('database').value,
                        user: document.getElementById('user').value,
                        password: document.getElementById('password').value
                    };
                    
                    vscode.postMessage({
                        command: 'save',
                        data: data
                    });
                }

                function del() {
                    if (currentEditName) {
                        vscode.postMessage({
                            command: 'delete',
                            name: currentEditName
                        });
                    }
                }
            </script>
        </body>
        </html>`}};Me();var H=U(require("vscode")),ve=class{constructor(e){this._resultsMap=new Map;this._pinnedSources=new Set;this._pinnedResults=new Map;this._resultIdCounter=0;this._extensionUri=e}static{this.viewType="netezza.results"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[H.Uri.joinPath(this._extensionUri,"media")]},e.webview.html=this._getHtmlForWebview(),e.webview.onDidReceiveMessage(n=>{switch(n.command){case"exportCsv":this.exportCsv(n.data);return;case"openInExcel":this.openInExcel(n.data,n.sql);return;case"copyAsExcel":this.copyAsExcel(n.data,n.sql);return;case"switchSource":this._activeSourceUri=n.sourceUri,this._updateWebview();return;case"togglePin":this._pinnedSources.has(n.sourceUri)?this._pinnedSources.delete(n.sourceUri):this._pinnedSources.add(n.sourceUri),this._updateWebview();return;case"toggleResultPin":this._toggleResultPin(n.sourceUri,n.resultSetIndex);return;case"switchToPinnedResult":this._switchToPinnedResult(n.resultId);return;case"unpinResult":this._pinnedResults.delete(n.resultId),this._updateWebview();return;case"closeSource":this.closeSource(n.sourceUri);return;case"copyToClipboard":H.env.clipboard.writeText(n.text),H.window.showInformationMessage("Copied to clipboard");return;case"info":H.window.showInformationMessage(n.text);return;case"error":H.window.showErrorMessage(n.text);return}})}setActiveSource(e){this._resultsMap.has(e)&&this._activeSourceUri!==e&&(this._activeSourceUri=e,this._updateWebview())}updateResults(e,t,s=!1){this._resultsMap.has(t)||this._pinnedSources.add(t);let n=[];Array.isArray(e)?n=e:n=[e];let i=this._resultsMap.get(t)||[],a=Array.from(this._pinnedResults.entries()).filter(([p,l])=>l.sourceUri===t).sort((p,l)=>p[1].resultSetIndex-l[1].resultSetIndex),o=[],r=[];a.forEach(([p,l])=>{l.resultSetIndex<i.length&&(o.push(i[l.resultSetIndex]),r.push([p,l]))}),o.push(...n),r.forEach(([p,l],h)=>{let x=this._pinnedResults.get(p);x&&(x.resultSetIndex=h)}),s||Array.from(this._resultsMap.keys()).filter(l=>l!==t&&!this._pinnedSources.has(l)).forEach(l=>{this._resultsMap.delete(l),Array.from(this._pinnedResults.entries()).filter(([x,m])=>m.sourceUri===l).map(([x,m])=>x).forEach(x=>this._pinnedResults.delete(x))}),this._resultsMap.set(t,o),this._activeSourceUri=t,this._view?(this._updateWebview(),this._view.show?.(!0)):H.window.showInformationMessage('Query completed. Please open "Query Results" panel to view data.')}_updateWebview(){this._view&&(this._view.webview.html=this._getHtmlForWebview())}_toggleResultPin(e,t){let s=Array.from(this._pinnedResults.entries()).find(([n,i])=>i.sourceUri===e&&i.resultSetIndex===t);if(s)this._pinnedResults.delete(s[0]);else{let n=`result_${++this._resultIdCounter}`,i=Date.now(),o=`${e.split(/[\\/]/).pop()||e} - Result ${t+1}`;this._pinnedResults.set(n,{sourceUri:e,resultSetIndex:t,timestamp:i,label:o})}this._updateWebview()}_switchToPinnedResult(e){let t=this._pinnedResults.get(e);t&&(this._activeSourceUri=t.sourceUri,this._updateWebview(),this._view&&this._view.webview.postMessage({command:"switchToResultSet",resultSetIndex:t.resultSetIndex}))}async exportCsv(e){let t=await H.window.showSaveDialog({filters:{"CSV Files":["csv"]},saveLabel:"Export"});t&&(await H.workspace.fs.writeFile(t,Buffer.from(e)),H.window.showInformationMessage(`Results exported to ${t.fsPath}`))}async openInExcel(e,t){H.commands.executeCommand("netezza.exportCurrentResultToXlsbAndOpen",e,t)}async copyAsExcel(e,t){H.commands.executeCommand("netezza.copyCurrentResultToXlsbClipboard",e,t)}closeSource(e){if(this._resultsMap.has(e)){if(this._resultsMap.delete(e),this._pinnedSources.delete(e),Array.from(this._pinnedResults.entries()).filter(([s,n])=>n.sourceUri===e).map(([s,n])=>s).forEach(s=>this._pinnedResults.delete(s)),this._activeSourceUri===e){let s=Array.from(this._resultsMap.keys());this._activeSourceUri=s.length>0?s[0]:void 0}this._updateWebview()}}_getHtmlForWebview(){if(!this._view)return"";let{scriptUri:e,virtualUri:t,mainScriptUri:s,styleUri:n,workerUri:i}=this._getScriptUris(),a=this._prepareViewData();return this._buildHtmlDocument(e,t,s,n,a,i)}_getScriptUris(){return{scriptUri:this._view.webview.asWebviewUri(H.Uri.joinPath(this._extensionUri,"media","tanstack-table-core.js")),virtualUri:this._view.webview.asWebviewUri(H.Uri.joinPath(this._extensionUri,"media","tanstack-virtual-core.js")),mainScriptUri:this._view.webview.asWebviewUri(H.Uri.joinPath(this._extensionUri,"media","resultPanel.js")),workerUri:this._view.webview.asWebviewUri(H.Uri.joinPath(this._extensionUri,"media","searchWorker.js")),styleUri:this._view.webview.asWebviewUri(H.Uri.joinPath(this._extensionUri,"media","resultPanel.css"))}}_prepareViewData(){let e=Array.from(this._resultsMap.keys()),t=Array.from(this._pinnedSources),s=Array.from(this._pinnedResults.entries()).map(([o,r])=>({id:o,...r})),n=this._activeSourceUri&&this._resultsMap.has(this._activeSourceUri)?this._activeSourceUri:e.length>0?e[0]:null,i=n?this._resultsMap.get(n):[],a=(o,r)=>typeof r=="bigint"?r>=Number.MIN_SAFE_INTEGER&&r<=Number.MAX_SAFE_INTEGER?Number(r):r.toString():r;return{sourcesJson:JSON.stringify(e),pinnedSourcesJson:JSON.stringify(t),pinnedResultsJson:JSON.stringify(s),activeSourceJson:JSON.stringify(n),resultSetsJson:JSON.stringify(i,a)}}_buildHtmlDocument(e,t,s,n,i,a){let o=this._view.webview.cspSource;return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src ${o} 'unsafe-inline'; worker-src ${o} blob:; connect-src ${o}; style-src ${o} 'unsafe-inline';">
            <title>Query Results</title>
            <script src="${e}"></script>
            <script src="${t}"></script>
            <link rel="stylesheet" href="${n}">
        </head>
        <body>
            <div id="sourceTabs" class="source-tabs"></div>
            <div id="resultSetTabs" class="result-set-tabs" style="display: none;"></div>
            
            <div class="controls">
                <button onclick="toggleRowView()" title="Toggle Row View">\u{1F441}\uFE0F Row View</button>
                <button onclick="openInExcel()" title="Open results in Excel">\u{1F4CA} Excel</button>
                <button onclick="copyAsExcel()" title="Copy results as Excel to clipboard">\u{1F4CB} Excel Copy</button>
                <button onclick="exportToCsv()" title="Export results to CSV">\u{1F4C4} CSV</button>
                <div style="width: 1px; height: 16px; background: var(--vscode-panel-border); margin: 0 4px;"></div>
                <button onclick="selectAll()" title="Select all rows">\u2611\uFE0F Select All</button>
                <button onclick="copySelection(false)" title="Copy selected cells to clipboard">\u{1F4CB} Copy</button>
                <button onclick="copySelection(true)" title="Copy selected cells with headers">\u{1F4CB} Copy w/ Headers</button>
                <button onclick="clearAllFilters()" title="Clear all column filters">\u{1F6AB} Clear Filters</button>
                <input type="text" id="globalFilter" placeholder="Filter..." onkeyup="onFilterChanged()" style="background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); padding: 4px;">
                <span id="rowCountInfo" style="margin-left: auto; font-size: 12px; opacity: 0.8;"></span>
            </div>

            <div id="groupingPanel" class="grouping-panel" ondragover="onDragOverGroup(event)" ondragleave="onDragLeaveGroup(event)" ondrop="onDropGroup(event)">
                <span style="opacity: 0.5;">Drag headers here to group</span>
            </div>

            <div id="mainSplitView" class="main-split-view">
                <div id="gridContainer"></div>
                <div id="rowViewPanel" class="row-view-panel">
                    <div class="row-view-header">
                        <span>Row Details & Comparison</span>
                        <span class="row-view-close" onclick="toggleRowView()">\xD7</span>
                    </div>
                    <div id="rowViewContent" class="row-view-content">
                        <div class="row-view-placeholder">Select 1 or 2 rows to view details or compare</div>
                    </div>
                </div>
            </div>
            
            <script>
                const vscode = acquireVsCodeApi();
                window.sources = ${i.sourcesJson};
                window.pinnedSources = new Set(${i.pinnedSourcesJson});
                window.pinnedResults = ${i.pinnedResultsJson};
                window.activeSource = ${i.activeSourceJson};
                window.resultSets = ${i.resultSetsJson};
                
                let grids = [];
                let activeGridIndex = window.resultSets && window.resultSets.length > 0 ? window.resultSets.length - 1 : 0;
                const workerUri = "${a}";
            </script>
            <script src="${s}"></script>
            <script>
                // Initialize on load
                init();
            </script>
        </body>
        </html>`}};var P=U(require("vscode"));xe();var Oe=class{constructor(e,t){this.context=e;this.metadataCache=t}async provideCompletionItems(e,t,s,n){let i=e.getText(),a=this.stripComments(i),o=this.parseLocalDefinitions(a),r=e.lineAt(t).text.substr(0,t.character),p=r.toUpperCase(),l=t.line>0?e.lineAt(t.line-1).text:"",h=l.toUpperCase();if(/(FROM|JOIN)\s+$/.test(p)){let N=await this.getDatabases();return[...o.map($=>{let M=new P.CompletionItem($.name,P.CompletionItemKind.Class);return M.detail=$.type,M}),...N]}if(/(?:FROM|JOIN)\s*$/i.test(l)&&/^\s*[a-zA-Z0-9_]*$/.test(r)){let N=await this.getDatabases();return[...o.map($=>{let M=new P.CompletionItem($.name,P.CompletionItemKind.Class);return M.detail=$.type,M}),...N]}let x=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.\s*$/i);if(x){let N=x[1],O=await this.getSchemas(N);return new P.CompletionList(O,!1)}let m=r.match(/^\s*([a-zA-Z0-9_]+)\.\s*$/i);if(m&&/(?:FROM|JOIN)\s*$/i.test(l)){let N=m[1],O=await this.getSchemas(N);return new P.CompletionList(O,!1)}let v=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)\.$/i);if(v){let N=v[1],O=v[2];return this.getTables(N,O)}let b=r.match(/^\s*([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)\.\s*$/i);if(b&&/(?:FROM|JOIN)\s*$/i.test(l)){let N=b[1],O=b[2];return this.getTables(N,O)}let E=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.\.$/i);if(E){let N=E[1];return this.getTables(N,void 0)}let R=r.match(/^\s*([a-zA-Z0-9_]+)\.\.\s*$/i);if(R&&/(?:FROM|JOIN)\s*$/i.test(l)){let N=R[1];return this.getTables(N,void 0)}if(r.trim().endsWith(".")){let N=r.trim().split(/[\s.]+/),O=r.match(/([a-zA-Z0-9_]+)\.$/);if(O){let $=O[1],M=this.findAlias(a,$);if(M){let X=o.find(Q=>Q.name.toUpperCase()===M.table.toUpperCase());return X?X.columns.map(Q=>{let ae=new P.CompletionItem(Q,P.CompletionItemKind.Field);return ae.detail="Local Column",ae}):this.getColumns(M.db,M.schema,M.table)}let F=o.find(X=>X.name.toUpperCase()===$.toUpperCase());if(F)return F.columns.map(X=>{let Q=new P.CompletionItem(X,P.CompletionItemKind.Field);return Q.detail="Local Column",Q})}}return this.getKeywords()}stripComments(e){let t=e.replace(/--.*$/gm,"");return t=t.replace(/\/\*[\s\S]*?\*\//g,""),t}parseLocalDefinitions(e){let t=[],s=/CREATE\s+TABLE\s+([a-zA-Z0-9_]+)\s+AS\s*\(/gi,n;for(;(n=s.exec(e))!==null;){let o=n[1],r=n.index+n[0].length,p=this.extractBalancedParenthesisContent(e,r);if(p){let l=this.extractColumnsFromQuery(p);t.push({name:o,type:"Temp Table",columns:l})}}let i=/\bWITH\s+/gi;for(;(n=i.exec(e))!==null;){let o=n.index+n[0].length;for(;;){let r=/^\s*([a-zA-Z0-9_]+)\s+AS\s*\(/i,p=e.substring(o),l=p.match(r);if(!l)break;let h=l[1],x=o+l[0].length,m=this.extractBalancedParenthesisContent(e,o+l[0].length-1),v=p.indexOf("(",l.index+l[1].length),b=o+v,E=this.extractBalancedParenthesisContent(e,b+1);if(E){let R=this.extractColumnsFromQuery(E);t.push({name:h,type:"CTE",columns:R}),o=b+1+E.length+1;let N=/^\s*,/,O=e.substring(o);if(N.test(O)){let $=O.match(N);o+=$[0].length}else break}else break}}let a=/\bJOIN\s+\(/gi;for(;(n=a.exec(e))!==null;){let o=n.index+n[0].length,r=this.extractBalancedParenthesisContent(e,o);if(r&&/^\s*SELECT\b/i.test(r)){let p=o+r.length+1,h=e.substring(p).match(/^\s+(?:AS\s+)?([a-zA-Z0-9_]+)/i);if(h){let x=h[1],m=this.extractColumnsFromQuery(r);t.push({name:x,type:"Subquery",columns:m})}}}return t}extractBalancedParenthesisContent(e,t){let s=1,n=t;for(;n<e.length;n++)if(e[n]==="("?s++:e[n]===")"&&s--,s===0)return e.substring(t,n);return null}extractColumnsFromQuery(e){let t=e.match(/^\s*SELECT\s+/i);if(!t)return[];let s="",n=0,i=-1,a=t[0].length;for(let p=a;p<e.length;p++)if(e[p]==="("?n++:e[p]===")"&&n--,n===0&&e.substr(p).match(/^\s+FROM\b/i)){i=p;break}i!==-1?s=e.substring(a,i):s=e.substring(a);let o=[],r="";n=0;for(let p=0;p<s.length;p++){let l=s[p];l==="("?n++:l===")"&&n--,l===","&&n===0?(o.push(r.trim()),r=""):r+=l}return r.trim()&&o.push(r.trim()),o.map(p=>{let l=p.match(/\s+AS\s+([a-zA-Z0-9_]+)$/i);if(l)return l[1];let h=p.match(/\s+([a-zA-Z0-9_]+)$/i);if(h)return h[1];let x=p.split(".");return x[x.length-1]})}getKeywords(){return["SELECT","FROM","WHERE","GROUP BY","ORDER BY","LIMIT","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","DROP","TABLE","VIEW","DATABASE","JOIN","INNER","LEFT","RIGHT","OUTER","ON","AND","OR","NOT","NULL","IS","IN","BETWEEN","LIKE","AS","DISTINCT","CASE","WHEN","THEN","ELSE","END","WITH","UNION","ALL"].map(t=>{let s=new P.CompletionItem(t,P.CompletionItemKind.Keyword);return s.detail="SQL Keyword",s})}async getDatabases(){let e=this.metadataCache.getDatabases();if(e)return e.map(t=>{if(t instanceof P.CompletionItem)return t;let s=new P.CompletionItem(t.label,t.kind);return s.detail=t.detail,s});try{let s=await B(this.context,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0);if(!s)return[];let i=JSON.parse(s).map(a=>{let o=new P.CompletionItem(a.DATABASE,P.CompletionItemKind.Module);return o.detail="Database",o});return this.metadataCache.setDatabases(i),i}catch(t){return console.error(t),[]}}async getSchemas(e){let t=this.metadataCache.getSchemas(e);if(t)return t.map(n=>{if(n instanceof P.CompletionItem)return n;let i=new P.CompletionItem(n.label,n.kind);return i.detail=n.detail,i.insertText=n.insertText,i.sortText=n.sortText,i.filterText=n.filterText,i});let s=P.window.setStatusBarMessage(`Fetching schemas for ${e}...`);try{let n=`SELECT SCHEMA FROM ${e}.._V_SCHEMA ORDER BY SCHEMA`,i=await B(this.context,n,!0);if(!i)return[];let o=JSON.parse(i).filter(r=>r.SCHEMA!=null&&r.SCHEMA!=="").map(r=>{let p=r.SCHEMA,l=new P.CompletionItem(p,P.CompletionItemKind.Folder);return l.detail=`Schema in ${e}`,l.insertText=p,l.sortText=p,l.filterText=p,l});return this.metadataCache.setSchemas(e,o),o}catch(n){return console.error("[SqlCompletion] Error in getSchemas:",n),[]}finally{s.dispose()}}async getTables(e,t){let s=t?`${e}.${t}`:`${e}..`,n=this.metadataCache.getTables(s);if(n)return n.map(o=>{if(o instanceof P.CompletionItem)return o;let r=new P.CompletionItem(o.label,o.kind);return r.detail=o.detail,r.sortText=o.sortText,r});let i=t?`Fetching tables for ${e}.${t}...`:`Fetching tables for ${e}...`,a=P.window.setStatusBarMessage(i);try{let o="";t?o=`SELECT OBJNAME, OBJID FROM ${e}.._V_OBJECT_DATA WHERE UPPER(DBNAME) = UPPER('${e}') AND UPPER(SCHEMA) = UPPER('${t}') AND OBJTYPE='TABLE' ORDER BY OBJNAME`:o=`SELECT OBJNAME, OBJID, SCHEMA FROM ${e}.._V_OBJECT_DATA WHERE UPPER(DBNAME) = UPPER('${e}') AND OBJTYPE='TABLE' ORDER BY OBJNAME`;let r=await B(this.context,o,!0);if(!r)return[];let p=JSON.parse(r),l=new Map,h=p.map(x=>{let m=new P.CompletionItem(x.OBJNAME,P.CompletionItemKind.Class);m.detail=t?"Table":`Table (${x.SCHEMA})`,m.sortText=x.OBJNAME;let v=t?`${e}.${t}.${x.OBJNAME}`:`${e}..${x.OBJNAME}`;return l.set(v,x.OBJID),!t&&x.SCHEMA&&l.set(`${e}.${x.SCHEMA}.${x.OBJNAME}`,x.OBJID),m});return this.metadataCache.setTables(s,h,l),h}catch(o){return console.error(o),[]}finally{a.dispose()}}async getColumns(e,t,s){let n,i=e?`${e}..`:"",a=t&&e?`${e}.${t}.${s}`:e?`${e}..${s}`:void 0;a&&(n=this.metadataCache.findTableId(a));let o=`${e||"CURRENT"}.${t||""}.${s}`,r=this.metadataCache.getColumns(o);if(r)return r.map(l=>{if(l instanceof P.CompletionItem)return l;let h=new P.CompletionItem(l.label,l.kind);return h.detail=l.detail,h});let p=P.window.setStatusBarMessage(`Fetching columns for ${s}...`);try{let l="";if(n)l=`SELECT ATTNAME, FORMAT_TYPE FROM ${i}_V_RELATION_COLUMN WHERE OBJID = ${n} ORDER BY ATTNUM`;else{let v=t?`AND UPPER(O.SCHEMA) = UPPER('${t}')`:"",b=e?`AND UPPER(O.DBNAME) = UPPER('${e}')`:"";l=`
                    SELECT C.ATTNAME, C.FORMAT_TYPE 
                    FROM ${i}_V_RELATION_COLUMN C
                    JOIN ${i}_V_OBJECT_DATA O ON C.OBJID = O.OBJID
                    WHERE UPPER(O.OBJNAME) = UPPER('${s}') ${v} ${b}
                    ORDER BY C.ATTNUM
                `}let h=await B(this.context,l,!0);if(!h)return[];let m=JSON.parse(h).map(v=>{let b=new P.CompletionItem(v.ATTNAME,P.CompletionItemKind.Field);return b.detail=v.FORMAT_TYPE,b});if(this.metadataCache.setColumns(o,m),e){let v=this.context,b=this.metadataCache;setTimeout(async()=>{try{await b.prefetchColumnsForSchema(e,t,E=>B(v,E,!0))}catch(E){console.error("[SqlCompletion] Background column prefetch error:",E)}},100)}return m}catch(l){return console.error(l),[]}finally{p.dispose()}}findAlias(e,t){let s=new RegExp(`([a-zA-Z0-9_\\.]+) (?:AS\\s+)?${t}\\b`,"gi"),n=new Set(["SELECT","WHERE","GROUP","ORDER","HAVING","LIMIT","ON","AND","OR","NOT","CASE","WHEN","THEN","ELSE","END","JOIN","LEFT","RIGHT","INNER","OUTER","CROSS","FULL","UNION","EXCEPT","INTERSECT","FROM","UPDATE","DELETE","INSERT","INTO","VALUES","SET"]),i;for(;(i=s.exec(e))!==null;){let a=i[1];if(n.has(a.toUpperCase()))continue;let o=a.split(".");return o.length===3?{db:o[0],schema:o[1],table:o[2]}:o.length===2?{table:o[1],schema:o[0]}:{table:o[0]}}return null}};var $e=U(require("vscode"));xe();var Ce=class{constructor(e,t,s){this._extensionUri=e;this.context=t;this.metadataCache=s;this.currentSearchId=0}static{this.viewType="netezza.search"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage(async n=>{switch(n.type){case"search":await this.search(n.value);break;case"navigate":$e.commands.executeCommand("netezza.revealInSchema",n);break}})}async search(e){if(!e||e.length<2)return;let t=++this.currentSearchId,s=$e.window.setStatusBarMessage(`$(loading~spin) Searching for "${e}"...`),n=new Set;if(this._view){let r=this.metadataCache.search(e);if(r.length>0){let p=[];r.forEach(l=>{let h=`${l.name.toUpperCase().trim()}|${l.type.toUpperCase().trim()}|${(l.parent||"").toUpperCase().trim()}`;n.has(h)||(n.add(h),p.push({NAME:l.name,SCHEMA:l.schema,DATABASE:l.database,TYPE:l.type,PARENT:l.parent||"",DESCRIPTION:"Result from Cache",MATCH_TYPE:"NAME"}))}),p.length>0&&t===this.currentSearchId?this._view.webview.postMessage({type:"results",data:p,append:!1}):p.length===0&&t===this.currentSearchId&&this._view.webview.postMessage({type:"results",data:[],append:!1})}else t===this.currentSearchId&&this._view.webview.postMessage({type:"results",data:[],append:!1})}let a=`%${e.replace(/'/g,"''").toUpperCase()}%`,o=`
            SELECT OBJNAME AS NAME, SCHEMA, DBNAME AS DATABASE, OBJTYPE AS TYPE, '' AS PARENT, 
                   COALESCE(DESCRIPTION, '') AS DESCRIPTION, 'NAME' AS MATCH_TYPE
            FROM _V_OBJECT_DATA 
            WHERE UPPER(OBJNAME) LIKE '${a}'
            UNION ALL
            SELECT C.ATTNAME AS NAME, O.SCHEMA, O.DBNAME AS DATABASE, 'COLUMN' AS TYPE, O.OBJNAME AS PARENT,
                   COALESCE(C.DESCRIPTION, '') AS DESCRIPTION, 'NAME' AS MATCH_TYPE
            FROM _V_RELATION_COLUMN C
            JOIN _V_OBJECT_DATA O ON C.OBJID = O.OBJID
            WHERE UPPER(C.ATTNAME) LIKE '${a}'
            UNION ALL
            SELECT V.VIEWNAME AS NAME, V.SCHEMA, V.DATABASE, 'VIEW' AS TYPE, '' AS PARENT,
                   'Found in view definition' AS DESCRIPTION, 'DEFINITION' AS MATCH_TYPE
            FROM _V_VIEW V
            WHERE UPPER(V.DEFINITION) LIKE '${a}'
            UNION ALL
            SELECT P.PROCEDURE AS NAME, P.SCHEMA, P.DATABASE, 'PROCEDURE' AS TYPE, '' AS PARENT,
                   'Found in procedure source' AS DESCRIPTION, 'SOURCE' AS MATCH_TYPE
            FROM _V_PROCEDURE P
            WHERE UPPER(P.PROCEDURESOURCE) LIKE '${a}'
            ORDER BY TYPE, NAME
        `;try{let r=await B(this.context,o,!0);if(t!==this.currentSearchId){s.dispose();return}if(s.dispose(),this._view&&r){let p=JSON.parse(r);n.size>0&&(p=p.filter(l=>{let h=`${l.NAME.toUpperCase().trim()}|${l.TYPE.toUpperCase().trim()}|${(l.PARENT||"").toUpperCase().trim()}`;return n.has(h)?!1:(n.add(h),!0)})),p.length>0?this._view.webview.postMessage({type:"results",data:p,append:!0}):n.size}if(!this.metadataCache.hasAllObjectsPrefetchTriggered()){let p=this.context,l=this.metadataCache;setTimeout(async()=>{try{await l.prefetchAllObjects(h=>B(p,h,!0))}catch(h){console.error("[SchemaSearch] Background prefetch error:",h)}},500)}}catch(r){s.dispose(),this._view&&t===this.currentSearchId&&this._view.webview.postMessage({type:"error",message:r.message})}}_getHtmlForWebview(e){return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Schema Search</title>
            <style>
                body { font-family: var(--vscode-font-family); padding: 10px; color: var(--vscode-foreground); }
                .search-box { display: flex; gap: 5px; margin-bottom: 10px; }
                input { flex-grow: 1; padding: 5px; background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); }
                button { 
                    display: inline-flex; 
                    align-items: center; 
                    justify-content: center; 
                    gap: 6px; 
                    background-color: var(--vscode-button-secondaryBackground); 
                    color: var(--vscode-button-secondaryForeground); 
                    border: 1px solid var(--vscode-contrastBorder, transparent); 
                    padding: 4px 10px; 
                    cursor: pointer; 
                    border-radius: 2px; 
                    font-family: var(--vscode-font-family); 
                    font-size: 12px; 
                    line-height: 18px; 
                }
                button:hover { background-color: var(--vscode-button-secondaryHoverBackground); }
                button.primary { background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); }
                button.primary:hover { background-color: var(--vscode-button-hoverBackground); }
                .results { list-style: none; padding: 0; }
                .result-item { padding: 5px; border-bottom: 1px solid var(--vscode-panel-border); display: flex; flex-direction: column; cursor: pointer; position: relative; }
                .result-item:hover { background: var(--vscode-list-hoverBackground); }
                .item-header { display: flex; justify-content: space-between; font-weight: bold; }
                .item-details { font-size: 0.9em; opacity: 0.8; display: flex; gap: 10px; }
                .type-badge { font-size: 0.8em; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); padding: 2px 5px; border-radius: 3px; }
                .tooltip { position: absolute; background: var(--vscode-editorHoverWidget-background); color: var(--vscode-editorHoverWidget-foreground); border: 1px solid var(--vscode-editorHoverWidget-border); padding: 8px; border-radius: 4px; font-size: 0.9em; max-width: 300px; word-wrap: break-word; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; pointer-events: none; }
                .result-item:hover .tooltip { opacity: 1; visibility: visible; }
                .tooltip.top { bottom: 100%; left: 0; margin-bottom: 5px; }
                .tooltip.bottom { top: 100%; left: 0; margin-top: 5px; }
                .cache-badge { background-color: var(--vscode-charts-green); color: white; padding: 1px 4px; border-radius: 2px; font-size: 0.7em; margin-left: 5px; }
                .spinner {
                    border: 2px solid transparent;
                    border-top: 2px solid var(--vscode-progressBar-background); 
                    border-radius: 50%;
                    width: 14px;
                    height: 14px;
                    animation: spin 1s linear infinite;
                    display: inline-block;
                    vertical-align: middle;
                    margin-right: 8px;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        </head>
        <body>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search tables, columns, view definitions, procedure source..." />
                <button id="searchBtn" class="primary">Search</button>
            </div>
            <div id="status"></div>
            <ul class="results" id="resultsList"></ul>

            <script>
                const vscode = acquireVsCodeApi();
                const searchInput = document.getElementById('searchInput');
                const searchBtn = document.getElementById('searchBtn');
                const resultsList = document.getElementById('resultsList');
                const status = document.getElementById('status');

                searchBtn.addEventListener('click', () => {
                    const term = searchInput.value;
                    if (term) {
                        status.innerHTML = '<span class="spinner"></span> Searching...';
                        // Keep results until new ones come (or clear? we clear inside search handler if necessary or by postMessage)
                        // resultsList.innerHTML = ''; // Don't clear immediately, let the backend drive it
                        vscode.postMessage({ type: 'search', value: term });
                    }
                });

                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchBtn.click();
                    }
                });

                window.addEventListener('message', event => {
                    const message = event.data;
                    switch (message.type) {
                        case 'results':
                            status.textContent = '';
                            renderResults(message.data, message.append);
                            break;
                        case 'error':
                            status.textContent = 'Error: ' + message.message;
                            break;
                    }
                });

                function renderResults(data, append) {
                    if (!append) {
                        resultsList.innerHTML = '';
                    }

                    if (!data || data.length === 0) {
                        if (!append && resultsList.children.length === 0) {
                            status.textContent = 'No results found.';
                        }
                        return;
                    }
                    
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'result-item';
                        
                        const parentInfo = item.PARENT ? \`Parent: \${item.PARENT}\` : '';
                        const schemaInfo = item.SCHEMA ? \`Schema: \${item.SCHEMA}\` : '';
                        const databaseInfo = item.DATABASE ? \`Database: \${item.DATABASE}\` : '';
                        const description = item.DESCRIPTION && item.DESCRIPTION.trim() ? item.DESCRIPTION : '';
                        
                        // Add match type indicator
                        const matchTypeInfo = item.MATCH_TYPE === 'DEFINITION' ? 'Match in view definition' :
                                            item.MATCH_TYPE === 'SOURCE' ? 'Match in procedure source' :
                                            item.MATCH_TYPE === 'NAME' ? 'Match in name' : '';
                        
                        li.innerHTML = \`
                            <div class="item-header">
                                <span>\${item.NAME}</span>
                                <span class="type-badge">\${item.TYPE}</span>
                            </div>
                            <div class="item-details">
                                <span>\${databaseInfo}</span>
                                <span>\${schemaInfo}</span>
                                <span>\${parentInfo}</span>
                                \${matchTypeInfo ? \`<span style="font-style: italic; color: var(--vscode-descriptionForeground);">\${matchTypeInfo}</span>\` : ''}
                            </div>
                            \${description ? \`<div class="tooltip bottom">\${description}</div>\` : ''}
                        \`;
                        
                        // Add double-click handler to navigate to schema tree
                        li.addEventListener('dblclick', () => {
                            vscode.postMessage({ 
                                type: 'navigate', 
                                name: item.NAME,
                                schema: item.SCHEMA,
                                database: item.DATABASE,
                                objType: item.TYPE,
                                parent: item.PARENT
                            });
                        });
                        
                        resultsList.appendChild(li);
                    });
                }
            </script>
        </body>
        </html>`}};var ie=class{static splitStatements(e){let t=[],s="",n=!1,i=!1,a=!1,o=!1,r=0;for(;r<e.length;){let p=e[r],l=r+1<e.length?e[r+1]:"";if(a)p===`
`&&(a=!1);else if(o){if(p==="*"&&l==="/"){o=!1,s+=p+l,r++,r++;continue}}else if(n)p==="'"&&e[r-1]!=="\\"&&(n=!1);else if(i)p==='"'&&e[r-1]!=="\\"&&(i=!1);else if(p==="-"&&l==="-")a=!0;else if(p==="/"&&l==="*")o=!0;else if(p==="'")n=!0;else if(p==='"')i=!0;else if(p===";"){s.trim()&&t.push(s.trim()),s="",r++;continue}s+=p,r++}return s.trim()&&t.push(s.trim()),t}static getStatementAtPosition(e,t){let s=0,n=e.length,i=!1,a=!1,o=!1,r=!1,p=-1;for(let h=0;h<t;h++){let x=e[h],m=h+1<e.length?e[h+1]:"";o?x===`
`&&(o=!1):r?x==="*"&&m==="/"&&(r=!1,h++):i?x==="'"&&e[h-1]!=="\\"&&(i=!1):a?x==='"'&&e[h-1]!=="\\"&&(a=!1):x==="-"&&m==="-"?o=!0:x==="/"&&m==="*"?r=!0:x==="'"?i=!0:x==='"'?a=!0:x===";"&&(p=h)}s=p+1,i=!1,a=!1,o=!1,r=!1;for(let h=s;h<e.length;h++){let x=e[h],m=h+1<e.length?e[h+1]:"";if(o)x===`
`&&(o=!1);else if(r)x==="*"&&m==="/"&&(r=!1,h++);else if(i)x==="'"&&e[h-1]!=="\\"&&(i=!1);else if(a)x==='"'&&e[h-1]!=="\\"&&(a=!1);else if(x==="-"&&m==="-")o=!0;else if(x==="/"&&m==="*")r=!0;else if(x==="'")i=!0;else if(x==='"')a=!0;else if(x===";"){n=h;break}}let l=e.substring(s,n).trim();return l?{sql:l,start:s,end:n}:null}static getObjectAtPosition(e,t){let s=p=>/[a-zA-Z0-9_."]/i.test(p),n=t;for(;n>0&&s(e[n-1]);)n--;let i=t;for(;i<e.length&&s(e[i]);)i++;let a=e.substring(n,i);if(!a)return null;let o=p=>p?p.replace(/"/g,""):void 0;if(a.includes("..")){let p=a.split("..");if(p.length===2)return{database:o(p[0]),name:o(p[1])}}let r=a.split(".");return r.length===1?{name:o(r[0])}:r.length===2?{schema:o(r[0]),name:o(r[1])}:r.length===3?{database:o(r[0]),schema:o(r[1]),name:o(r[2])}:null}};var me=U(require("vscode"));var Le=class{provideDocumentLinks(e,t){let s=[],n=e.getText(),i=/[a-zA-Z0-9_"]+(\.[a-zA-Z0-9_"]*)+/g,a;for(;(a=i.exec(n))!==null;){let o=e.positionAt(a.index),r=e.positionAt(a.index+a[0].length),p=new me.Range(o,r),l=ie.getObjectAtPosition(n,a.index+Math.floor(a[0].length/2));if(l){if(a[0].split(".").length===2&&!l.database&&this.isLikelyAliasReference(n,a.index))continue;let m={name:l.name,schema:l.schema,database:l.database},v=me.Uri.parse(`command:netezza.revealInSchema?${encodeURIComponent(JSON.stringify(m))}`),b=new me.DocumentLink(p,v);b.tooltip=`Reveal ${l.name} in Schema`,s.push(b)}}return s}isLikelyAliasReference(e,t){let n=e.substring(Math.max(0,t-200),t).replace(/--[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").toUpperCase();return/(?:FROM|JOIN)\s+[a-zA-Z0-9_"]*$/i.test(n)?!1:!!n.match(/\b(SELECT|WHERE|ON|HAVING|ORDER\s+BY|GROUP\s+BY|AND|OR|SET|VALUES)\b(?!.*\b(?:FROM|JOIN)\b)/)}};var _e=U(require("vscode")),Pe=class{provideFoldingRanges(e,t,s){let n=[],i=[],a=/^\s*--\s*REGION\b/i,o=/^\s*--\s*ENDREGION\b/i;for(let r=0;r<e.lineCount;r++){let l=e.lineAt(r).text;if(a.test(l))i.push(r);else if(o.test(l)&&i.length>0){let h=i.pop();n.push(new _e.FoldingRange(h,r,_e.FoldingRangeKind.Region))}}return n}};var V=U(require("vscode"));Re();var be=class{constructor(e,t){this._extensionUri=e;this._context=t}static{this.viewType="netezza.queryHistory"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),this.sendHistoryToWebview(),e.webview.onDidReceiveMessage(async n=>{switch(n.type){case"refresh":this.refresh();break;case"clearAll":await this.clearAllHistory();break;case"deleteEntry":await this.deleteEntry(n.id,n.query);break;case"copyQuery":await V.env.clipboard.writeText(n.query),V.window.showInformationMessage("Query copied to clipboard");break;case"executeQuery":await this.executeQuery(n.query);break;case"getHistory":await this.sendHistoryToWebview();break;case"toggleFavorite":await this.toggleFavorite(n.id);break;case"updateEntry":await this.updateEntry(n.id,n.tags,n.description);break;case"requestEdit":await this.requestEdit(n.id);break;case"requestTagFilter":await this.requestTagFilter(n.tags);break;case"showFavoritesOnly":await this.sendFavoritesToWebview();break;case"filterByTag":await this.sendFilteredByTagToWebview(n.tag);break}})}refresh(){this._view&&this.sendHistoryToWebview()}async sendHistoryToWebview(){if(!this._view)return;let e=new j(this._context),t=await e.getHistory(),s=await e.getStats();console.log("QueryHistoryView: sending history to webview, entries=",t.length),this._view.webview.postMessage({type:"historyData",history:t,stats:s})}async clearAllHistory(){await V.window.showWarningMessage("Are you sure you want to clear all query history?",{modal:!0},"Clear All")==="Clear All"&&(await new j(this._context).clearHistory(),this.refresh(),V.window.showInformationMessage("Query history cleared"))}async deleteEntry(e,t){let s=t?`: ${t.substring(0,50)}${t.length>50?"...":""}`:"";await V.window.showWarningMessage(`Are you sure you want to delete this query${s}?`,{modal:!0},"Delete")==="Delete"&&(await new j(this._context).deleteEntry(e),this.refresh())}async executeQuery(e){let t=await V.workspace.openTextDocument({content:e,language:"sql"});await V.window.showTextDocument(t)}async toggleFavorite(e){await new j(this._context).toggleFavorite(e),this.refresh()}async updateEntry(e,t,s){await new j(this._context).updateEntry(e,t,s),this.refresh(),V.window.showInformationMessage("Entry updated successfully")}async requestEdit(e){let n=(await new j(this._context).getHistory()).find(o=>o.id===e);if(!n){V.window.showErrorMessage("Entry not found");return}let i=await V.window.showInputBox({prompt:"Enter tags (comma separated)",value:n.tags||"",placeHolder:"tag1, tag2, tag3"});if(i===void 0)return;let a=await V.window.showInputBox({prompt:"Enter description",value:n.description||"",placeHolder:"Description for this query"});a!==void 0&&await this.updateEntry(e,i,a)}async requestTagFilter(e){if(e.length===1)await this.sendFilteredByTagToWebview(e[0]);else if(e.length>1){let t=await V.window.showQuickPick(e,{placeHolder:"Filter by which tag?"});t&&await this.sendFilteredByTagToWebview(t)}}async sendFavoritesToWebview(){if(!this._view)return;let e=new j(this._context),t=await e.getFavorites(),s=await e.getStats();this._view.webview.postMessage({type:"historyData",history:t,stats:s,filter:"favorites"})}async sendFilteredByTagToWebview(e){if(!this._view)return;let t=new j(this._context),s=await t.getByTag(e),n=await t.getStats();this._view.webview.postMessage({type:"historyData",history:s,stats:n,filter:`tag: ${e}`})}_getHtmlForWebview(e){let t=Jt(),s=e.asWebviewUri(V.Uri.joinPath(this._extensionUri,"media","queryHistory.css")),n=e.asWebviewUri(V.Uri.joinPath(this._extensionUri,"media","queryHistory.js"));return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource}; script-src ${e.cspSource};">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query History</title>
    <link href="${s}" rel="stylesheet">
</head>
<body>
    <div class="toolbar">
        <div class="toolbar-top">
            <input type="search" id="searchInput" placeholder="Search queries..." />
            <span class="stats" id="stats">Loading...</span>
        </div>
        <div class="toolbar-buttons">
            <button class="secondary" id="showAllBtn">\u{1F4DC} All</button>
            <button class="secondary" id="showFavoritesBtn">\u2B50 Favorites</button>
            <button class="secondary" id="refreshBtn">\u21BB Refresh</button>
            <button class="secondary" id="clearAllBtn">\u{1F5D1}\uFE0F Clear All</button>
        </div>
    </div>
    <div class="history-container" id="historyContainer">
        <div class="empty-state">
            <div class="empty-state-icon">\u{1F4DC}</div>
            <div>No query history yet</div>
        </div>
    </div>

    <script src="${n}"></script>
</body>
</html>`}};function Jt(){let d="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)d+=e.charAt(Math.floor(Math.random()*e.length));return d}var Be=class{constructor(e){this.context=e;this.schemaCache=new Map;this.tableCache=new Map;this.columnCache=new Map;this.tableIdMap=new Map;this.CACHE_TTL=14400*1e3;this.savePending=!1;this.pendingCacheTypes=new Set;this.columnPrefetchInProgress=new Set;this.allObjectsPrefetchTriggered=!1;this.loadCacheFromWorkspaceState()}loadCacheFromWorkspaceState(){try{let e=Date.now(),t=this.context.workspaceState.get("sqlCompletion.dbCache");t&&e-t.timestamp<this.CACHE_TTL&&(this.dbCache=t);let s=this.context.workspaceState.get("sqlCompletion.schemaCache");if(s)for(let[o,r]of Object.entries(s))e-r.timestamp<this.CACHE_TTL&&this.schemaCache.set(o,r);let n=this.context.workspaceState.get("sqlCompletion.tableCache");if(n)for(let[o,r]of Object.entries(n))e-r.timestamp<this.CACHE_TTL&&this.tableCache.set(o,r);let i=this.context.workspaceState.get("sqlCompletion.tableIdMap");if(i)for(let[o,r]of Object.entries(i))(this.tableCache.has(o)||e-r.timestamp<this.CACHE_TTL)&&this.tableIdMap.set(o,{data:new Map(Object.entries(r.data)),timestamp:r.timestamp});let a=this.context.workspaceState.get("sqlCompletion.columnCache");if(a)for(let[o,r]of Object.entries(a))e-r.timestamp<this.CACHE_TTL&&this.columnCache.set(o,r)}catch(e){console.error("[MetadataCache] Error loading cache from workspace state:",e)}}scheduleSave(e){this.pendingCacheTypes.add(e),this.savePending||(this.savePending=!0,this.saveTimeoutId=setTimeout(()=>this.flushSave(),1e3))}async flushSave(){this.savePending=!1;let e=new Set(this.pendingCacheTypes);this.pendingCacheTypes.clear();try{if(e.has("db")&&this.dbCache&&await this.context.workspaceState.update("sqlCompletion.dbCache",this.dbCache),e.has("schema")&&this.schemaCache.size>0){let t={};this.schemaCache.forEach((s,n)=>{t[n]=s}),await this.context.workspaceState.update("sqlCompletion.schemaCache",t)}if(e.has("table")&&this.tableCache.size>0){let t={};this.tableCache.forEach((n,i)=>{t[i]=n}),await this.context.workspaceState.update("sqlCompletion.tableCache",t);let s={};this.tableIdMap.forEach((n,i)=>{let a={};n.data.forEach((o,r)=>{a[r]=o}),s[i]={data:a,timestamp:n.timestamp}}),await this.context.workspaceState.update("sqlCompletion.tableIdMap",s)}if(e.has("column")&&this.columnCache.size>0){let t={};this.columnCache.forEach((s,n)=>{t[n]=s}),await this.context.workspaceState.update("sqlCompletion.columnCache",t)}}catch(t){console.error("[MetadataCache] Error saving cache to workspace state:",t)}}async clearCache(){this.saveTimeoutId&&(clearTimeout(this.saveTimeoutId),this.saveTimeoutId=void 0),this.savePending=!1,this.pendingCacheTypes.clear(),this.dbCache=void 0,this.schemaCache.clear(),this.tableCache.clear(),this.columnCache.clear(),this.tableIdMap.clear(),await this.context.workspaceState.update("sqlCompletion.dbCache",void 0),await this.context.workspaceState.update("sqlCompletion.schemaCache",void 0),await this.context.workspaceState.update("sqlCompletion.tableCache",void 0),await this.context.workspaceState.update("sqlCompletion.columnCache",void 0),await this.context.workspaceState.update("sqlCompletion.tableIdMap",void 0)}getDatabases(){return this.dbCache?.data}setDatabases(e){this.dbCache={data:e,timestamp:Date.now()},this.scheduleSave("db")}getSchemas(e){return this.schemaCache.get(e)?.data}setSchemas(e,t){this.schemaCache.set(e,{data:t,timestamp:Date.now()}),this.scheduleSave("schema")}getTables(e){return this.tableCache.get(e)?.data}setTables(e,t,s){let n=Date.now();this.tableCache.set(e,{data:t,timestamp:n}),this.tableIdMap.set(e,{data:s,timestamp:n}),this.scheduleSave("table")}getColumns(e){return this.columnCache.get(e)?.data}setColumns(e,t){this.columnCache.set(e,{data:t,timestamp:Date.now()}),this.scheduleSave("column")}findTableId(e){for(let t of this.tableIdMap.values()){let s=t.data.get(e);if(s!==void 0)return s}}search(e){let t=[],s=e.toLowerCase();for(let[n,i]of this.tableCache){let a=n.split("."),o=a[0],r=a.length>1?a[1]:void 0;for(let p of i.data){let l=typeof p.label=="string"?p.label:p.label.label;l&&l.toLowerCase().includes(s)&&t.push({name:l,type:"TABLE",database:o,schema:r||(p.detail&&p.detail.includes("(")?p.detail.match(/\((.*?)\)/)?.[1]:void 0)})}}for(let[n,i]of this.columnCache){let a=n.split("."),o=a[0],r=a[1],p=a[2];for(let l of i.data){let h=typeof l.label=="string"?l.label:l.label.label;h&&h.toLowerCase().includes(s)&&t.push({name:h,type:"COLUMN",database:o,schema:r,parent:p})}}return t}async prefetchColumnsForSchema(e,t,s){let n=t?`${e}.${t}`:`${e}..`;if(this.columnPrefetchInProgress.has(n))return;let i=this.getTables(n);if(!(!i||i.length===0)){this.columnPrefetchInProgress.add(n),console.log(`[MetadataCache] Starting background column prefetch for ${n}`);try{let a=[];for(let r of i){let p=typeof r.label=="string"?r.label:r.label?.label;if(!p)continue;let l=`${e}.${t||""}.${p}`;this.getColumns(l)||a.push(p)}if(a.length===0){console.log(`[MetadataCache] All columns already cached for ${n}`);return}console.log(`[MetadataCache] Fetching columns for ${a.length} tables in ${n}`);let o=10;for(let r=0;r<a.length;r+=o){let l=a.slice(r,r+o).map(v=>`'${v}'`).join(","),h=`${e}..`,x=t?`AND UPPER(O.SCHEMA) = UPPER('${t}')`:"",m=`
                    SELECT O.OBJNAME AS TABLENAME, C.ATTNAME, C.FORMAT_TYPE, C.ATTNUM
                    FROM ${h}_V_RELATION_COLUMN C
                    JOIN ${h}_V_OBJECT_DATA O ON C.OBJID = O.OBJID
                    WHERE UPPER(O.OBJNAME) IN (${l.toUpperCase()}) 
                    ${x}
                    AND UPPER(O.DBNAME) = UPPER('${e}')
                    ORDER BY O.OBJNAME, C.ATTNUM
                `;try{let v=await s(m);if(v){let b=JSON.parse(v),E=new Map;for(let R of b){let N=R.TABLENAME;E.has(N)||E.set(N,[]),E.get(N).push({label:R.ATTNAME,kind:5,detail:R.FORMAT_TYPE})}for(let[R,N]of E){let O=`${e}.${t||""}.${R}`;this.setColumns(O,N)}}}catch(v){console.error("[MetadataCache] Error fetching batch columns:",v)}}console.log(`[MetadataCache] Completed background column prefetch for ${n}`)}finally{this.columnPrefetchInProgress.delete(n)}}}async prefetchAllObjects(e){if(!this.allObjectsPrefetchTriggered){this.allObjectsPrefetchTriggered=!0,console.log("[MetadataCache] Starting background prefetch of all objects for search");try{let s=await e(`
                SELECT OBJNAME, OBJID, SCHEMA, DBNAME 
                FROM _V_OBJECT_DATA 
                WHERE OBJTYPE = 'TABLE' 
                ORDER BY DBNAME, SCHEMA, OBJNAME
            `);if(!s)return;let n=JSON.parse(s),i=new Map;for(let a of n){let o=a.SCHEMA?`${a.DBNAME}.${a.SCHEMA}`:`${a.DBNAME}..`;i.has(o)||i.set(o,{tables:[],idMap:new Map});let r=i.get(o);r.tables.push({label:a.OBJNAME,kind:7,detail:a.SCHEMA?"Table":`Table (${a.SCHEMA})`,sortText:a.OBJNAME});let p=a.SCHEMA?`${a.DBNAME}.${a.SCHEMA}.${a.OBJNAME}`:`${a.DBNAME}..${a.OBJNAME}`;r.idMap.set(p,a.OBJID)}for(let[a,o]of i)this.getTables(a)||this.setTables(a,o.tables,o.idMap);console.log(`[MetadataCache] Prefetched tables for ${i.size} schema(s)`)}catch(t){console.error("[MetadataCache] Error in prefetchAllObjects:",t)}}}hasAllObjectsPrefetchTriggered(){return this.allObjectsPrefetchTriggered}};var Pt=U(require("path"));function Lt(d,e){let t=e.getKeepConnectionOpen();d.text=t?"\u{1F517} Keep Connection ON":"\u26D3\uFE0F\u200D\u{1F4A5} Keep Connection OFF",d.tooltip=t?"Keep Connection Open: ENABLED - Click to disable":"Keep Connection Open: DISABLED - Click to enable",d.backgroundColor=t?new c.ThemeColor("statusBarItem.prominentBackground"):void 0}function gn(d){console.log("Netezza extension: Activating..."),d.subscriptions.push({dispose:()=>{e.closeAllPersistentConnections()}});let e=new de(d),t=new Be(d),s=new ye(d,e,t),n=new ve(d.extensionUri),i=c.window.createStatusBarItem(c.StatusBarAlignment.Left,100);i.command="netezza.selectConnectionForTab",i.tooltip="Click to select connection for this SQL tab",d.subscriptions.push(i);let a=()=>{let u=c.window.activeTextEditor;if(u&&u.document.languageId==="sql"){let g=u.document.uri.toString(),f=e.getConnectionForExecution(g);f?(i.text=`$(database) ${f}`,i.show()):(i.text="$(database) Select Connection",i.show())}else i.hide()};a(),e.onDidChangeActiveConnection(a),e.onDidChangeConnections(a),e.onDidChangeDocumentConnection(a),c.window.onDidChangeActiveTextEditor(a);let o=c.window.createStatusBarItem(c.StatusBarAlignment.Right,100);o.command="netezza.toggleKeepConnectionOpen",Lt(o,e),o.show(),d.subscriptions.push(o),console.log("Netezza extension: Registering SchemaSearchProvider...");let r=new Ce(d.extensionUri,d,t);console.log("Netezza extension: Registering QueryHistoryView...");let p=new be(d.extensionUri,d),l=c.window.createTreeView("netezza.schema",{treeDataProvider:s,showCollapseAll:!0});d.subscriptions.push(c.window.registerWebviewViewProvider(ve.viewType,n),c.window.registerWebviewViewProvider(Ce.viewType,r),c.window.registerWebviewViewProvider(be.viewType,p));let h=/(^|\s)(?:[A-Za-z]:\\|\\|\/)?[\w.\-\\\/]+\.py\b|(^|\s)python(?:\.exe)?\s+[^\n]*\.py\b/i;function x(u){return u&&(u.includes(" ")?`"${u.replace(/"/g,'\\"')}"`:u)}function m(u,g,f){let w=/[ \\/]/.test(u)?`& ${x(u)}`:u,C=x(g),S=f.map(y=>x(y)).join(" ");return`${w} ${C}${S?" "+S:""}`.trim()}class v{constructor(){this._onDidChange=new c.EventEmitter;this.onDidChangeCodeLenses=this._onDidChange.event}provideCodeLenses(g){let f=[];for(let T=0;T<g.lineCount;T++){let w=g.lineAt(T);if(h.test(w.text)){let C=w.range,S={title:"Run as script",command:"netezza.runScriptFromLens",arguments:[g.uri,C]};f.push(new c.CodeLens(C,S))}}return f}refresh(){this._onDidChange.fire()}}let b=new v;d.subscriptions.push(c.languages.registerCodeLensProvider({scheme:"file"},b));let E=c.window.createTextEditorDecorationType({backgroundColor:new c.ThemeColor("editor.rangeHighlightBackground"),borderRadius:"3px"});function R(u){let g=u||c.window.activeTextEditor;if(!g)return;let f=g.document,T=[];for(let w=0;w<f.lineCount;w++){let C=f.lineAt(w);h.test(C.text)&&T.push({range:C.range,hoverMessage:"Python script invocation"})}g.setDecorations(E,T)}d.subscriptions.push(c.window.onDidChangeActiveTextEditor(()=>R()),c.workspace.onDidChangeTextDocument(u=>{c.window.activeTextEditor&&u.document===c.window.activeTextEditor.document&&R(c.window.activeTextEditor)})),d.subscriptions.push(c.commands.registerCommand("netezza.runScriptFromLens",async(u,g)=>{try{let f=await c.workspace.openTextDocument(u),T=f.getText(g).trim()||f.lineAt(g.start.line).text.trim();if(!T){c.window.showWarningMessage("No script command found");return}let w=T.split(/\s+/),C=w[0]||"",S=/python(\\.exe)?$/i.test(C)&&w.length>=2&&w[1].toLowerCase().endsWith(".py"),y=C.toLowerCase().endsWith(".py"),I=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",D="";if(S){let z=w[0],q=w[1],J=w.slice(2);D=m(z,q,J)}else if(y){let z=C,q=w.slice(1);D=m(I,z,q)}else D=m(I,"",w);let L=c.window.createTerminal({name:"Netezza: Script"});L.show(!0),L.sendText(D,!0),c.window.showInformationMessage(`Running script: ${D}`)}catch(f){c.window.showErrorMessage(`Error running script: ${f.message}`)}})),R(c.window.activeTextEditor),d.subscriptions.push(c.window.onDidChangeActiveTextEditor(u=>{if(u&&u.document){let g=u.document.uri.toString();n.setActiveSource(g)}})),d.subscriptions.push(c.commands.registerCommand("netezza.toggleKeepConnectionOpen",()=>{let u=e.getKeepConnectionOpen();e.setKeepConnectionOpen(!u),Lt(o,e);let g=!u;c.window.showInformationMessage(g?"Keep connection open: ENABLED - connection will remain open after queries":"Keep connection open: DISABLED - connection will be closed after each query")}),c.commands.registerCommand("netezza.selectActiveConnection",async()=>{let u=await e.getConnections();if(u.length===0){c.window.showWarningMessage("No connections configured. Please connect first.");return}let g=await c.window.showQuickPick(u.map(f=>f.name),{placeHolder:"Select Active Connection"});g&&(await e.setActiveConnection(g),c.window.showInformationMessage(`Active connection set to: ${g}`))}),c.commands.registerCommand("netezza.selectConnectionForTab",async()=>{let u=c.window.activeTextEditor;if(!u||u.document.languageId!=="sql"){c.window.showWarningMessage("This command is only available for SQL files");return}let g=await e.getConnections();if(g.length===0){c.window.showWarningMessage("No connections configured. Please connect first.");return}let f=u.document.uri.toString(),T=e.getDocumentConnection(f)||e.getActiveConnectionName(),w=g.map(S=>({label:S.name,description:T===S.name?"$(check) Currently selected":`${S.host}:${S.port}/${S.database}`,detail:(T===S.name,void 0),name:S.name})),C=await c.window.showQuickPick(w,{placeHolder:"Select connection for this SQL tab"});C&&(e.setDocumentConnection(f,C.name),c.window.showInformationMessage(`Connection for this tab set to: ${C.name}`))}),c.commands.registerCommand("netezza.openLogin",()=>{Ne.createOrShow(d.extensionUri,e)}),c.commands.registerCommand("netezza.refreshSchema",()=>{s.refresh(),c.window.showInformationMessage("Schema refreshed")}),c.commands.registerCommand("netezza.copySelectAll",u=>{if(u&&u.label&&u.dbName&&u.schema){let g=`SELECT * FROM ${u.dbName}.${u.schema}.${u.label} LIMIT 100;`;c.env.clipboard.writeText(g),c.window.showInformationMessage("Copied to clipboard")}}),c.commands.registerCommand("netezza.copyDrop",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType){let g=`${u.dbName}.${u.schema}.${u.label}`,f=`DROP ${u.objType} ${g};`;if(await c.window.showWarningMessage(`Are you sure you want to delete ${u.objType.toLowerCase()} "${g}"?`,{modal:!0},"Yes, delete","Cancel")==="Yes, delete")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Deleting ${u.objType.toLowerCase()} ${g}...`,cancellable:!1},async C=>{await B(d,f,!0,u.connectionName,e)}),c.window.showInformationMessage(`Deleted ${u.objType.toLowerCase()}: ${g}`),s.refresh()}catch(w){c.window.showErrorMessage(`Error during deletion: ${w.message}`)}}}),c.commands.registerCommand("netezza.copyName",u=>{if(u&&u.label&&u.dbName&&u.schema){let g=`${u.dbName}.${u.schema}.${u.label}`;c.env.clipboard.writeText(g),c.window.showInformationMessage("Copied to clipboard")}}),c.commands.registerCommand("netezza.grantPermissions",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType){let g=`${u.dbName}.${u.schema}.${u.label}`,f=await c.window.showQuickPick([{label:"SELECT",description:"Privileges to read data"},{label:"INSERT",description:"Privileges to insert data"},{label:"UPDATE",description:"Privileges to update data"},{label:"DELETE",description:"Privileges to delete data"},{label:"ALL",description:"All privileges (SELECT, INSERT, UPDATE, DELETE)"},{label:"LIST",description:"Privileges to list objects"}],{placeHolder:"Select privilege type"});if(!f)return;let T=await c.window.showInputBox({prompt:"Enter user or group name",placeHolder:"e.g. SOME_USER or GROUP_NAME",validateInput:S=>!S||S.trim().length===0?"User/group name cannot be empty":/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(S.trim())?null:"Invalid user/group name"});if(!T)return;let w=`GRANT ${f.label} ON ${g} TO ${T.trim().toUpperCase()};`;if(await c.window.showInformationMessage(`Execute: ${w}`,{modal:!0},"Yes, execute","Cancel")==="Yes, execute")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Granting ${f.label} on ${g}...`,cancellable:!1},async y=>{await B(d,w,!0,u.connectionName,e)}),c.window.showInformationMessage(`Granted ${f.label} on ${g} to ${T.trim().toUpperCase()}`)}catch(S){c.window.showErrorMessage(`Error granting privileges: ${S.message}`)}}}),c.commands.registerCommand("netezza.groomTable",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType==="TABLE"){let g=`${u.dbName}.${u.schema}.${u.label}`,f=await c.window.showQuickPick([{label:"RECORDS ALL",description:"Groom all records (reclaim space from deleted rows)"},{label:"RECORDS READY",description:"Groom only ready records"},{label:"PAGES ALL",description:"Groom all pages (reorganize data pages)"},{label:"PAGES START",description:"Groom pages from start"},{label:"VERSIONS",description:"Groom versions (clean up old row versions)"}],{placeHolder:"Select GROOM mode"});if(!f)return;let T=await c.window.showQuickPick([{label:"DEFAULT",description:"Use default backupset",value:"DEFAULT"},{label:"NONE",description:"No backupset",value:"NONE"},{label:"Custom",description:"Specify custom backupset ID",value:"CUSTOM"}],{placeHolder:"Select RECLAIM BACKUPSET option"});if(!T)return;let w=T.value;if(T.value==="CUSTOM"){let y=await c.window.showInputBox({prompt:"Enter backupset ID",placeHolder:"np. 12345",validateInput:A=>!A||A.trim().length===0?"Backupset ID cannot be empty":/^\d+$/.test(A.trim())?null:"Backupset ID must be a number"});if(!y)return;w=y.trim()}let C=`GROOM TABLE ${g} ${f.label} RECLAIM BACKUPSET ${w};`;if(await c.window.showWarningMessage(`Execute GROOM on table "${g}"?

${C}

Warning: This operation may be time-consuming for large tables.`,{modal:!0},"Yes, execute","Cancel")==="Yes, execute")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}let A=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:`GROOM TABLE ${g} (${f.label})...`,cancellable:!1},async D=>{await B(d,C,!0,u.connectionName,e)});let I=((Date.now()-A)/1e3).toFixed(1);c.window.showInformationMessage(`GROOM completed successfully (${I}s): ${g}`)}catch(y){c.window.showErrorMessage(`Error during GROOM: ${y.message}`)}}}),c.commands.registerCommand("netezza.addTableComment",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType==="TABLE"){let g=`${u.dbName}.${u.schema}.${u.label}`,f=await c.window.showInputBox({prompt:"Enter comment for table",placeHolder:"e.g. Table contains customer data",value:u.objectDescription||""});if(f===void 0)return;let T=`COMMENT ON TABLE ${g} IS '${f.replace(/'/g,"''")}';`;try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await B(d,T,!0,u.connectionName,e),c.window.showInformationMessage(`Comment added to table: ${g}`),s.refresh()}catch(w){c.window.showErrorMessage(`Error adding comment: ${w.message}`)}}}),c.commands.registerCommand("netezza.generateStatistics",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType==="TABLE"){let g=`${u.dbName}.${u.schema}.${u.label}`,f=`GENERATE EXPRESS STATISTICS ON ${g};`;if(await c.window.showInformationMessage(`Generate statistics for table "${g}"?

${f}`,{modal:!0},"Yes, generate","Cancel")==="Yes, generate")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}let C=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Generating statistics for ${g}...`,cancellable:!1},async y=>{await B(d,f,!0,u.connectionName,e)});let S=((Date.now()-C)/1e3).toFixed(1);c.window.showInformationMessage(`Statistics generated successfully (${S}s): ${g}`)}catch(w){c.window.showErrorMessage(`Error generating statistics: ${w.message}`)}}}),c.commands.registerCommand("netezza.truncateTable",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType==="TABLE"){let g=`${u.dbName}.${u.schema}.${u.label}`,f=`TRUNCATE TABLE ${g};`;if(await c.window.showWarningMessage(`\u26A0\uFE0F WARNING: Are you sure you want to delete ALL data from the table "${g}"?

${f}

This operation is IRREVERSIBLE!`,{modal:!0},"Yes, delete all data","Cancel")==="Yes, delete all data")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Clearing table ${g}...`,cancellable:!1},async C=>{await B(d,f,!0,u.connectionName,e)}),c.window.showInformationMessage(`Table cleared: ${g}`)}catch(w){c.window.showErrorMessage(`Error clearing table: ${w.message}`)}}}),c.commands.registerCommand("netezza.addPrimaryKey",async u=>{if(u&&u.label&&u.dbName&&u.schema&&u.objType==="TABLE"){let g=`${u.dbName}.${u.schema}.${u.label}`,f=await c.window.showInputBox({prompt:"Enter primary key constraint name",placeHolder:`e.g. PK_${u.label}`,value:`PK_${u.label}`,validateInput:y=>!y||y.trim().length===0?"Constraint name cannot be empty":/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(y.trim())?null:"Invalid constraint name"});if(!f)return;let T=await c.window.showInputBox({prompt:"Enter primary key column names (comma separated)",placeHolder:"e.g. COL1, COL2 or ID",validateInput:y=>!y||y.trim().length===0?"You must provide at least one column":null});if(!T)return;let w=T.split(",").map(y=>y.trim().toUpperCase()).join(", "),C=`ALTER TABLE ${g} ADD CONSTRAINT ${f.trim().toUpperCase()} PRIMARY KEY (${w});`;if(await c.window.showInformationMessage(`Add primary key to table "${g}"?

${C}`,{modal:!0},"Yes, add","Cancel")==="Yes, add")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Adding primary key to ${g}...`,cancellable:!1},async A=>{await B(d,C,!0,u.connectionName,e)}),c.window.showInformationMessage(`Primary key added: ${f.trim().toUpperCase()}`),s.refresh()}catch(y){c.window.showErrorMessage(`Error adding primary key: ${y.message}`)}}}),c.commands.registerCommand("netezza.createDDL",async u=>{try{if(!u||!u.label||!u.dbName||!u.schema||!u.objType){c.window.showErrorMessage("Invalid object selected for DDL generation");return}let g=await e.getConnectionString();if(!g){c.window.showErrorMessage("Connection not configured. Please connect via Netezza: Connect...");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Generating DDL for ${u.objType} ${u.label}...`,cancellable:!1},async()=>{let{generateDDL:f}=await Promise.resolve().then(()=>(wt(),ft)),T=await f(g,u.dbName,u.schema,u.label,u.objType);if(T.success&&T.ddlCode){let w=await c.window.showQuickPick([{label:"Open in Editor",description:"Open DDL code in a new editor",value:"editor"},{label:"Copy to Clipboard",description:"Copy DDL code to clipboard",value:"clipboard"}],{placeHolder:"How would you like to access the DDL code?"});if(w)if(w.value==="editor"){let C=await c.workspace.openTextDocument({content:T.ddlCode,language:"sql"});await c.window.showTextDocument(C),c.window.showInformationMessage(`DDL code generated for ${u.objType} ${u.label}`)}else w.value==="clipboard"&&(await c.env.clipboard.writeText(T.ddlCode),c.window.showInformationMessage("DDL code copied to clipboard"))}else throw new Error(T.error||"DDL generation failed")})}catch(g){c.window.showErrorMessage(`Error generating DDL: ${g.message}`)}}),c.commands.registerCommand("netezza.revealInSchema",async u=>{let g=c.window.setStatusBarMessage(`$(loading~spin) Revealing ${u.name} in schema...`);try{let f=u.connectionName;if(f||(f=e.getActiveConnectionName()),!f){g.dispose(),c.window.showWarningMessage("No active connection. Please select a connection first.");return}if(!await e.getConnectionString(f)){g.dispose(),c.window.showWarningMessage("Not connected to database");return}let w=u.name,C=u.objType,S=C?[C]:["TABLE","VIEW","EXTERNAL TABLE","PROCEDURE","FUNCTION","SEQUENCE","SYNONYM"];if(C==="COLUMN"){if(!u.parent){g.dispose(),c.window.showWarningMessage("Cannot find column without parent table");return}w=u.parent}if(u.database&&u.schema&&(C==="TABLE"||!C)){let A=`${u.database}.${u.schema}.${w}`,I=t.findTableId(A);if(I!==void 0){let{SchemaItem:D}=await Promise.resolve().then(()=>(Me(),Ve)),L=new D(w,c.TreeItemCollapsibleState.Collapsed,"netezza:TABLE",u.database,"TABLE",u.schema,I,void 0,f);await l.reveal(L,{select:!0,focus:!0,expand:!0}),g.dispose(),c.window.setStatusBarMessage(`$(check) Found ${w} in ${u.database}.${u.schema} (cached)`,3e3);return}}let y=[];if(u.database)y=[u.database];else{let A=await e.getCurrentDatabase(f);if(A)y=[A];else{let I=await B(d,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0,f,e);if(!I){g.dispose();return}y=JSON.parse(I).map(L=>L.DATABASE)}}for(let A of y)try{let I=C==="COLUMN"?["TABLE","VIEW","EXTERNAL TABLE"]:S;for(let D of I){let L=`SELECT OBJNAME, OBJTYPE, SCHEMA, OBJID FROM ${A}.._V_OBJECT_DATA WHERE UPPER(OBJNAME) = UPPER('${w.replace(/'/g,"''")}') AND UPPER(OBJTYPE) = UPPER('${D}') AND DBNAME = '${A}'`;u.schema&&(L+=` AND UPPER(SCHEMA) = UPPER('${u.schema.replace(/'/g,"''")}')`);let z=await B(d,L,!0,f,e);if(z){let q=JSON.parse(z);if(q.length>0){let J=q[0],{SchemaItem:K}=await Promise.resolve().then(()=>(Me(),Ve)),le=new K(J.OBJNAME,c.TreeItemCollapsibleState.Collapsed,`netezza:${J.OBJTYPE}`,A,J.OBJTYPE,J.SCHEMA,J.OBJID,void 0,f);await l.reveal(le,{select:!0,focus:!0,expand:!0}),g.dispose(),c.window.setStatusBarMessage(`$(check) Found ${w} in ${A}.${J.SCHEMA}`,3e3);return}}}}catch(I){console.log(`Error searching in ${A}:`,I)}g.dispose(),c.window.showWarningMessage(`Could not find ${C||"object"} ${w}`)}catch(f){g.dispose(),c.window.showErrorMessage(`Error revealing item: ${f.message}`)}}),c.commands.registerCommand("netezza.showQueryHistory",()=>{c.commands.executeCommand("netezza.queryHistory.focus")}),c.commands.registerCommand("netezza.clearQueryHistory",async()=>{let{QueryHistoryManager:u}=await Promise.resolve().then(()=>(Re(),rt)),g=new u(d);await c.window.showWarningMessage("Are you sure you want to clear all query history?",{modal:!0},"Clear All")==="Clear All"&&(await g.clearHistory(),p.refresh(),c.window.showInformationMessage("Query history cleared"))})),d.subscriptions.push(c.languages.registerDocumentLinkProvider({language:"sql"},new Le)),d.subscriptions.push(c.languages.registerFoldingRangeProvider({language:"sql"},new Pe)),d.subscriptions.push(c.commands.registerCommand("netezza.jumpToSchema",async()=>{let u=c.window.activeTextEditor;if(!u)return;let g=u.document,f=u.selection,T=g.offsetAt(f.active),w=ie.getObjectAtPosition(g.getText(),T);w?c.commands.executeCommand("netezza.revealInSchema",w):c.window.showWarningMessage("No object found at cursor")}));let N=c.commands.registerCommand("netezza.runQuery",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.document,f=u.selection,T=g.getText(),w=g.uri.toString(),C=[];if(f.isEmpty){let y=g.offsetAt(f.active),A=ie.getStatementAtPosition(T,y);if(A){C=[A.sql];let I=g.positionAt(A.start),D=g.positionAt(A.end);u.selection=new c.Selection(I,D)}else{c.window.showWarningMessage("No SQL statement found at cursor");return}}else{let y=g.getText(f);if(!y.trim()){c.window.showWarningMessage("No SQL query selected");return}C=ie.splitStatements(y)}if(C.length===0)return;let S=C.length===1?C[0].trim():null;if(S){let y=S.split(/\s+/),A=y[0]||"",I=/python(\.exe)?$/i.test(A)&&y.length>=2&&y[1].toLowerCase().endsWith(".py"),D=A.toLowerCase().endsWith(".py");if(I||D){let z=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",q="";if(I){let K=y[0],le=y[1],Ft=y.slice(2);q=m(K,le,Ft)}else{let K=A,le=y.slice(1);q=m(z,K,le)}let J=c.window.createTerminal({name:"Netezza: Script"});J.show(!0),J.sendText(q,!0),c.window.showInformationMessage(`Running script: ${q}`);return}}try{let y=await Je(d,C,e,w);n.updateResults(y,w,!1),c.commands.executeCommand("netezza.results.focus")}catch(y){c.window.showErrorMessage(`Error executing query: ${y.message}`)}}),O=c.commands.registerCommand("netezza.runQueryBatch",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.document,f=u.selection,T=g.uri.toString(),w;if(f.isEmpty?w=g.getText():w=g.getText(f),!w.trim()){c.window.showWarningMessage("No SQL query to execute");return}let S=w.trim().split(/\s+/),y=S[0]||"",A=/python(\.exe)?$/i.test(y)&&S.length>=2&&S[1].toLowerCase().endsWith(".py"),I=y.toLowerCase().endsWith(".py");if(A||I){let L=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",z="";if(A){let J=S[0],K=S[1],le=S.slice(2);z=m(J,K,le)}else{let J=y,K=S.slice(1);z=m(L,J,K)}let q=c.window.createTerminal({name:"Netezza: Script"});q.show(!0),q.sendText(z,!0),c.window.showInformationMessage(`Running script: ${z}`);return}try{let{runQueryRaw:D}=await Promise.resolve().then(()=>(xe(),xt)),L=await D(d,w,!1,e,void 0,T);L&&(n.updateResults([L],T,!1),c.commands.executeCommand("netezza.results.focus"))}catch(D){c.window.showErrorMessage(`Error executing query: ${D.message}`)}});d.subscriptions.push(O);let $=c.window.createOutputChannel("Netezza"),M=(u,g)=>{let f=Date.now()-g;$.appendLine(`[${new Date().toLocaleTimeString()}] ${u} completed in ${f}ms`),$.show(!0)},F=c.commands.registerCommand("netezza.exportToXlsb",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.selection,f=g.isEmpty?u.document.getText():u.document.getText(g);if(!f.trim()){c.window.showWarningMessage("No SQL query to export");return}let T=await c.window.showSaveDialog({filters:{"Excel Binary Workbook":["xlsb"]},saveLabel:"Export to XLSB"});if(!T)return;let w=Date.now();try{let C=u.document.uri.toString(),S=e.getConnectionForExecution(C),y=await e.getConnectionString(S);if(!y)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSB...",cancellable:!1},async A=>{let{exportQueryToXlsb:I}=await Promise.resolve().then(()=>(he(),pe)),D=await I(y,f,T.fsPath,!1,L=>{A.report({message:L}),$.appendLine(`[XLSB Export] ${L}`)});if(!D.success)throw new Error(D.message)}),M("Export to XLSB",w),c.window.showInformationMessage(`Results exported to ${T.fsPath}`)}catch(C){c.window.showErrorMessage(`Error exporting to XLSB: ${C.message}`)}}),X=c.commands.registerCommand("netezza.exportToCsv",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.selection,f=g.isEmpty?u.document.getText():u.document.getText(g);if(!f.trim()){c.window.showWarningMessage("No SQL query to export");return}let T=await c.window.showSaveDialog({filters:{"CSV Files":["csv"]},saveLabel:"Export to CSV"});if(!T)return;let w=Date.now();try{let C=u.document.uri.toString(),S=e.getConnectionForExecution(C),y=await e.getConnectionString(S);if(!y)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to CSV...",cancellable:!1},async A=>{let{exportToCsv:I}=await Promise.resolve().then(()=>(Dt(),Rt));await I(d,y,f,T.fsPath,A)}),M("Export to CSV",w),c.window.showInformationMessage(`Results exported to ${T.fsPath}`)}catch(C){c.window.showErrorMessage(`Error exporting to CSV: ${C.message}`)}}),Q=c.commands.registerCommand("netezza.copyXlsbToClipboard",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.selection,f=g.isEmpty?u.document.getText():u.document.getText(g);if(!f.trim()){c.window.showWarningMessage("No SQL query to export");return}try{let T=u.document.uri.toString(),w=e.getConnectionForExecution(T),C=await e.getConnectionString(w);if(!C)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let S=Date.now();if(await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSB and copying to clipboard...",cancellable:!1},async A=>{let{exportQueryToXlsb:I,getTempFilePath:D}=await Promise.resolve().then(()=>(he(),pe)),L=D(),z=await I(C,f,L,!0,q=>{A.report({message:q}),$.appendLine(`[XLSB Clipboard] ${q}`)});if(!z.success)throw new Error(z.message);if(!z.details?.clipboard_success)throw new Error("Failed to copy file to clipboard")}),M("Copy XLSB to Clipboard",S),await c.window.showInformationMessage("Excel file copied to clipboard! You can now paste it into Excel or Windows Explorer.","Show Temp Folder","OK")==="Show Temp Folder"){let A=require("os").tmpdir();await c.env.openExternal(c.Uri.file(A))}}catch(T){c.window.showErrorMessage(`Error copying XLSB to clipboard: ${T.message}`)}}),ae=c.commands.registerCommand("netezza.exportToXlsbAndOpen",async()=>{let u=c.window.activeTextEditor;if(!u){c.window.showErrorMessage("No active editor found");return}let g=u.selection,f=g.isEmpty?u.document.getText():u.document.getText(g);if(!f.trim()){c.window.showWarningMessage("No SQL query to export");return}let T=await c.window.showSaveDialog({filters:{"Excel Binary Workbook":["xlsb"]},saveLabel:"Export to XLSB and Open"});if(!T)return;let w=Date.now();try{let C=u.document.uri.toString(),S=e.getConnectionForExecution(C),y=await e.getConnectionString(S);if(!y)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSB and opening...",cancellable:!1},async A=>{let{exportQueryToXlsb:I}=await Promise.resolve().then(()=>(he(),pe)),D=await I(y,f,T.fsPath,!1,L=>{A.report({message:L}),$.appendLine(`[XLSB Export] ${L}`)});if(!D.success)throw new Error(D.message)}),M("Export to XLSB and Open",w),await c.env.openExternal(T),c.window.showInformationMessage(`Results exported and opened: ${T.fsPath}`)}catch(C){c.window.showErrorMessage(`Error exporting to XLSB: ${C.message}`)}}),ke=c.commands.registerCommand("netezza.importClipboard",async()=>{try{let g=c.window.activeTextEditor?.document?.uri?.toString(),f=e.getConnectionForExecution(g),T=await e.getConnectionString(f);if(!T)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let w=await c.window.showInputBox({prompt:"Enter target table name (leave empty for auto-generated name)",placeHolder:"e.g. my_schema.my_table or leave empty",validateInput:A=>!A||A.trim().length===0||/^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)?(\.[a-zA-Z_][a-zA-Z0-9_]*)?$/.test(A.trim())?null:"Invalid table name format. Use: [database.]schema.table"});if(w===void 0)return;let C;if(!w||w.trim().length===0)try{let I=await B(d,"SELECT CURRENT_CATALOG, CURRENT_SCHEMA",!0);if(I){let D=JSON.parse(I);if(D&&D.length>0){let L=D[0].CURRENT_CATALOG||"SYSTEM",z=D[0].CURRENT_SCHEMA||"ADMIN",J=new Date().toISOString().slice(0,10).replace(/-/g,""),K=Math.floor(Math.random()*1e4).toString().padStart(4,"0");C=`${L}.${z}.IMPORT_${J}_${K}`,c.window.showInformationMessage(`Auto-generated table name: ${C}`)}else throw new Error("Could not determine current database/schema")}else throw new Error("Could not determine current database/schema")}catch(A){c.window.showErrorMessage(`Error getting current database/schema: ${A.message}`);return}else C=w.trim();let S=await c.window.showQuickPick([{label:"Auto-detect",description:"Automatically detect clipboard format (text or Excel XML)",value:null},{label:"Excel XML Spreadsheet",description:"Force Excel XML format processing",value:"XML Spreadsheet"},{label:"Plain Text",description:"Force plain text processing with delimiter detection",value:"TEXT"}],{placeHolder:"Select clipboard data format"});if(!S)return;let y=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Importing clipboard data...",cancellable:!1},async A=>{let{importClipboardDataToNetezza:I}=await Promise.resolve().then(()=>($t(),Ot)),D=await I(C,T,S.value,{},L=>{A.report({message:L}),$.appendLine(`[Clipboard Import] ${L}`)});if(!D.success)throw new Error(D.message);D.details&&($.appendLine(`[Clipboard Import] Rows processed: ${D.details.rowsProcessed}`),$.appendLine(`[Clipboard Import] Columns: ${D.details.columns}`),$.appendLine(`[Clipboard Import] Format: ${D.details.format}`))}),M("Import Clipboard Data",y),c.window.showInformationMessage(`Clipboard data imported successfully to table: ${C}`)}catch(u){c.window.showErrorMessage(`Error importing clipboard data: ${u.message}`)}}),W=c.commands.registerCommand("netezza.importData",async()=>{try{let u=await e.getConnectionString();if(!u)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let g=await c.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{"Data Files":["csv","txt","xlsx","xlsb","json"],"CSV Files":["csv"],"Excel Files":["xlsx","xlsb"],"Text Files":["txt"],"JSON Files":["json"],"All Files":["*"]},openLabel:"Select file to import"});if(!g||g.length===0)return;let f=g[0].fsPath,T=await c.window.showInputBox({prompt:"Enter target table name (leave empty for auto-generated name)",placeHolder:"e.g. my_schema.my_table or leave empty",validateInput:y=>!y||y.trim().length===0||/^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)?(\.[a-zA-Z_][a-zA-Z0-9_]*)?$/.test(y.trim())?null:"Invalid table name format. Use: [database.]schema.table"});if(T===void 0)return;let w;if(!T||T.trim().length===0)try{let A=await B(d,"SELECT CURRENT_CATALOG, CURRENT_SCHEMA",!0);if(A){let I=JSON.parse(A);if(I&&I.length>0){let D=I[0].CURRENT_CATALOG||"SYSTEM",L=I[0].CURRENT_SCHEMA||"ADMIN",q=new Date().toISOString().slice(0,10).replace(/-/g,""),J=Math.floor(Math.random()*1e4).toString().padStart(4,"0");w=`${D}.${L}.IMPORT_${q}_${J}`,c.window.showInformationMessage(`Auto-generated table name: ${w}`)}else throw new Error("Could not determine current database/schema")}else throw new Error("Could not determine current database/schema")}catch(y){c.window.showErrorMessage(`Error getting current database/schema: ${y.message}`);return}else w=T.trim();let C=await c.window.showQuickPick([{label:"Default Import",description:"Use default settings",value:{}},{label:"Custom Options",description:"Configure import settings (coming soon)",value:null}],{placeHolder:"Select import options"});if(!C)return;if(C.value===null){c.window.showInformationMessage("Custom options will be available in future version");return}let S=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Importing data...",cancellable:!1},async y=>{let{importDataToNetezza:A}=await Promise.resolve().then(()=>(et(),Nt)),I=await A(f,w,u,C.value||{},D=>{y.report({message:D}),$.appendLine(`[Import] ${D}`)});if(!I.success)throw new Error(I.message);I.details&&($.appendLine(`[Import] Rows processed: ${I.details.rowsProcessed}`),$.appendLine(`[Import] Columns: ${I.details.columns}`),$.appendLine(`[Import] Delimiter: ${I.details.detectedDelimiter}`))}),M("Import Data",S),c.window.showInformationMessage(`Data imported successfully to table: ${w}`)}catch(u){c.window.showErrorMessage(`Error importing data: ${u.message}`)}}),ce=c.commands.registerCommand("netezza.exportCurrentResultToXlsbAndOpen",async(u,g)=>{try{if(!u){c.window.showErrorMessage("No data to export");return}let f=require("os"),T=require("path"),w=new Date().toISOString().replace(/[:.]/g,"-"),C=T.join(f.tmpdir(),`netezza_results_${w}.xlsb`),S=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Creating Excel file...",cancellable:!1},async A=>{let{exportCsvToXlsb:I}=await Promise.resolve().then(()=>(he(),pe)),D=await I(u,C,!1,{source:"Query Results Panel",sql:g},L=>{A.report({message:L}),$.appendLine(`[CSV to XLSB] ${L}`)});if(!D.success)throw new Error(D.message)});let y=Date.now()-S;$.appendLine(`[${new Date().toLocaleTimeString()}] Export Current Result to Excel completed in ${y}ms`),await c.env.openExternal(c.Uri.file(C)),c.window.showInformationMessage(`Results exported and opened: ${C}`)}catch(f){c.window.showErrorMessage(`Error exporting to Excel: ${f.message}`)}}),G=c.commands.registerCommand("netezza.copyCurrentResultToXlsbClipboard",async(u,g)=>{try{if(!u){c.window.showErrorMessage("No data to copy");return}let{getTempFilePath:f}=await Promise.resolve().then(()=>(he(),pe)),T=f(),w=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Copying to clipboard as Excel...",cancellable:!1},async S=>{let{exportCsvToXlsb:y}=await Promise.resolve().then(()=>(he(),pe)),A=await y(u,T,!0,{source:"Query Results Panel",sql:g},I=>{S.report({message:I}),$.appendLine(`[CSV to Clipboard] ${I}`)});if(!A.success)throw new Error(A.message);if(!A.details?.clipboard_success)throw new Error("Failed to copy file to clipboard")});let C=Date.now()-w;$.appendLine(`[${new Date().toLocaleTimeString()}] Copy Current Result to Clipboard completed in ${C}ms`),c.window.showInformationMessage("Results copied to clipboard as Excel table! You can paste in Excel or Explorer.")}catch(f){c.window.showErrorMessage(`Error copying to clipboard: ${f.message}`)}});d.subscriptions.push(N),d.subscriptions.push(F),d.subscriptions.push(X),d.subscriptions.push(Q),d.subscriptions.push(ae),d.subscriptions.push(ce),d.subscriptions.push(G),d.subscriptions.push(ke),d.subscriptions.push(W);let st=c.workspace.onWillSaveTextDocument(async u=>{}),He=c.commands.registerCommand("netezza.smartPaste",async()=>{try{let u=c.window.activeTextEditor;if(!u)return;let f=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",T=Pt.join(d.extensionPath,"python","check_clipboard_format.py"),w=require("child_process");if(await new Promise(S=>{let y=w.spawn(f,[T]);y.on("close",A=>{S(A===1)}),y.on("error",()=>{S(!1)})})){let S=await c.window.showQuickPick([{label:"\u{1F4CA} import to Netezza table",description:'Detected "XML Spreadsheet" format - import data to database',value:"import"},{label:"\u{1F4DD} Paste as text",description:"Paste clipboard content as plain text",value:"paste"}],{placeHolder:'Detected "XML Spreadsheet" format in clipboard - choose an action'});if(S?.value==="import")c.commands.executeCommand("netezza.importClipboard");else if(S?.value==="paste"){let y=await c.env.clipboard.readText(),A=u.selection;await u.edit(I=>{I.replace(A,y)})}}else{let S=await c.env.clipboard.readText(),y=u.selection;await u.edit(A=>{A.replace(y,S)})}}catch(u){c.window.showErrorMessage(`Error during paste: ${u.message}`)}}),_t=c.workspace.onDidChangeTextDocument(async u=>{if(u.document.languageId!=="sql"&&u.document.languageId!=="mssql"||u.contentChanges.length!==1)return;let g=u.contentChanges[0];if(g.text!==" ")return;let f=c.window.activeTextEditor;if(!f||f.document!==u.document)return;let w=u.document.lineAt(g.range.start.line).text,C=new Map([["SX","SELECT"],["WX","WHERE"],["GX","GROUP BY"],["HX","HAVING"],["OX","ORDER BY"],["FX","FROM"],["JX","JOIN"],["LX","LIMIT"],["IX","INSERT INTO"],["UX","UPDATE"],["DX","DELETE FROM"],["CX","CREATE TABLE"]]);for(let[S,y]of C)if(new RegExp(`\\b${S}\\s$`,"i").test(w)){let I=w.toUpperCase().lastIndexOf(S.toUpperCase());if(I>=0){let D=new c.Position(g.range.start.line,I),L=new c.Position(g.range.start.line,I+S.length+1);await f.edit(z=>{z.replace(new c.Range(D,L),y+" ")}),["SELECT","FROM","JOIN"].includes(y)&&setTimeout(()=>{c.commands.executeCommand("editor.action.triggerSuggest")},100);break}}});d.subscriptions.push(He),d.subscriptions.push(_t);let Bt=new Oe(d,t);d.subscriptions.push(c.languages.registerCompletionItemProvider(["sql","mssql"],Bt,"."," ")),d.subscriptions.push(c.commands.registerCommand("netezza.clearAutocompleteCache",async()=>{await c.window.showWarningMessage("Are you sure you want to clear the autocomplete cache? This will remove all cached databases, schemas, tables, and columns.",{modal:!0},"Clear Cache")==="Clear Cache"&&(await t.clearCache(),c.window.showInformationMessage("Autocomplete cache cleared successfully. Cache will be rebuilt on next use."))}))}function fn(){}0&&(module.exports={activate,deactivate});
