"use strict";var St=Object.create;var Ae=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var It=Object.getPrototypeOf,Dt=Object.prototype.hasOwnProperty;var ee=(l,e)=>()=>(l&&(e=l(l=0)),e);var te=(l,e)=>{for(var t in e)Ae(l,t,{get:e[t],enumerable:!0})},Ze=(l,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Rt(e))!Dt.call(l,n)&&n!==t&&Ae(l,n,{get:()=>e[n],enumerable:!(s=At(e,n))||s.enumerable});return l};var P=(l,e,t)=>(t=l!=null?St(It(l)):{},Ze(e||!l||!l.__esModule?Ae(t,"default",{value:l,enumerable:!0}):t,l)),Nt=l=>Ze(Ae({},"__esModule",{value:!0}),l);var le,He=ee(()=>{"use strict";le=class l{constructor(e){this.context=e;this._connectionDetails=null;this._persistentConnection=null;this._keepConnectionOpen=!1;this._lastConnectionString=null}static{this.SERVICE_NAME="netezza-vscode"}async saveConnection(e){this._connectionDetails=e,await this.context.secrets.store(l.SERVICE_NAME,JSON.stringify(e))}async getConnection(){if(this._connectionDetails)return this._connectionDetails;let e=await this.context.secrets.get(l.SERVICE_NAME);return e?(this._connectionDetails=JSON.parse(e),this._connectionDetails):null}async getConnectionString(){let e=await this.getConnection();return e?`DRIVER={NetezzaSQL};SERVER=${e.host};PORT=${e.port};DATABASE=${e.database};UID=${e.user};PWD=${e.password};`:null}async getCurrentDatabase(){return(await this.getConnection())?.database||null}setKeepConnectionOpen(e){this._keepConnectionOpen=e,e||this.closePersistentConnection()}getKeepConnectionOpen(){return this._keepConnectionOpen}async getPersistentConnection(){let e=await this.getConnectionString();if(!e)throw new Error("Connection not configured. Please connect via Netezza: Connect...");if(this._lastConnectionString!==e||!this._persistentConnection){this.closePersistentConnection();try{let t=require("odbc");this._persistentConnection=await t.connect({connectionString:e,fetchArray:!0}),this._lastConnectionString=e}catch(t){throw this._persistentConnection=null,this._lastConnectionString=null,t}}return this._persistentConnection}closePersistentConnection(){if(this._persistentConnection){try{this._persistentConnection.close()}catch(e){console.error("Error closing persistent connection:",e)}this._persistentConnection=null,this._lastConnectionString=null}}}});var et={};te(et,{QueryHistoryManager:()=>J});var de,Re,J,Ie=ee(()=>{"use strict";de=P(require("fs")),Re=P(require("path")),J=class l{constructor(e){this.context=e;this.cache=[];this.initialized=!1;this.initialize()}static{this.STORAGE_KEY="queryHistory"}static{this.MAX_ENTRIES=5e4}static{this.CLEANUP_KEEP=4e4}static{this.STORAGE_VERSION=1}async initialize(){try{let e=this.context.globalState.get(l.STORAGE_KEY);e&&e.entries?(this.cache=e.entries,console.log(`\u2705 Loaded ${this.cache.length} entries from VS Code storage`)):await this.migrateFromLegacyStorage(),this.initialized=!0}catch(e){console.error("\u274C Error initializing query history:",e),this.cache=[],this.initialized=!0}}async migrateFromLegacyStorage(){try{let e=this.context.globalStorageUri.fsPath,t=Re.join(e,"query-history.db");de.existsSync(t)&&(console.log("\u26A0\uFE0F SQLite database found but migration not implemented"),console.log("\u{1F4A1} Consider manually exporting data before switching"));let s=Re.join(e,"query-history.json");if(de.existsSync(s)){let a=de.readFileSync(s,"utf8");if(a.trim()){let i=JSON.parse(a);this.cache=i,await this.saveToStorage(),console.log(`\u2705 Migrated ${i.length} entries from JSON`)}}let n=Re.join(e,"query-history-archive.json");if(de.existsSync(n)){let a=de.readFileSync(n,"utf8");if(a.trim()){let i=JSON.parse(a);this.cache.push(...i),await this.saveToStorage(),console.log(`\u2705 Migrated archive with ${i.length} entries`)}}}catch(e){console.error("Error during migration:",e)}}async saveToStorage(){try{let e={entries:this.cache,version:l.STORAGE_VERSION};await this.context.globalState.update(l.STORAGE_KEY,e)}catch(e){console.error("Error saving to storage:",e)}}async addEntry(e,t,s,n,a,i){try{this.initialized||await this.initialize();let o=`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,r=Date.now(),p={id:o,host:e,database:t,schema:s,query:n.trim(),timestamp:r,is_favorite:!1,tags:a||"",description:i||""};this.cache.unshift(p),this.cache.length>l.MAX_ENTRIES&&(this.cache=this.cache.slice(0,l.CLEANUP_KEEP),console.log(`Cleaned up old entries, keeping ${l.CLEANUP_KEEP} newest`)),await this.saveToStorage()}catch(o){console.error("Error adding query to history:",o)}}async getHistory(){return this.initialized||await this.initialize(),[...this.cache]}async deleteEntry(e){try{this.cache=this.cache.filter(t=>t.id!==e),await this.saveToStorage()}catch(t){console.error("Error deleting entry:",t)}}async clearHistory(){try{this.cache=[],await this.saveToStorage(),console.log("All query history cleared")}catch(e){console.error("Error clearing history:",e)}}async getStats(){try{let e=this.cache.length,t=JSON.stringify(this.cache).length,s=parseFloat((t/(1024*1024)).toFixed(2));return{activeEntries:e,archivedEntries:0,totalEntries:e,activeFileSizeMB:s,archiveFileSizeMB:0,totalFileSizeMB:s}}catch(e){return console.error("Error getting stats:",e),{activeEntries:0,archivedEntries:0,totalEntries:0,activeFileSizeMB:0,archiveFileSizeMB:0,totalFileSizeMB:0}}}async toggleFavorite(e){try{let t=this.cache.find(s=>s.id===e);t&&(t.is_favorite=!t.is_favorite,await this.saveToStorage())}catch(t){console.error("Error toggling favorite:",t)}}async updateEntry(e,t,s){try{let n=this.cache.find(a=>a.id===e);n&&(t!==void 0&&(n.tags=t),s!==void 0&&(n.description=s),await this.saveToStorage())}catch(n){console.error("Error updating entry:",n)}}async getFavorites(){return this.initialized||await this.initialize(),this.cache.filter(e=>e.is_favorite)}async getByTag(e){return this.initialized||await this.initialize(),this.cache.filter(t=>t.tags?.toLowerCase().includes(e.toLowerCase()))}async getAllTags(){this.initialized||await this.initialize();let e=new Set;return this.cache.forEach(t=>{t.tags&&t.tags.split(",").forEach(n=>{let a=n.trim();a&&e.add(a)})}),Array.from(e).sort()}async searchAll(e){this.initialized||await this.initialize();let t=e.toLowerCase();return this.cache.filter(s=>s.query.toLowerCase().includes(t)||s.host.toLowerCase().includes(t)||s.database.toLowerCase().includes(t)||s.schema.toLowerCase().includes(t)||s.tags?.toLowerCase().includes(t)||s.description?.toLowerCase().includes(t))}async getFilteredHistory(e,t,s,n){this.initialized||await this.initialize();let a=this.cache.filter(i=>!(e&&i.host!==e||t&&i.database!==t||s&&i.schema!==s));return n&&(a=a.slice(0,n)),a}async getArchivedHistory(){return[]}async clearArchive(){}close(){console.log("Query history manager closed")}}});var at={};te(at,{runQueriesSequentially:()=>Xe,runQuery:()=>x,runQueryRaw:()=>it});function tt(l){let e=l.match(/SERVER=([^;]+)/i),t=l.match(/DATABASE=([^;]+)/i);return{host:e?e[1]:"unknown",database:t?t[1]:"unknown"}}function nt(l){let e=new Set;if(!l)return e;for(let t of l.matchAll(/\$\{([A-Za-z0-9_]+)\}/g))t[1]&&e.add(t[1]);return e}function st(l){if(!l)return{sql:"",setValues:{}};let e=l.split(/\r?\n/),t=[],s={};for(let n of e){let a=n.match(/^\s*@SET\s+([A-Za-z0-9_]+)\s*=\s*(.+)$/i);if(a){let i=a[2].trim();i.endsWith(";")&&(i=i.slice(0,-1).trim());let o=i.match(/^'(.*)'$/s)||i.match(/^"(.*)"$/s);o&&(i=o[1]),s[a[1]]=i}else t.push(n)}return{sql:t.join(`
`),setValues:s}}async function ot(l,e,t){let s={};if(l.size===0)return s;if(e){let a=Array.from(l).filter(i=>!(t&&t[i]!==void 0));if(a.length>0)throw new Error("Query contains variables but silent mode is enabled; cannot prompt for values. Missing: "+a.join(", "));for(let i of l)s[i]=t[i];return s}let n=[];for(let a of l)t&&t[a]!==void 0?s[a]=t[a]:n.push(a);for(let a of n){let i=await De.window.showInputBox({prompt:`Enter value for ${a}`,placeHolder:"",value:t&&t[a]?t[a]:void 0,ignoreFocusOut:!0});if(i===void 0)throw new Error("Variable input cancelled by user");s[a]=i}return s}function rt(l,e){return l.replace(/\$\{([A-Za-z0-9_]+)\}/g,(t,s)=>e[s]??"")}async function it(l,e,t=!1,s){if(!Ee)throw new Error("odbc package not installed. Please run: npm install odbc");let n=s||new le(l),a=n.getKeepConnectionOpen(),i;t||(i=De.window.createOutputChannel("Netezza SQL"),i.show(!0),i.appendLine("Executing query..."));try{let o=st(e),r=o.sql,p=o.setValues,u=nt(r);if(u.size>0){let v=await ot(u,t,p);r=rt(r,v)}let h,f=!0,m;if(a){h=await n.getPersistentConnection(),f=!1;let v=await n.getConnectionString();if(!v)throw new Error("Connection not configured. Please connect via Netezza: Connect...");m=v}else{let v=await n.getConnectionString();if(!v)throw new Error("Connection not configured. Please connect via Netezza: Connect...");m=v,h=await Ee.connect({connectionString:m,fetchArray:!0})}try{let v=await h.query(r),b="unknown";try{let A=await h.query("SELECT CURRENT_SCHEMA");A&&A.length>0&&(b=A[0].CURRENT_SCHEMA||"unknown")}catch(A){console.debug("Could not retrieve current schema:",A)}let N=tt(m);if(new J(l).addEntry(N.host,N.database,b,e).catch(A=>{console.error("Failed to log query to history:",A)}),v&&Array.isArray(v)){let A=v.columns?v.columns.map(I=>({name:I.name,type:I.dataType})):[];return i&&i.appendLine("Query completed."),{columns:A,data:v,rowsAffected:v.count}}else return i&&i.appendLine("Query executed successfully (no results)."),{columns:[],data:[],rowsAffected:v?.count,message:"Query executed successfully (no results)."}}finally{f&&await h.close()}}catch(o){let r=ke(o);throw i&&i.appendLine(r),new Error(r)}}async function x(l,e,t=!1){try{let s=await it(l,e,t);if(s.data&&s.data.length>0){let n=s.data.map(i=>{let o={};return s.columns.forEach((r,p)=>{o[r.name]=i[p]}),o});return JSON.stringify(n,(i,o)=>typeof o=="bigint"?o>=Number.MIN_SAFE_INTEGER&&o<=Number.MAX_SAFE_INTEGER?Number(o):o.toString():o,2)}else if(s.message)return s.message;return}catch(s){throw s}}async function Xe(l,e,t){if(!Ee)throw new Error("odbc package not installed. Please run: npm install odbc");let s=t||new le(l),n=s.getKeepConnectionOpen(),a=De.window.createOutputChannel("Netezza SQL");a.show(!0),a.appendLine(`Executing ${e.length} queries sequentially...`);let i=[];try{let o,r=!0,p;if(n){o=await s.getPersistentConnection(),r=!1;let u=await s.getConnectionString();if(!u)throw new Error("Connection not configured. Please connect via Netezza: Connect...");p=u}else{let u=await s.getConnectionString();if(!u)throw new Error("Connection not configured. Please connect via Netezza: Connect...");p=u,o=await Ee.connect({connectionString:p,fetchArray:!0})}try{let u="unknown";try{let m=await o.query("SELECT CURRENT_SCHEMA");m&&m.length>0&&(u=m[0].CURRENT_SCHEMA||"unknown")}catch(m){console.debug("Could not retrieve current schema:",m)}let h=tt(p),f=new J(l);for(let m=0;m<e.length;m++){let v=e[m];a.appendLine(`Executing query ${m+1}/${e.length}...`);try{let b=st(v),N=b.sql,L=b.setValues,A=nt(N);if(A.size>0){let _=await ot(A,!1,L);N=rt(N,_)}let I=await o.query(N);if(f.addEntry(h.host,h.database,u,v).catch(_=>{console.error("Failed to log query to history:",_)}),I&&Array.isArray(I)){let _=I.columns?I.columns.map(F=>({name:F.name,type:F.dataType})):[];i.push({columns:_,data:I,rowsAffected:I.count})}else i.push({columns:[],data:[],rowsAffected:I?.count,message:"Query executed successfully"})}catch(b){let N=ke(b);throw a.appendLine(`Error in query ${m+1}: ${N}`),new Error(N)}}a.appendLine("All queries completed.")}finally{r&&await o.close()}}catch(o){let r=ke(o);throw a.appendLine(r),new Error(r)}return i}function ke(l){return l.odbcErrors&&Array.isArray(l.odbcErrors)&&l.odbcErrors.length>0?l.odbcErrors.map(e=>`[ODBC Error] State: ${e.state}, Native Code: ${e.code}
Message: ${e.message}`).join(`

`):`Error: ${l.message||l}`}var De,Ee,pe=ee(()=>{"use strict";De=P(require("vscode"));He();Ie();try{Ee=require("odbc")}catch{console.error("odbc package not installed. Run: npm install odbc")}});var ct={};te(ct,{SchemaItem:()=>K,SchemaProvider:()=>we});var $,we,K,We=ee(()=>{"use strict";$=P(require("vscode"));pe();we=class{constructor(e,t,s){this.context=e;this.connectionManager=t;this.metadataCache=s;this._onDidChangeTreeData=new $.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getParent(e){if(e.contextValue!=="database"){if(e.contextValue==="typeGroup")return new K(e.dbName,$.TreeItemCollapsibleState.Collapsed,"database",e.dbName);if(e.contextValue.startsWith("netezza:"))return new K(e.objType,$.TreeItemCollapsibleState.Collapsed,"typeGroup",e.dbName,e.objType);if(e.contextValue==="column")return}}async getChildren(e){if(!await this.connectionManager.getConnectionString())return[];if(e){if(e.contextValue==="database")try{let s=`SELECT DISTINCT OBJTYPE FROM ${e.dbName}.._V_OBJECT_DATA WHERE DBNAME = '${e.dbName}' ORDER BY OBJTYPE`,n=await x(this.context,s,!0);return JSON.parse(n||"[]").map(i=>new K(i.OBJTYPE,$.TreeItemCollapsibleState.Collapsed,"typeGroup",e.dbName,i.OBJTYPE))}catch(s){return $.window.showErrorMessage("Failed to load object types: "+s),[]}else if(e.contextValue==="typeGroup")try{let s=`SELECT OBJNAME, SCHEMA, OBJID, COALESCE(DESCRIPTION, '') AS DESCRIPTION FROM ${e.dbName}.._V_OBJECT_DATA WHERE DBNAME = '${e.dbName}' AND OBJTYPE = '${e.objType}' ORDER BY OBJNAME`,n=await x(this.context,s,!0);return JSON.parse(n||"[]").map(i=>{let r=["TABLE","VIEW","EXTERNAL TABLE","SYSTEM VIEW","SYSTEM TABLE"].includes(e.objType||"");return new K(i.OBJNAME,r?$.TreeItemCollapsibleState.Collapsed:$.TreeItemCollapsibleState.None,`netezza:${e.objType}`,e.dbName,e.objType,i.SCHEMA,i.OBJID,i.DESCRIPTION)})}catch(s){return $.window.showErrorMessage("Failed to load objects: "+s),[]}else if(e.contextValue.startsWith("netezza:")&&e.objId)try{let s=`SELECT 
                        X.ATTNAME
                        , X.FORMAT_TYPE
                        , X.ATTNOTNULL::BOOL AS ATTNOTNULL
                        , X.COLDEFAULT
                        , COALESCE(X.DESCRIPTION, '') AS DESCRIPTION
                    FROM
                        ${e.dbName}.._V_RELATION_COLUMN X
                    WHERE
                        X.OBJID = ${e.objId}
                    ORDER BY 
                        X.ATTNUM`,n=await x(this.context,s,!0);return JSON.parse(n||"[]").map(i=>new K(`${i.ATTNAME} (${i.FORMAT_TYPE})`,$.TreeItemCollapsibleState.None,"column",e.dbName,void 0,void 0,void 0,i.DESCRIPTION))}catch(s){return $.window.showErrorMessage("Failed to load columns: "+s),[]}}else{let s=this.metadataCache.getDatabases();if(s)return s.map(n=>{let a=typeof n.label=="string"?n.label:n.label.label;return new K(a,$.TreeItemCollapsibleState.Collapsed,"database",a)});try{let n=await x(this.context,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0);if(!n)return console.log("No results from database query"),[];let a=JSON.parse(n),i=a.map(r=>new K(r.DATABASE,$.TreeItemCollapsibleState.Collapsed,"database",r.DATABASE)),o=a.map(r=>{let p=new $.CompletionItem(r.DATABASE,$.CompletionItemKind.Module);return p.detail="Database",p});return this.metadataCache.setDatabases(o),i}catch(n){return $.window.showErrorMessage("Failed to load databases: "+n),console.error(n),[]}}return[]}},K=class extends $.TreeItem{constructor(t,s,n,a,i,o,r,p){super(t,s);this.label=t;this.collapsibleState=s;this.contextValue=n;this.dbName=a;this.objType=i;this.schema=o;this.objId=r;this.objectDescription=p;let u=this.label;p&&p.trim()&&(u+=`

${p.trim()}`),o&&n.startsWith("netezza:")&&(u+=`

Schema: ${o}`),this.tooltip=u,this.description=o?`(${o})`:"",n==="database"?this.iconPath=new $.ThemeIcon("database"):n==="typeGroup"?this.iconPath=new $.ThemeIcon("folder"):n.startsWith("netezza:")?this.iconPath=this.getIconForType(i):n==="column"&&(this.iconPath=new $.ThemeIcon("symbol-field"))}getIconForType(t){switch(t){case"TABLE":return new $.ThemeIcon("table");case"VIEW":return new $.ThemeIcon("eye");case"PROCEDURE":return new $.ThemeIcon("gear");case"FUNCTION":return new $.ThemeIcon("symbol-function");case"AGGREGATE":return new $.ThemeIcon("symbol-operator");case"EXTERNAL TABLE":return new $.ThemeIcon("server");default:return new $.ThemeIcon("file")}}}});var ut={};te(ut,{generateDDL:()=>Ft});function U(l){return!l||/^[A-Z_][A-Z0-9_]*$/i.test(l)&&l===l.toUpperCase()?l:`"${l.replace(/"/g,'""')}"`}async function dt(l,e,t,s){let n=`
        SELECT 
            X.OBJID::INT AS OBJID
            , X.ATTNAME
            , X.DESCRIPTION
            , CASE WHEN X.ATTNOTNULL THEN X.FORMAT_TYPE || ' NOT NULL'  ELSE X.FORMAT_TYPE END AS FULL_TYPE
            , X.ATTNOTNULL::BOOL AS ATTNOTNULL
            , X.COLDEFAULT
        FROM
            ${e.toUpperCase()}.._V_RELATION_COLUMN X
        INNER JOIN
            ${e.toUpperCase()}.._V_OBJECT_DATA D ON X.OBJID = D.OBJID
        WHERE
            X.TYPE IN ('TABLE','VIEW','EXTERNAL TABLE', 'SEQUENCE','SYSTEM VIEW','SYSTEM TABLE')
            AND X.OBJID NOT IN (4,5)
            AND D.SCHEMA = '${t.toUpperCase()}'
            AND D.OBJNAME = '${s.toUpperCase()}'
        ORDER BY 
            X.OBJID, X.ATTNUM
    `,a=await l.query(n),i=[];for(let o of a)i.push({name:o.ATTNAME,description:o.DESCRIPTION||null,fullTypeName:o.FULL_TYPE,notNull:!!o.ATTNOTNULL,defaultValue:o.COLDEFAULT||null});return i}async function Ot(l,e,t,s){try{let n=`
            SELECT ATTNAME
            FROM ${e.toUpperCase()}.._V_TABLE_DIST_MAP
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND TABLENAME = '${s.toUpperCase()}'
            ORDER BY DISTSEQNO
        `;return(await l.query(n)).map(i=>i.ATTNAME)}catch{return[]}}async function $t(l,e,t,s){try{let n=`
            SELECT ATTNAME
            FROM ${e.toUpperCase()}.._V_TABLE_ORGANIZE_COLUMN
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND TABLENAME = '${s.toUpperCase()}'
            ORDER BY ORGSEQNO
        `;return(await l.query(n)).map(i=>i.ATTNAME)}catch{return[]}}async function Lt(l,e,t,s){let n=`
        SELECT 
            X.SCHEMA
            , X.RELATION
            , X.CONSTRAINTNAME
            , X.CONTYPE
            , X.ATTNAME
            , X.PKDATABASE
            , X.PKSCHEMA
            , X.PKRELATION
            , X.PKATTNAME
            , X.UPDT_TYPE
            , X.DEL_TYPE
        FROM 
            ${e.toUpperCase()}.._V_RELATION_KEYDATA X
        WHERE 
            X.OBJID NOT IN (4,5)
            AND X.SCHEMA = '${t.toUpperCase()}'
            AND X.RELATION = '${s.toUpperCase()}'
        ORDER BY
            X.SCHEMA, X.RELATION, X.CONSEQ
    `,a=new Map;try{let i=await l.query(n);for(let o of i){let r=o.CONSTRAINTNAME;if(!a.has(r)){let u={p:"PRIMARY KEY",f:"FOREIGN KEY",u:"UNIQUE"};a.set(r,{type:u[o.CONTYPE]||"UNKNOWN",typeChar:o.CONTYPE,columns:[],pkDatabase:o.PKDATABASE||null,pkSchema:o.PKSCHEMA||null,pkRelation:o.PKRELATION||null,pkColumns:[],updateType:o.UPDT_TYPE||"NO ACTION",deleteType:o.DEL_TYPE||"NO ACTION"})}let p=a.get(r);p.columns.push(o.ATTNAME),o.PKATTNAME&&p.pkColumns.push(o.PKATTNAME)}}catch(i){console.warn("Cannot retrieve keys info:",i)}return a}async function xt(l,e,t,s){try{let n=`
            SELECT DESCRIPTION
            FROM ${e.toUpperCase()}.._V_OBJECT_DATA
            WHERE SCHEMA = '${t.toUpperCase()}'
                AND OBJNAME = '${s.toUpperCase()}'
                AND OBJTYPE = 'TABLE'
        `,a=await l.query(n);if(a.length>0&&a[0].DESCRIPTION)return a[0].DESCRIPTION}catch{try{let n=`
                SELECT DESCRIPTION
                FROM ${e.toUpperCase()}.._V_OBJECT_DATA
                WHERE SCHEMA = '${t.toUpperCase()}'
                    AND OBJNAME = '${s.toUpperCase()}'
            `,a=await l.query(n);if(a.length>0&&a[0].DESCRIPTION)return a[0].DESCRIPTION}catch{}}return null}async function Pt(l,e,t,s){let n=await dt(l,e,t,s);if(n.length===0)throw new Error(`Table ${e}.${t}.${s} not found or has no columns`);let a=await Ot(l,e,t,s),i=await $t(l,e,t,s),o=await Lt(l,e,t,s),r=await xt(l,e,t,s),p=U(e),u=U(t),h=U(s),f=[];f.push(`CREATE TABLE ${p}.${u}.${h}`),f.push("(");let m=[];for(let v of n){let N=`    ${U(v.name)} ${v.fullTypeName}`;v.defaultValue&&(N+=` DEFAULT ${v.defaultValue}`),m.push(N)}if(f.push(m.join(`,
`)),a.length>0){let v=a.map(b=>U(b));f.push(`)
DISTRIBUTE ON (${v.join(", ")})`)}else f.push(`)
DISTRIBUTE ON RANDOM`);if(i.length>0){let v=i.map(b=>U(b));f.push(`ORGANIZE ON (${v.join(", ")})`)}f.push(";"),f.push("");for(let[v,b]of o){let N=U(v),L=b.columns.map(A=>U(A));if(b.typeChar==="f"){let A=b.pkColumns.filter(I=>I).map(I=>U(I));A.length>0&&f.push(`ALTER TABLE ${p}.${u}.${h} ADD CONSTRAINT ${N} ${b.type} (${L.join(", ")}) REFERENCES ${b.pkDatabase}.${b.pkSchema}.${b.pkRelation} (${A.join(", ")}) ON DELETE ${b.deleteType} ON UPDATE ${b.updateType};`)}else(b.typeChar==="p"||b.typeChar==="u")&&f.push(`ALTER TABLE ${p}.${u}.${h} ADD CONSTRAINT ${N} ${b.type} (${L.join(", ")});`)}if(r){let v=r.replace(/'/g,"''");f.push(""),f.push(`COMMENT ON TABLE ${p}.${u}.${h} IS '${v}';`)}for(let v of n)if(v.description){let b=U(v.name),N=v.description.replace(/'/g,"''");f.push(`COMMENT ON COLUMN ${p}.${u}.${h}.${b} IS '${N}';`)}return f.join(`
`)}async function _t(l,e,t,s){let n=`
        SELECT 
            SCHEMA,
            VIEWNAME,
            DEFINITION,
            OBJID::INT
        FROM ${e.toUpperCase()}.._V_VIEW
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND VIEWNAME = '${s.toUpperCase()}'
    `,i=await l.query(n);if(i.length===0)throw new Error(`View ${e}.${t}.${s} not found`);let o=i[0],r=U(e),p=U(t),u=U(s),h=[];return h.push(`CREATE OR REPLACE VIEW ${r}.${p}.${u} AS`),h.push(o.DEFINITION||""),h.join(`
`)}async function Ut(l,e,t,s){let n=`
        SELECT 
            SCHEMA,
            PROCEDURESOURCE,
            OBJID::INT,
            RETURNS,
            EXECUTEDASOWNER,
            DESCRIPTION,
            PROCEDURESIGNATURE,
            ARGUMENTS,
            NULL AS LANGUAGE
        FROM ${e.toUpperCase()}.._V_PROCEDURE
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND PROCEDURE = '${s.toUpperCase()}'
        ORDER BY 1, 2, 3
    `,i=await l.query(n);if(i.length===0)throw new Error(`Procedure ${e}.${t}.${s} not found`);let o=i[0],r={schema:o.SCHEMA,procedureSource:o.PROCEDURESOURCE,objId:o.OBJID,returns:o.RETURNS,executeAsOwner:!!o.EXECUTEDASOWNER,description:o.DESCRIPTION||null,procedureSignature:o.PROCEDURESIGNATURE,arguments:o.ARGUMENTS||null},p=U(e),u=U(t),h=U(s),f=[];if(f.push(`CREATE OR REPLACE PROCEDURE ${p}.${u}.${h}`),f.push(`RETURNS ${r.returns}`),r.executeAsOwner?f.push("EXECUTE AS OWNER"):f.push("EXECUTE AS CALLER"),f.push("LANGUAGE NZPLSQL AS"),f.push("BEGIN_PROC"),f.push(r.procedureSource),f.push("END_PROC;"),r.description){let m=r.description.replace(/'/g,"''");f.push(`COMMENT ON PROCEDURE ${h} IS '${m}';`)}return f.join(`
`)}async function Bt(l,e,t,s){let n=`
        SELECT 
            E1.SCHEMA,
            E1.TABLENAME,
            E2.EXTOBJNAME,
            E2.OBJID::INT,
            E1.DELIM,
            E1.ENCODING,
            E1.TIMESTYLE,
            E1.REMOTESOURCE,
            E1.SKIPROWS,
            E1.MAXERRORS,
            E1.ESCAPE,
            E1.LOGDIR,
            E1.DECIMALDELIM,
            E1.QUOTEDVALUE,
            E1.NULLVALUE,
            E1.CRINSTRING,
            E1.TRUNCSTRING,
            E1.CTRLCHARS,
            E1.IGNOREZERO,
            E1.TIMEEXTRAZEROS,
            E1.Y2BASE,
            E1.FILLRECORD,
            E1.COMPRESS,
            E1.INCLUDEHEADER,
            E1.LFINSTRING,
            E1.DATESTYLE,
            E1.DATEDELIM,
            E1.TIMEDELIM,
            E1.BOOLSTYLE,
            E1.FORMAT,
            E1.SOCKETBUFSIZE,
            E1.RECORDDELIM,
            E1.MAXROWS,
            E1.REQUIREQUOTES,
            E1.RECORDLENGTH,
            E1.DATETIMEDELIM,
            E1.REJECTFILE
        FROM 
            ${e.toUpperCase()}.._V_EXTERNAL E1
            JOIN ${e.toUpperCase()}.._V_EXTOBJECT E2 ON E1.DATABASE = E2.DATABASE
                AND E1.SCHEMA = E2.SCHEMA
                AND E1.TABLENAME = E2.TABLENAME
        WHERE 
            E1.DATABASE = '${e.toUpperCase()}'
            AND E1.SCHEMA = '${t.toUpperCase()}'
            AND E1.TABLENAME = '${s.toUpperCase()}'
    `,i=await l.query(n);if(i.length===0)throw new Error(`External table ${e}.${t}.${s} not found`);let o=i[0],r={schema:o.SCHEMA,tableName:o.TABLENAME,dataObject:o.EXTOBJNAME||null,delimiter:o.DELIM||null,encoding:o.ENCODING||null,timeStyle:o.TIMESTYLE||null,remoteSource:o.REMOTESOURCE||null,skipRows:o.SKIPROWS||null,maxErrors:o.MAXERRORS||null,escapeChar:o.ESCAPE||null,logDir:o.LOGDIR||null,decimalDelim:o.DECIMALDELIM||null,quotedValue:o.QUOTEDVALUE||null,nullValue:o.NULLVALUE||null,crInString:o.CRINSTRING??null,truncString:o.TRUNCSTRING??null,ctrlChars:o.CTRLCHARS??null,ignoreZero:o.IGNOREZERO??null,timeExtraZeros:o.TIMEEXTRAZEROS??null,y2Base:o.Y2BASE||null,fillRecord:o.FILLRECORD??null,compress:o.COMPRESS||null,includeHeader:o.INCLUDEHEADER??null,lfInString:o.LFINSTRING??null,dateStyle:o.DATESTYLE||null,dateDelim:o.DATEDELIM||null,timeDelim:o.TIMEDELIM||null,boolStyle:o.BOOLSTYLE||null,format:o.FORMAT||null,socketBufSize:o.SOCKETBUFSIZE||null,recordDelim:o.RECORDDELIM?String(o.RECORDDELIM).replace(/\r/g,"\\r").replace(/\n/g,"\\n"):null,maxRows:o.MAXROWS||null,requireQuotes:o.REQUIREQUOTES??null,recordLength:o.RECORDLENGTH||null,dateTimeDelim:o.DATETIMEDELIM||null,rejectFile:o.REJECTFILE||null},p=await dt(l,e,t,s),u=U(e),h=U(t),f=U(s),m=[];m.push(`CREATE EXTERNAL TABLE ${u}.${h}.${f}`),m.push("(");let v=p.map(b=>`    ${U(b.name)} ${b.fullTypeName}`);return m.push(v.join(`,
`)),m.push(")"),m.push("USING"),m.push("("),r.dataObject!==null&&m.push(`    DATAOBJECT('${r.dataObject}')`),r.delimiter!==null&&m.push(`    DELIMITER '${r.delimiter}'`),r.encoding!==null&&m.push(`    ENCODING '${r.encoding}'`),r.timeStyle!==null&&m.push(`    TIMESTYLE '${r.timeStyle}'`),r.remoteSource!==null&&m.push(`    REMOTESOURCE '${r.remoteSource}'`),r.maxErrors!==null&&m.push(`    MAXERRORS ${r.maxErrors}`),r.escapeChar!==null&&m.push(`    ESCAPECHAR '${r.escapeChar}'`),r.decimalDelim!==null&&m.push(`    DECIMALDELIM '${r.decimalDelim}'`),r.logDir!==null&&m.push(`    LOGDIR '${r.logDir}'`),r.quotedValue!==null&&m.push(`    QUOTEDVALUE '${r.quotedValue}'`),r.nullValue!==null&&m.push(`    NULLVALUE '${r.nullValue}'`),r.crInString!==null&&m.push(`    CRINSTRING ${r.crInString}`),r.truncString!==null&&m.push(`    TRUNCSTRING ${r.truncString}`),r.ctrlChars!==null&&m.push(`    CTRLCHARS ${r.ctrlChars}`),r.ignoreZero!==null&&m.push(`    IGNOREZERO ${r.ignoreZero}`),r.timeExtraZeros!==null&&m.push(`    TIMEEXTRAZEROS ${r.timeExtraZeros}`),r.y2Base!==null&&m.push(`    Y2BASE ${r.y2Base}`),r.fillRecord!==null&&m.push(`    FILLRECORD ${r.fillRecord}`),r.compress!==null&&m.push(`    COMPRESS ${r.compress}`),r.includeHeader!==null&&m.push(`    INCLUDEHEADER ${r.includeHeader}`),r.lfInString!==null&&m.push(`    LFINSTRING ${r.lfInString}`),r.dateStyle!==null&&m.push(`    DATESTYLE '${r.dateStyle}'`),r.dateDelim!==null&&m.push(`    DATEDELIM '${r.dateDelim}'`),r.timeDelim!==null&&m.push(`    TIMEDELIM '${r.timeDelim}'`),r.boolStyle!==null&&m.push(`    BOOLSTYLE '${r.boolStyle}'`),r.format!==null&&m.push(`    FORMAT '${r.format}'`),r.socketBufSize!==null&&m.push(`    SOCKETBUFSIZE ${r.socketBufSize}`),r.recordDelim!==null&&m.push(`    RECORDDELIM '${r.recordDelim}'`),r.maxRows!==null&&m.push(`    MAXROWS ${r.maxRows}`),r.requireQuotes!==null&&m.push(`    REQUIREQUOTES ${r.requireQuotes}`),r.recordLength!==null&&m.push(`    RECORDLENGTH ${r.recordLength}`),r.dateTimeDelim!==null&&m.push(`    DATETIMEDELIM '${r.dateTimeDelim}'`),r.rejectFile!==null&&m.push(`    REJECTFILE '${r.rejectFile}'`),m.push(");"),m.join(`
`)}async function zt(l,e,t,s){let n=`
        SELECT 
            SCHEMA,
            OWNER,
            SYNONYM_NAME,
            REFOBJNAME,
            DESCRIPTION
        FROM ${e.toUpperCase()}.._V_SYNONYM
        WHERE DATABASE = '${e.toUpperCase()}'
            AND SCHEMA = '${t.toUpperCase()}'
            AND SYNONYM_NAME = '${s.toUpperCase()}'
    `,i=await l.query(n);if(i.length===0)throw new Error(`Synonym ${e}.${t}.${s} not found`);let o=i[0],r=U(e),p=U(o.OWNER||t),u=U(s),h=o.REFOBJNAME,f=[];if(f.push(`CREATE SYNONYM ${r}.${p}.${u} FOR ${h};`),o.DESCRIPTION){let m=o.DESCRIPTION.replace(/'/g,"''");f.push(`COMMENT ON SYNONYM ${u} IS '${m}';`)}return f.join(`
`)}async function Ft(l,e,t,s,n){let a=null;try{a=await lt.connect(l);let i=n.toUpperCase();return i==="TABLE"?{success:!0,ddlCode:await Pt(a,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:i==="VIEW"?{success:!0,ddlCode:await _t(a,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:i==="PROCEDURE"?{success:!0,ddlCode:await Ut(a,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:i==="EXTERNAL TABLE"?{success:!0,ddlCode:await Bt(a,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:i==="SYNONYM"?{success:!0,ddlCode:await zt(a,e,t,s),objectInfo:{database:e,schema:t,objectName:s,objectType:n}}:{success:!0,ddlCode:`-- DDL generation for ${n} not yet implemented
-- Object: ${e}.${t}.${s}
-- Type: ${n}
--
-- This feature can be extended to support:
-- - FUNCTION: Query _V_FUNCTION system table
-- - AGGREGATE: Query _V_AGGREGATE system table
`,objectInfo:{database:e,schema:t,objectName:s,objectType:n},note:`${n} DDL generation not yet implemented`}}catch(i){return{success:!1,error:`DDL generation error: ${i.message||i}`}}finally{if(a)try{await a.close()}catch{}}}var lt,pt=ee(()=>{"use strict";lt=P(require("odbc"))});var Te={};te(Te,{copyFileToClipboard:()=>Ve,exportCsvToXlsb:()=>Xt,exportQueryToXlsb:()=>kt,getTempFilePath:()=>Wt});async function kt(l,e,t,s=!1,n){let a=null;try{n&&n("Connecting to database..."),a=await Ht.connect(l),n&&n("Executing query...");let i=await a.query(e);if(!i||!i.columns||i.columns.length===0)return{success:!1,message:"Query did not return any results (no columns)"};let o=i.columns.length;n&&n(`Query returned ${o} columns`);let r=i.columns.map(I=>I.name),p=i.map(I=>r.map(_=>I[_])),u=p.length;n&&n(`Writing ${u.toLocaleString()} rows to XLSX: ${t}`);let h=q.utils.book_new(),f=[r,...p],m=q.utils.aoa_to_sheet(f);q.utils.book_append_sheet(h,m,"Query Results");let v=[["SQL Query:"],...e.split(`
`).map(I=>[I])],b=q.utils.aoa_to_sheet(v);q.utils.book_append_sheet(h,b,"SQL Code"),q.writeFile(h,t,{bookType:"xlsx",compression:!0});let L=qe.statSync(t).size/(1024*1024);n&&(n("XLSX file created successfully"),n(`  - Rows: ${u.toLocaleString()}`),n(`  - Columns: ${o}`),n(`  - File size: ${L.toFixed(1)} MB`),n(`  - Location: ${t}`));let A={success:!0,message:`Successfully exported ${u} rows to ${t}`,details:{rows_exported:u,columns:o,file_size_mb:parseFloat(L.toFixed(1)),file_path:t}};if(s){n&&n("Copying to clipboard...");let I=await Ve(t);A.details&&(A.details.clipboard_success=I)}return A}catch(i){return{success:!1,message:`Export error: ${i.message||i}`}}finally{if(a)try{await a.close()}catch{}}}async function Xt(l,e,t=!1,s,n){try{n&&n("Reading CSV content...");let a=q.read(l,{type:"string",raw:!0});if(!a.SheetNames||a.SheetNames.length===0)return{success:!1,message:"CSV content is empty or invalid"};let i=a.Sheets[a.SheetNames[0]],o=q.utils.sheet_to_json(i,{header:1});if(o.length===0)return{success:!1,message:"CSV file is empty or contains no headers"};let r=o.length-1,p=o[0]?o[0].length:0;n&&n(`Writing ${r.toLocaleString()} rows to XLSX: ${e}`);let u=q.utils.book_new(),h=q.utils.aoa_to_sheet(o);q.utils.book_append_sheet(u,h,"CSV Data");let f=s?.source||"Clipboard",m=[["CSV Source:"],[f]],v=q.utils.aoa_to_sheet(m);q.utils.book_append_sheet(u,v,"CSV Source"),q.writeFile(u,e,{bookType:"xlsx",compression:!0});let N=qe.statSync(e).size/(1024*1024);n&&(n("XLSX file created successfully"),n(`  - Rows: ${r.toLocaleString()}`),n(`  - Columns: ${p}`),n(`  - File size: ${N.toFixed(1)} MB`),n(`  - Location: ${e}`));let L={success:!0,message:`Successfully exported ${r} rows from CSV to ${e}`,details:{rows_exported:r,columns:p,file_size_mb:parseFloat(N.toFixed(1)),file_path:e}};if(t){n&&n("Copying to clipboard...");let A=await Ve(e);L.details&&(L.details.clipboard_success=A)}return L}catch(a){return{success:!1,message:`Export error: ${a.message||a}`}}}async function Ve(l){return _e.platform()!=="win32"?(console.error("Clipboard file copy is only supported on Windows"),!1):new Promise(e=>{try{let t=he.normalize(he.resolve(l)),s=`Set-Clipboard -Path "${t.replace(/"/g,'`"')}"`,n=(0,mt.spawn)("powershell.exe",["-NoProfile","-NonInteractive","-Command",s]),a="";n.stderr.on("data",i=>{a+=i.toString()}),n.on("close",i=>{i!==0?(console.error(`PowerShell clipboard copy failed: ${a}`),e(!1)):(console.log(`File copied to clipboard: ${t}`),e(!0))}),n.on("error",i=>{console.error(`Error spawning PowerShell: ${i.message}`),e(!1)})}catch(t){console.error(`Error copying file to clipboard: ${t.message}`),e(!1)}})}function Wt(){let l=_e.tmpdir(),t=`netezza_export_${Date.now()}.xlsx`;return he.join(l,t)}var q,qe,he,_e,mt,Ht,be=ee(()=>{"use strict";q=P(require("xlsx")),qe=P(require("fs")),he=P(require("path")),_e=P(require("os")),mt=require("child_process"),Ht=require("odbc")});var gt={};te(gt,{exportToCsv:()=>qt});async function qt(l,e,t,s,n){if(!Ye)throw new Error("odbc package not installed. Please run: npm install odbc");let a=await Ye.connect(e);try{n&&n.report({message:"Executing query..."});let i=await a.query(t,{cursor:!0,fetchSize:1e3});n&&n.report({message:"Writing to CSV..."});let o=ht.createWriteStream(s,{encoding:"utf8",highWaterMark:64*1024}),r=[];i.columns&&(r=i.columns.map(m=>m.name)),r.length>0&&o.write(r.map(Je).join(",")+`
`);let p=0,u=[],h=[],f=100;do{u=await i.fetch();for(let m of u){p++;let v;if(r.length>0?v=r.map(b=>Je(m[b])):v=Object.values(m).map(b=>Je(b)),h.push(v.join(",")),h.length>=f){let b=o.write(h.join(`
`)+`
`);h=[],b||await new Promise(N=>o.once("drain",N))}}n&&u.length>0&&n.report({message:`Processed ${p} rows...`})}while(u.length>0&&!i.noData);h.length>0&&o.write(h.join(`
`)+`
`),await i.close(),o.end(),await new Promise((m,v)=>{o.on("finish",m),o.on("error",v)}),n&&n.report({message:`Completed: ${p} rows exported`})}finally{try{await a.close()}catch(i){console.error("Error closing connection:",i)}}}function Je(l){if(l==null)return"";let e="";return typeof l=="bigint"?l>=Number.MIN_SAFE_INTEGER&&l<=Number.MAX_SAFE_INTEGER?e=Number(l).toString():e=l.toString():l instanceof Date?e=l.toISOString():l instanceof Buffer?e=l.toString("hex"):typeof l=="object"?e=JSON.stringify(l):e=String(l),e.includes('"')||e.includes(",")||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}var ht,Ye,ft=ee(()=>{"use strict";ht=P(require("fs"));try{Ye=require("odbc")}catch{console.error("odbc package not installed. Run: npm install odbc")}});var Et={};te(Et,{ColumnTypeChooser:()=>ge,NetezzaDataType:()=>ne,NetezzaImporter:()=>Ue,importDataToNetezza:()=>Vt});async function Vt(l,e,t,s,n){let a=Date.now();try{if(!l||!V.existsSync(l))return{success:!1,message:`Source file not found: ${l}`};if(!e)return{success:!1,message:"Target table name is required"};if(!t)return{success:!1,message:"Connection string is required"};let o=V.statSync(l).size,r=re.extname(l).toLowerCase(),p=[".csv",".txt",".xlsx",".xlsb"];if(!p.includes(r))return{success:!1,message:`Unsupported file format: ${r}. Supported: ${p.join(", ")}`};if([".xlsx",".xlsb"].includes(r)&&!Se)return{success:!1,message:"XLSX module not available. Please run: npm install xlsx"};n?.("Starting import process..."),n?.(`  Source file: ${l}`),n?.(`  Target table: ${e}`),n?.(`  File size: ${o.toLocaleString()} bytes`),n?.(`  File format: ${r}`);let h=new Ue(l,e,t);await h.analyzeDataTypes(n),n?.("Using file-based import...");let f=await h.createDataFile(n),m=h.generateCreateTableSql();if(n?.("Generated SQL:"),n?.(m),n?.("Connecting to Netezza..."),!je)throw new Error("ODBC module not available");let v=await je.connect(t);try{n?.("Executing CREATE TABLE with EXTERNAL data..."),await v.query(m),n?.("Import completed successfully")}finally{await v.close();try{V.existsSync(f)&&(V.unlinkSync(f),n?.("Temporary data file cleaned up"))}catch(N){n?.(`Warning: Could not clean up temp file: ${N.message}`)}}let b=(Date.now()-a)/1e3;return{success:!0,message:"Import completed successfully",details:{sourceFile:l,targetTable:e,fileSize:o,format:r,rowsProcessed:h.getRowsCount(),rowsInserted:h.getRowsCount(),processingTime:`${b.toFixed(1)}s`,columns:h.getSqlHeaders().length,detectedDelimiter:h.getCsvDelimiter()}}}catch(i){let o=(Date.now()-a)/1e3;return{success:!1,message:`Import failed: ${i.message}`,details:{processingTime:`${o.toFixed(1)}s`}}}}var V,re,Se,je,ne,ge,Ue,Qe=ee(()=>{"use strict";V=P(require("fs")),re=P(require("path"));try{Se=require("xlsx")}catch{console.error("XLSX module not available")}try{je=require("odbc")}catch{console.error("ODBC module not available")}ne=class{constructor(e,t,s,n){this.dbType=e;this.precision=t;this.scale=s;this.length=n}toString(){return["BIGINT","DATE","DATETIME"].includes(this.dbType)?this.dbType:this.dbType==="NUMERIC"?`${this.dbType}(${this.precision},${this.scale})`:this.dbType==="NVARCHAR"?`${this.dbType}(${this.length})`:`TODO !!! ${this.dbType}`}},ge=class{constructor(){this.decimalDelimInCsv=".";this.firstTime=!0;this.currentType=new ne("BIGINT")}getType(e){let t=this.currentType.dbType,s=e.length;if(t==="BIGINT"&&/^\d+$/.test(e)&&s<15)return this.firstTime=!1,new ne("BIGINT");let n=(e.match(new RegExp(`\\${this.decimalDelimInCsv}`,"g"))||[]).length;if(["BIGINT","NUMERIC"].includes(t)&&n<=1){let i=e.replace(this.decimalDelimInCsv,"");if(/^\d+$/.test(i)&&s<15&&(!i.startsWith("0")||n>0))return this.firstTime=!1,new ne("NUMERIC",16,6)}if((t==="DATE"||this.firstTime)&&(e.match(/-/g)||[]).length===2&&s>=8&&s<=10){let i=e.split("-");if(i.length===3&&i.every(o=>/^\d+$/.test(o)))try{let o=new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2]));if(!isNaN(o.getTime()))return this.firstTime=!1,new ne("DATE")}catch{}}if((t==="DATETIME"||this.firstTime)&&(e.match(/-/g)||[]).length===2&&s>=12&&s<=20){let i=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})[\s|T](\d{2}):(\d{2})(:?(\d{2}))?$/);if(i)try{let o=i[7]?parseInt(i[7]):0,r=new Date(parseInt(i[1]),parseInt(i[2])-1,parseInt(i[3]),parseInt(i[4]),parseInt(i[5]),o);if(!isNaN(r.getTime()))return this.firstTime=!1,new ne("DATETIME")}catch{}}let a=Math.max(s+5,20);return this.currentType.length!==void 0&&a<this.currentType.length&&(a=this.currentType.length),this.firstTime=!1,new ne("NVARCHAR",void 0,void 0,a)}refreshCurrentType(e){return this.currentType=this.getType(e),this.currentType}},Ue=class{constructor(e,t,s,n){this.delimiter="	";this.delimiterPlain="\\t";this.recordDelim=`
`;this.recordDelimPlain="\\n";this.escapechar="\\";this.csvDelimiter=",";this.excelData=[];this.isExcelFile=!1;this.sqlHeaders=[];this.dataTypes=[];this.rowsCount=0;this.valuesToEscape=[];this.filePath=e,this.targetTable=t,this.connectionString=s,this.logDir=n||re.join(re.dirname(e),"netezza_logs");let a=re.extname(e).toLowerCase();this.isExcelFile=[".xlsx",".xlsb"].includes(a);let i=Math.floor(Math.random()*1e3);this.pipeName=`\\\\.\\pipe\\NETEZZA_IMPORT_${i}`,this.valuesToEscape=[this.escapechar,this.recordDelim,"\r",this.delimiter],V.existsSync(this.logDir)||V.mkdirSync(this.logDir,{recursive:!0})}detectCsvDelimiter(){let t=V.readFileSync(this.filePath,"utf-8").split(`
`)[0]||"";t.startsWith("\uFEFF")&&(t=t.slice(1));let s=[";","	","|",","],n={};for(let i of s)n[i]=(t.match(new RegExp(i==="|"?"\\|":i,"g"))||[]).length;let a=Math.max(...Object.values(n));a>0&&(this.csvDelimiter=Object.keys(n).find(i=>n[i]===a)||",")}cleanColumnName(e){let t=String(e).trim();return t=t.replace(/[^0-9a-zA-Z]+/g,"_").toUpperCase(),(!t||/^\d/.test(t))&&(t="COL_"+t),t}parseCsvLine(e){let t=[],s="",n=!1;for(let a=0;a<e.length;a++){let i=e[a];i==='"'?n&&e[a+1]==='"'?(s+='"',a++):n=!n:i===this.csvDelimiter&&!n?(t.push(s),s=""):s+=i}return t.push(s),t}readExcelFile(e){if(!Se)throw new Error("XLSX module not available");e?.("Reading Excel file...");let t=Se.readFile(this.filePath,{type:"file"}),s=t.SheetNames[0];if(!s)throw new Error("Excel file has no sheets");e?.(`Processing sheet: ${s}`);let n=t.Sheets[s],i=Se.utils.sheet_to_json(n,{header:1,raw:!1,defval:""}).map(o=>o.map(r=>r!=null?String(r):""));return e?.(`Excel file loaded: ${i.length} rows, ${i[0]?.length||0} columns`),i}async analyzeDataTypes(e){e?.("Analyzing data types...");let t;if(this.isExcelFile)this.excelData=this.readExcelFile(e),t=this.excelData;else{this.detectCsvDelimiter();let n=V.readFileSync(this.filePath,"utf-8");n.startsWith("\uFEFF")&&(n=n.slice(1));let a=n.split(/\r?\n/);t=[];for(let i of a)i.trim()&&t.push(this.parseCsvLine(i))}if(!t||t.length===0)throw new Error("No data found in file");let s=[];this.sqlHeaders=t[0].map(n=>this.cleanColumnName(n||"COLUMN"));for(let n=0;n<t[0].length;n++)s.push(new ge);for(let n=1;n<t.length;n++){let a=t[n];for(let i=0;i<a.length;i++)i<s.length&&a[i]&&a[i].trim()&&s[i].refreshCurrentType(a[i].trim());n%1e4===0&&e?.(`Analyzed ${n.toLocaleString()} rows...`)}return this.rowsCount=t.length-1,e?.(`Analysis complete: ${this.rowsCount.toLocaleString()} rows`),this.dataTypes=s,s}escapeValue(e){let t=String(e).trim();for(let s of this.valuesToEscape)t=t.split(s).join(`${this.escapechar}${s}`);return t}formatValue(e,t){let s=this.escapeValue(e);return t<this.dataTypes.length&&this.dataTypes[t].currentType.dbType==="DATETIME"&&(s=s.replace("T"," ")),s}generateCreateTableSql(){let e=[];for(let s=0;s<this.sqlHeaders.length;s++){let n=this.sqlHeaders[s],a=this.dataTypes[s];e.push(`        ${n} ${a.currentType.toString()}`)}let t=this.logDir.replace(/\\/g,"/");return`CREATE TABLE ${this.targetTable} AS 
(
    SELECT * FROM EXTERNAL '${this.pipeName}'
    (
${e.join(`,
`)}
    )
    USING
    (
        REMOTESOURCE 'odbc'
        DELIMITER '${this.delimiterPlain}'
        RecordDelim '${this.recordDelimPlain}'
        ESCAPECHAR '${this.escapechar}'
        NULLVALUE ''
        ENCODING 'utf-8'
        TIMESTYLE '24HOUR'
        SKIPROWS 0
        MAXERRORS 10
        LOGDIR '${t}'
    )
) DISTRIBUTE ON RANDOM;`}async createDataFile(e){let t=re.join(this.logDir,`netezza_import_data_${Math.floor(Math.random()*1e3)}.txt`);e?.(`Creating temporary data file: ${t}`);try{let s;if(this.isExcelFile){if(!this.excelData||this.excelData.length===0)throw new Error("Excel data not loaded. Call analyzeDataTypes first.");s=this.excelData.slice(1)}else{let a=V.readFileSync(this.filePath,"utf-8");a.startsWith("\uFEFF")&&(a=a.slice(1));let i=a.split(/\r?\n/);s=[];let o=!0;for(let r of i)if(r.trim()){if(o){o=!1;continue}s.push(this.parseCsvLine(r))}}let n=[];for(let a=0;a<s.length;a++){let o=s[a].map((r,p)=>this.formatValue(r||"",p));n.push(o.join(this.delimiter)),(a+1)%1e4===0&&e?.(`Processed ${(a+1).toLocaleString()} rows...`)}return V.writeFileSync(t,n.join(this.recordDelim),"utf-8"),this.pipeName=t.replace(/\\/g,"/"),e?.(`Data file created: ${this.pipeName}`),t}catch(s){throw new Error(`Error creating data file: ${s.message}`)}}getRowsCount(){return this.rowsCount}getSqlHeaders(){return this.sqlHeaders}getCsvDelimiter(){return this.csvDelimiter}}});var vt={};te(vt,{ClipboardDataProcessor:()=>Be,importClipboardDataToNetezza:()=>Qt});function Jt(l){let e=String(l).trim();return e=e.replace(/[^0-9a-zA-Z]+/g,"_").toUpperCase(),(!e||/^\d/.test(e))&&(e="COL_"+e),e}function Yt(l,e,t){let s=String(l).trim();for(let n of t)s=s.split(n).join(`${e}${n}`);return s}function jt(l,e,t,s,n){let a=Yt(l,s,n);return e<t.length&&t[e].currentType.dbType==="DATETIME"&&(a=a.replace("T"," ")),a}async function Qt(l,e,t,s,n){let a=Date.now(),i=null;try{if(!l)return{success:!1,message:"Target table name is required"};if(!e)return{success:!1,message:"Connection string is required"};n?.("Starting clipboard import process..."),n?.(`  Target table: ${l}`),n?.(`  Format preference: ${t||"auto-detect"}`);let o=new Be,[r,p]=await o.processClipboardData(t,n);if(!r||!r.length)return{success:!1,message:"No data found in clipboard"};if(r.length<2)return{success:!1,message:"Clipboard data must contain at least headers and one data row"};n?.(`  Detected format: ${p}`),n?.(`  Rows: ${r.length}`),n?.(`  Columns: ${r[0].length}`);let u=r[0].map(H=>Jt(H)),h=r.slice(1);n?.("Analyzing clipboard data types...");let f=u.map(()=>new ge);for(let H=0;H<h.length;H++){let ce=h[H];for(let Q=0;Q<ce.length;Q++)Q<f.length&&ce[Q]&&ce[Q].trim()&&f[Q].refreshCurrentType(ce[Q].trim());(H+1)%1e3===0&&n?.(`Analyzed ${(H+1).toLocaleString()} rows...`)}n?.(`Analysis complete: ${h.length.toLocaleString()} data rows`);let m=Ge.join(require("os").tmpdir(),"netezza_clipboard_logs");se.existsSync(m)||se.mkdirSync(m,{recursive:!0});let v="	",b="\\t",N=`
`,L="\\n",A="\\",I=[A,N,"\r",v];i=Ge.join(m,`netezza_clipboard_import_${Math.floor(Math.random()*1e3)}.txt`),n?.(`Creating temporary data file: ${i}`);let _=[];for(let H=0;H<h.length;H++){let Q=h[H].map((Fe,d)=>jt(Fe,d,f,A,I));_.push(Q.join(v)),(H+1)%1e3===0&&n?.(`Processed ${(H+1).toLocaleString()} rows...`)}se.writeFileSync(i,_.join(N),"utf-8");let F=i.replace(/\\/g,"/");n?.(`Data file created: ${F}`);let ie=[];for(let H=0;H<u.length;H++)ie.push(`        ${u[H]} ${f[H].currentType.toString()}`);let G=m.replace(/\\/g,"/"),j=`CREATE TABLE ${l} AS 
(
    SELECT * FROM EXTERNAL '${F}'
    (
${ie.join(`,
`)}
    )
    USING
    (
        REMOTESOURCE 'odbc'
        DELIMITER '${b}'
        RecordDelim '${L}'
        ESCAPECHAR '${A}'
        NULLVALUE ''
        ENCODING 'utf-8'
        TIMESTYLE '24HOUR'
        SKIPROWS 0
        MAXERRORS 10
        LOGDIR '${G}'
    )
) DISTRIBUTE ON RANDOM;`;if(n?.("Generated SQL:"),n?.(j),n?.("Connecting to Netezza..."),!Ke)throw new Error("ODBC module not available");let ae=await Ke.connect(e);try{n?.("Executing CREATE TABLE with EXTERNAL clipboard data..."),await ae.query(j),n?.("Clipboard import completed successfully")}finally{await ae.close()}let ze=(Date.now()-a)/1e3;return{success:!0,message:"Clipboard import completed successfully",details:{targetTable:l,format:p,rowsProcessed:h.length,rowsInserted:h.length,processingTime:`${ze.toFixed(1)}s`,columns:u.length,detectedDelimiter:v}}}catch(o){let r=(Date.now()-a)/1e3;return{success:!1,message:`Clipboard import failed: ${o.message}`,details:{processingTime:`${r.toFixed(1)}s`}}}finally{if(i&&se.existsSync(i))try{se.unlinkSync(i),n?.("Temporary clipboard data file cleaned up")}catch(o){n?.(`Warning: Could not clean up temp file: ${o.message}`)}}}var se,Ge,wt,Ke,Be,yt=ee(()=>{"use strict";se=P(require("fs")),Ge=P(require("path")),wt=P(require("vscode"));Qe();try{Ke=require("odbc")}catch{console.error("ODBC module not available")}Be=class{constructor(){this.processedData=[]}processXmlSpreadsheet(e,t){t?.("Processing XML Spreadsheet data...");let s=[],n=0,a=[],i=0,o=e.match(/ExpandedColumnCount="(\d+)"/);o&&(n=parseInt(o[1]),t?.(`Table has ${n} columns`));let r=e.match(/ExpandedRowCount="(\d+)"/);r&&t?.(`Table has ${r[1]} rows`);let p=/<Row[^>]*>([\s\S]*?)<\/Row>/gi,u;for(;(u=p.exec(e))!==null;){let h=u[1];a=new Array(n).fill("");let f=/<Cell(?:\s+[^>]*ss:Index="(\d+)")?[^>]*>[\s\S]*?<Data[^>]*>([^<]*)<\/Data>[\s\S]*?<\/Cell>|<Cell(?:\s+[^>]*ss:Index="(\d+)")?[^>]*\/>/gi,m,v=0,b=/<Cell(?:[^>]*ss:Index="(\d+)")?[^>]*>(?:[\s\S]*?<Data[^>]*(?:\s+ss:Type="([^"]*)")?[^>]*>([^<]*)<\/Data>)?[\s\S]*?<\/Cell>/gi;for(;(m=b.exec(h))!==null;){m[1]&&(v=parseInt(m[1])-1);let N=m[2]||"",L=m[3]||"";N==="Boolean"&&(L=L==="0"?"False":"True"),v<n&&(a[v]=L),v++}a.some(N=>N.trim())&&s.push([...a]),i++,i%1e4===0&&t?.(`Analyzed ${i.toLocaleString()} rows...`)}return t?.(`XML processing complete: ${s.length} rows, ${n} columns`),this.processedData=s,s}processTextData(e,t){if(t?.("Processing text data..."),!e.trim())return[];let s=e.split(`
`);for(;s.length&&!s[s.length-1].trim();)s.pop();if(!s.length)return[];let n=["	",",",";","|"],a={};for(let p of n){let u=[];for(let h of s.slice(0,Math.min(5,s.length)))if(h.trim()){let f=h.split(p);u.push(f.length)}if(u.length){let h=u.reduce((m,v)=>m+v,0)/u.length,f=u.reduce((m,v)=>m+Math.pow(v-h,2),0)/u.length;a[p]=[h,-f]}}let i="	";Object.keys(a).length&&(i=Object.keys(a).reduce((p,u)=>{let[h,f]=a[p]||[0,0],[m,v]=a[u];return m>h||m===h&&v>f?u:p},"	")),t?.(`Auto-detected delimiter: '${i==="	"?"\\t":i}'`);let o=[],r=0;for(let p of s)if(p.trim()){let u=p.split(i).map(h=>h.trim());o.push(u),r=Math.max(r,u.length)}for(let p of o)for(;p.length<r;)p.push("");return t?.(`Text processing complete: ${o.length} rows, ${r} columns`),this.processedData=o,o}async getClipboardText(){return await wt.env.clipboard.readText()}async processClipboardData(e,t){t?.("Getting clipboard data...");let s=await this.getClipboardText();if(!s)throw new Error("No data found in clipboard");t?.(`Data size: ${s.length} characters`);let n="TEXT";e==="XML Spreadsheet"||!e&&s.includes("<Workbook")&&s.includes("<Worksheet")?n="XML Spreadsheet":e==="TEXT"&&(n="TEXT"),t?.(`Detected format: ${n}`);let a;return n==="XML Spreadsheet"?a=this.processXmlSpreadsheet(s,t):a=this.processTextData(s,t),t?.(`Processed ${a.length} rows`),a.length&&t?.(`Columns per row: ${a[0].length}`),[a,n]}}});var Zt={};te(Zt,{activate:()=>Gt,deactivate:()=>Kt});module.exports=Nt(Zt);var c=P(require("vscode"));pe();He();var ue=P(require("vscode")),Ne=class l{constructor(e,t,s){this.extensionUri=t;this.connectionManager=s;this._disposables=[];this._panel=e,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.html=this._getHtmlForWebview(this._panel.webview),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"save":await this.connectionManager.saveConnection(n.data),ue.window.showInformationMessage("Connection saved!"),this.dispose();return}},null,this._disposables)}static createOrShow(e,t){let s=ue.window.activeTextEditor?ue.window.activeTextEditor.viewColumn:void 0;if(l.currentPanel){l.currentPanel._panel.reveal(s);return}let n=ue.window.createWebviewPanel("netezzaLogin","Connect to Netezza",s||ue.ViewColumn.One,{enableScripts:!0});l.currentPanel=new l(n,e,t)}dispose(){for(l.currentPanel=void 0,this._panel.dispose();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}_getHtmlForWebview(e){return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Connect to Netezza</title>
            <style>
                body { font-family: var(--vscode-font-family); padding: 20px; color: var(--vscode-editor-foreground); background-color: var(--vscode-editor-background); }
                .form-group { margin-bottom: 15px; }
                label { display: block; margin-bottom: 5px; }
                input { width: 100%; padding: 8px; box-sizing: border-box; background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); }
                button { background: var(--vscode-button-background); color: var(--vscode-button-foreground); padding: 10px 20px; border: none; cursor: pointer; }
                button:hover { background: var(--vscode-button-hoverBackground); }
            </style>
        </head>
        <body>
            <h2>Connect to Netezza</h2>
            <div class="form-group">
                <label for="host">Host</label>
                <input type="text" id="host" placeholder="nzhost">
            </div>
            <div class="form-group">
                <label for="port">Port</label>
                <input type="number" id="port" value="5480">
            </div>
            <div class="form-group">
                <label for="database">Database</label>
                <input type="text" id="database" placeholder="system">
            </div>
            <div class="form-group">
                <label for="user">User</label>
                <input type="text" id="user" placeholder="admin">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password">
            </div>
            <button onclick="save()">Save Connection</button>

            <script>
                const vscode = acquireVsCodeApi();
                function save() {
                    const host = document.getElementById('host').value;
                    const port = document.getElementById('port').value;
                    const database = document.getElementById('database').value;
                    const user = document.getElementById('user').value;
                    const password = document.getElementById('password').value;
                    
                    vscode.postMessage({
                        command: 'save',
                        data: { host, port, database, user, password }
                    });
                }
            </script>
        </body>
        </html>`}};We();var X=P(require("vscode")),ve=class{constructor(e){this._resultsMap=new Map;this._pinnedSources=new Set;this._pinnedResults=new Map;this._resultIdCounter=0;this._extensionUri=e}static{this.viewType="netezza.results"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[X.Uri.joinPath(this._extensionUri,"media")]},e.webview.html=this._getHtmlForWebview(),e.webview.onDidReceiveMessage(n=>{switch(n.command){case"exportCsv":this.exportCsv(n.data);return;case"openInExcel":this.openInExcel(n.data);return;case"switchSource":this._activeSourceUri=n.sourceUri,this._updateWebview();return;case"togglePin":this._pinnedSources.has(n.sourceUri)?this._pinnedSources.delete(n.sourceUri):this._pinnedSources.add(n.sourceUri),this._updateWebview();return;case"toggleResultPin":this._toggleResultPin(n.sourceUri,n.resultSetIndex);return;case"switchToPinnedResult":this._switchToPinnedResult(n.resultId);return;case"unpinResult":this._pinnedResults.delete(n.resultId),this._updateWebview();return;case"closeSource":this.closeSource(n.sourceUri);return;case"copyToClipboard":X.env.clipboard.writeText(n.text),X.window.showInformationMessage("Copied to clipboard");return;case"info":X.window.showInformationMessage(n.text);return;case"error":X.window.showErrorMessage(n.text);return}})}setActiveSource(e){this._resultsMap.has(e)&&this._activeSourceUri!==e&&(this._activeSourceUri=e,this._updateWebview())}updateResults(e,t,s=!1){this._resultsMap.has(t)||this._pinnedSources.add(t);let n=[];Array.isArray(e)?n=e:n=[e];let a=this._resultsMap.get(t)||[],i=Array.from(this._pinnedResults.entries()).filter(([p,u])=>u.sourceUri===t).sort((p,u)=>p[1].resultSetIndex-u[1].resultSetIndex),o=[],r=[];i.forEach(([p,u])=>{u.resultSetIndex<a.length&&(o.push(a[u.resultSetIndex]),r.push([p,u]))}),o.push(...n),r.forEach(([p,u],h)=>{let f=this._pinnedResults.get(p);f&&(f.resultSetIndex=h)}),s||Array.from(this._resultsMap.keys()).filter(u=>u!==t&&!this._pinnedSources.has(u)).forEach(u=>{this._resultsMap.delete(u),Array.from(this._pinnedResults.entries()).filter(([f,m])=>m.sourceUri===u).map(([f,m])=>f).forEach(f=>this._pinnedResults.delete(f))}),this._resultsMap.set(t,o),this._activeSourceUri=t,this._view?(this._updateWebview(),this._view.show?.(!0)):X.window.showInformationMessage('Query completed. Please open "Query Results" panel to view data.')}_updateWebview(){this._view&&(this._view.webview.html=this._getHtmlForWebview())}_toggleResultPin(e,t){let s=Array.from(this._pinnedResults.entries()).find(([n,a])=>a.sourceUri===e&&a.resultSetIndex===t);if(s)this._pinnedResults.delete(s[0]);else{let n=`result_${++this._resultIdCounter}`,a=Date.now(),o=`${e.split(/[\\/]/).pop()||e} - Result ${t+1}`;this._pinnedResults.set(n,{sourceUri:e,resultSetIndex:t,timestamp:a,label:o})}this._updateWebview()}_switchToPinnedResult(e){let t=this._pinnedResults.get(e);t&&(this._activeSourceUri=t.sourceUri,this._updateWebview(),this._view&&this._view.webview.postMessage({command:"switchToResultSet",resultSetIndex:t.resultSetIndex}))}async exportCsv(e){let t=await X.window.showSaveDialog({filters:{"CSV Files":["csv"]},saveLabel:"Export"});t&&(await X.workspace.fs.writeFile(t,Buffer.from(e)),X.window.showInformationMessage(`Results exported to ${t.fsPath}`))}async openInExcel(e){X.commands.executeCommand("netezza.exportCurrentResultToXlsbAndOpen",e)}closeSource(e){if(this._resultsMap.has(e)){if(this._resultsMap.delete(e),this._pinnedSources.delete(e),Array.from(this._pinnedResults.entries()).filter(([s,n])=>n.sourceUri===e).map(([s,n])=>s).forEach(s=>this._pinnedResults.delete(s)),this._activeSourceUri===e){let s=Array.from(this._resultsMap.keys());this._activeSourceUri=s.length>0?s[0]:void 0}this._updateWebview()}}_getHtmlForWebview(){if(!this._view)return"";let{scriptUri:e,virtualUri:t,mainScriptUri:s,styleUri:n}=this._getScriptUris(),a=this._prepareViewData();return this._buildHtmlDocument(e,t,s,n,a)}_getScriptUris(){return{scriptUri:this._view.webview.asWebviewUri(X.Uri.joinPath(this._extensionUri,"media","tanstack-table-core.js")),virtualUri:this._view.webview.asWebviewUri(X.Uri.joinPath(this._extensionUri,"media","tanstack-virtual-core.js")),mainScriptUri:this._view.webview.asWebviewUri(X.Uri.joinPath(this._extensionUri,"media","resultPanel.js")),styleUri:this._view.webview.asWebviewUri(X.Uri.joinPath(this._extensionUri,"media","resultPanel.css"))}}_prepareViewData(){let e=Array.from(this._resultsMap.keys()),t=Array.from(this._pinnedSources),s=Array.from(this._pinnedResults.entries()).map(([o,r])=>({id:o,...r})),n=this._activeSourceUri&&this._resultsMap.has(this._activeSourceUri)?this._activeSourceUri:e.length>0?e[0]:null,a=n?this._resultsMap.get(n):[],i=(o,r)=>typeof r=="bigint"?r>=Number.MIN_SAFE_INTEGER&&r<=Number.MAX_SAFE_INTEGER?Number(r):r.toString():r;return{sourcesJson:JSON.stringify(e),pinnedSourcesJson:JSON.stringify(t),pinnedResultsJson:JSON.stringify(s),activeSourceJson:JSON.stringify(n),resultSetsJson:JSON.stringify(a,i)}}_buildHtmlDocument(e,t,s,n,a){let i=this._view.webview.cspSource;return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src ${i} 'unsafe-inline'; style-src ${i} 'unsafe-inline';">
            <title>Query Results</title>
            <script src="${e}"></script>
            <script src="${t}"></script>
            <link rel="stylesheet" href="${n}">
        </head>
        <body>
            <div id="sourceTabs" class="source-tabs"></div>
            <div id="resultSetTabs" class="result-set-tabs" style="display: none;"></div>
            
            <div class="controls">
                <button onclick="toggleRowView()" title="Toggle Row View">\u{1F441}\uFE0F Row View</button>
                <button onclick="openInExcel()" title="Open results in Excel">\u{1F4CA} Excel</button>
                <button onclick="exportToCsv()" title="Export results to CSV">\u{1F4C4} CSV</button>
                <div style="width: 1px; height: 16px; background: var(--vscode-panel-border); margin: 0 4px;"></div>
                <button onclick="selectAll()" title="Select all rows">\u2611\uFE0F Select All</button>
                <button onclick="copySelection(false)" title="Copy selected cells to clipboard">\u{1F4CB} Copy</button>
                <button onclick="copySelection(true)" title="Copy selected cells with headers">\u{1F4CB} Copy w/ Headers</button>
                <button onclick="clearAllFilters()" title="Clear all column filters">\u{1F6AB} Clear Filters</button>
                <input type="text" id="globalFilter" placeholder="Filter..." onkeyup="onFilterChanged()" style="background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); padding: 4px;">
                <span id="rowCountInfo" style="margin-left: auto; font-size: 12px; opacity: 0.8;"></span>
            </div>

            <div id="groupingPanel" class="grouping-panel" ondragover="onDragOverGroup(event)" ondragleave="onDragLeaveGroup(event)" ondrop="onDropGroup(event)">
                <span style="opacity: 0.5;">Drag headers here to group</span>
            </div>

            <div id="mainSplitView" class="main-split-view">
                <div id="gridContainer"></div>
                <div id="rowViewPanel" class="row-view-panel">
                    <div class="row-view-header">
                        <span>Row Details & Comparison</span>
                        <span class="row-view-close" onclick="toggleRowView()">\xD7</span>
                    </div>
                    <div id="rowViewContent" class="row-view-content">
                        <div class="row-view-placeholder">Select 1 or 2 rows to view details or compare</div>
                    </div>
                </div>
            </div>
            
            <script>
                const vscode = acquireVsCodeApi();
                window.sources = ${a.sourcesJson};
                window.pinnedSources = new Set(${a.pinnedSourcesJson});
                window.pinnedResults = ${a.pinnedResultsJson};
                window.activeSource = ${a.activeSourceJson};
                window.resultSets = ${a.resultSetsJson};
                
                let grids = [];
                let activeGridIndex = 0;
            </script>
            <script src="${s}"></script>
            <script>
                // Initialize on load
                init();
            </script>
        </body>
        </html>`}};var O=P(require("vscode"));pe();var Me=class{constructor(e,t){this.context=e;this.metadataCache=t}async provideCompletionItems(e,t,s,n){let a=e.getText(),i=this.stripComments(a),o=this.parseLocalDefinitions(i),r=e.lineAt(t).text.substr(0,t.character),p=r.toUpperCase(),u=t.line>0?e.lineAt(t.line-1).text:"",h=u.toUpperCase();if(/(FROM|JOIN)\s+$/.test(p)){let A=await this.getDatabases();return[...o.map(_=>{let F=new O.CompletionItem(_.name,O.CompletionItemKind.Class);return F.detail=_.type,F}),...A]}if(/(?:FROM|JOIN)\s*$/i.test(u)&&/^\s*[a-zA-Z0-9_]*$/.test(r)){let A=await this.getDatabases();return[...o.map(_=>{let F=new O.CompletionItem(_.name,O.CompletionItemKind.Class);return F.detail=_.type,F}),...A]}let f=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.\s*$/i);if(f){let A=f[1],I=await this.getSchemas(A);return new O.CompletionList(I,!1)}let m=r.match(/^\s*([a-zA-Z0-9_]+)\.\s*$/i);if(m&&/(?:FROM|JOIN)\s*$/i.test(u)){let A=m[1],I=await this.getSchemas(A);return new O.CompletionList(I,!1)}let v=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)\.$/i);if(v){let A=v[1],I=v[2];return this.getTables(A,I)}let b=r.match(/^\s*([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)\.\s*$/i);if(b&&/(?:FROM|JOIN)\s*$/i.test(u)){let A=b[1],I=b[2];return this.getTables(A,I)}let N=r.match(/(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)\.\.$/i);if(N){let A=N[1];return this.getTables(A,void 0)}let L=r.match(/^\s*([a-zA-Z0-9_]+)\.\.\s*$/i);if(L&&/(?:FROM|JOIN)\s*$/i.test(u)){let A=L[1];return this.getTables(A,void 0)}if(r.trim().endsWith(".")){let A=r.trim().split(/[\s.]+/),I=r.match(/([a-zA-Z0-9_]+)\.$/);if(I){let _=I[1],F=this.findAlias(i,_);if(F){let G=o.find(j=>j.name.toUpperCase()===F.table.toUpperCase());return G?G.columns.map(j=>{let ae=new O.CompletionItem(j,O.CompletionItemKind.Field);return ae.detail="Local Column",ae}):this.getColumns(F.db,F.schema,F.table)}let ie=o.find(G=>G.name.toUpperCase()===_.toUpperCase());if(ie)return ie.columns.map(G=>{let j=new O.CompletionItem(G,O.CompletionItemKind.Field);return j.detail="Local Column",j})}}return this.getKeywords()}stripComments(e){let t=e.replace(/--.*$/gm,"");return t=t.replace(/\/\*[\s\S]*?\*\//g,""),t}parseLocalDefinitions(e){let t=[],s=/CREATE\s+TABLE\s+([a-zA-Z0-9_]+)\s+AS\s*\(/gi,n;for(;(n=s.exec(e))!==null;){let o=n[1],r=n.index+n[0].length,p=this.extractBalancedParenthesisContent(e,r);if(p){let u=this.extractColumnsFromQuery(p);t.push({name:o,type:"Temp Table",columns:u})}}let a=/\bWITH\s+/gi;for(;(n=a.exec(e))!==null;){let o=n.index+n[0].length;for(;;){let r=/^\s*([a-zA-Z0-9_]+)\s+AS\s*\(/i,p=e.substring(o),u=p.match(r);if(!u)break;let h=u[1],f=o+u[0].length,m=this.extractBalancedParenthesisContent(e,o+u[0].length-1),v=p.indexOf("(",u.index+u[1].length),b=o+v,N=this.extractBalancedParenthesisContent(e,b+1);if(N){let L=this.extractColumnsFromQuery(N);t.push({name:h,type:"CTE",columns:L}),o=b+1+N.length+1;let A=/^\s*,/,I=e.substring(o);if(A.test(I)){let _=I.match(A);o+=_[0].length}else break}else break}}let i=/\bJOIN\s+\(/gi;for(;(n=i.exec(e))!==null;){let o=n.index+n[0].length,r=this.extractBalancedParenthesisContent(e,o);if(r&&/^\s*SELECT\b/i.test(r)){let p=o+r.length+1,h=e.substring(p).match(/^\s+(?:AS\s+)?([a-zA-Z0-9_]+)/i);if(h){let f=h[1],m=this.extractColumnsFromQuery(r);t.push({name:f,type:"Subquery",columns:m})}}}return t}extractBalancedParenthesisContent(e,t){let s=1,n=t;for(;n<e.length;n++)if(e[n]==="("?s++:e[n]===")"&&s--,s===0)return e.substring(t,n);return null}extractColumnsFromQuery(e){let t=e.match(/^\s*SELECT\s+/i);if(!t)return[];let s="",n=0,a=-1,i=t[0].length;for(let p=i;p<e.length;p++)if(e[p]==="("?n++:e[p]===")"&&n--,n===0&&e.substr(p).match(/^\s+FROM\b/i)){a=p;break}a!==-1?s=e.substring(i,a):s=e.substring(i);let o=[],r="";n=0;for(let p=0;p<s.length;p++){let u=s[p];u==="("?n++:u===")"&&n--,u===","&&n===0?(o.push(r.trim()),r=""):r+=u}return r.trim()&&o.push(r.trim()),o.map(p=>{let u=p.match(/\s+AS\s+([a-zA-Z0-9_]+)$/i);if(u)return u[1];let h=p.match(/\s+([a-zA-Z0-9_]+)$/i);if(h)return h[1];let f=p.split(".");return f[f.length-1]})}getKeywords(){return["SELECT","FROM","WHERE","GROUP BY","ORDER BY","LIMIT","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","DROP","TABLE","VIEW","DATABASE","JOIN","INNER","LEFT","RIGHT","OUTER","ON","AND","OR","NOT","NULL","IS","IN","BETWEEN","LIKE","AS","DISTINCT","CASE","WHEN","THEN","ELSE","END","WITH","UNION","ALL"].map(t=>{let s=new O.CompletionItem(t,O.CompletionItemKind.Keyword);return s.detail="SQL Keyword",s})}async getDatabases(){let e=this.metadataCache.getDatabases();if(e)return e.map(t=>{if(t instanceof O.CompletionItem)return t;let s=new O.CompletionItem(t.label,t.kind);return s.detail=t.detail,s});try{let s=await x(this.context,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0);if(!s)return[];let a=JSON.parse(s).map(i=>{let o=new O.CompletionItem(i.DATABASE,O.CompletionItemKind.Module);return o.detail="Database",o});return this.metadataCache.setDatabases(a),a}catch(t){return console.error(t),[]}}async getSchemas(e){let t=this.metadataCache.getSchemas(e);if(t)return t.map(n=>{if(n instanceof O.CompletionItem)return n;let a=new O.CompletionItem(n.label,n.kind);return a.detail=n.detail,a.insertText=n.insertText,a.sortText=n.sortText,a.filterText=n.filterText,a});let s=O.window.setStatusBarMessage(`Fetching schemas for ${e}...`);try{let n=`SELECT SCHEMA FROM ${e}.._V_SCHEMA ORDER BY SCHEMA`,a=await x(this.context,n,!0);if(!a)return[];let o=JSON.parse(a).filter(r=>r.SCHEMA!=null&&r.SCHEMA!=="").map(r=>{let p=r.SCHEMA,u=new O.CompletionItem(p,O.CompletionItemKind.Folder);return u.detail=`Schema in ${e}`,u.insertText=p,u.sortText=p,u.filterText=p,u});return this.metadataCache.setSchemas(e,o),o}catch(n){return console.error("[SqlCompletion] Error in getSchemas:",n),[]}finally{s.dispose()}}async getTables(e,t){let s=t?`${e}.${t}`:`${e}..`,n=this.metadataCache.getTables(s);if(n)return n.map(o=>{if(o instanceof O.CompletionItem)return o;let r=new O.CompletionItem(o.label,o.kind);return r.detail=o.detail,r.sortText=o.sortText,r});let a=t?`Fetching tables for ${e}.${t}...`:`Fetching tables for ${e}...`,i=O.window.setStatusBarMessage(a);try{let o="";t?o=`SELECT OBJNAME, OBJID FROM ${e}.._V_OBJECT_DATA WHERE UPPER(DBNAME) = UPPER('${e}') AND UPPER(SCHEMA) = UPPER('${t}') AND OBJTYPE='TABLE' ORDER BY OBJNAME`:o=`SELECT OBJNAME, OBJID, SCHEMA FROM ${e}.._V_OBJECT_DATA WHERE UPPER(DBNAME) = UPPER('${e}') AND OBJTYPE='TABLE' ORDER BY OBJNAME`;let r=await x(this.context,o,!0);if(!r)return[];let p=JSON.parse(r),u=new Map,h=p.map(f=>{let m=new O.CompletionItem(f.OBJNAME,O.CompletionItemKind.Class);m.detail=t?"Table":`Table (${f.SCHEMA})`,m.sortText=f.OBJNAME;let v=t?`${e}.${t}.${f.OBJNAME}`:`${e}..${f.OBJNAME}`;return u.set(v,f.OBJID),!t&&f.SCHEMA&&u.set(`${e}.${f.SCHEMA}.${f.OBJNAME}`,f.OBJID),m});return this.metadataCache.setTables(s,h,u),h}catch(o){return console.error(o),[]}finally{i.dispose()}}async getColumns(e,t,s){let n,a=e?`${e}..`:"",i=t&&e?`${e}.${t}.${s}`:e?`${e}..${s}`:void 0;i&&(n=this.metadataCache.findTableId(i));let o=`${e||"CURRENT"}.${t||""}.${s}`,r=this.metadataCache.getColumns(o);if(r)return r.map(u=>{if(u instanceof O.CompletionItem)return u;let h=new O.CompletionItem(u.label,u.kind);return h.detail=u.detail,h});let p=O.window.setStatusBarMessage(`Fetching columns for ${s}...`);try{let u="";if(n)u=`SELECT ATTNAME, FORMAT_TYPE FROM ${a}_V_RELATION_COLUMN WHERE OBJID = ${n} ORDER BY ATTNUM`;else{let v=t?`AND UPPER(SCHEMA) = UPPER('${t}')`:"",b=e?`AND UPPER(DBNAME) = UPPER('${e}')`:"";u=`
                    SELECT C.ATTNAME, C.FORMAT_TYPE 
                    FROM ${a}_V_RELATION_COLUMN C
                    JOIN ${a}_V_OBJECT_DATA O ON C.OBJID = O.OBJID
                    WHERE UPPER(O.OBJNAME) = UPPER('${s}') ${v} ${b}
                    ORDER BY C.ATTNUM
                `}let h=await x(this.context,u,!0);if(!h)return[];let m=JSON.parse(h).map(v=>{let b=new O.CompletionItem(v.ATTNAME,O.CompletionItemKind.Field);return b.detail=v.FORMAT_TYPE,b});return this.metadataCache.setColumns(o,m),m}catch(u){return console.error(u),[]}finally{p.dispose()}}findAlias(e,t){let s=new RegExp(`([a-zA-Z0-9_\\.]+) (?:AS\\s+)?${t}\\b`,"gi"),n=new Set(["SELECT","WHERE","GROUP","ORDER","HAVING","LIMIT","ON","AND","OR","NOT","CASE","WHEN","THEN","ELSE","END","JOIN","LEFT","RIGHT","INNER","OUTER","CROSS","FULL","UNION","EXCEPT","INTERSECT","FROM","UPDATE","DELETE","INSERT","INTO","VALUES","SET"]),a;for(;(a=s.exec(e))!==null;){let i=a[1];if(n.has(i.toUpperCase()))continue;let o=i.split(".");return o.length===3?{db:o[0],schema:o[1],table:o[2]}:o.length===2?{table:o[1],schema:o[0]}:{table:o[0]}}return null}};var Oe=P(require("vscode"));pe();var ye=class{constructor(e,t,s){this._extensionUri=e;this.context=t;this.metadataCache=s}static{this.viewType="netezza.search"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),e.webview.onDidReceiveMessage(async n=>{switch(n.type){case"search":await this.search(n.value);break;case"navigate":Oe.commands.executeCommand("netezza.revealInSchema",n);break}})}async search(e){if(!e||e.length<2)return;let t=Oe.window.setStatusBarMessage(`$(search) Searching for "${e}"...`),s=new Set;if(this._view){let o=this.metadataCache.search(e);if(o.length>0){let r=o.map(p=>(s.add(`${p.name}|${p.type}|${p.parent||""}`),{NAME:p.name,SCHEMA:p.schema,DATABASE:p.database,TYPE:p.type,PARENT:p.parent||"",DESCRIPTION:"Result from Cache",MATCH_TYPE:"NAME"}));this._view.webview.postMessage({type:"results",data:r,append:!1})}else this._view.webview.postMessage({type:"results",data:[],append:!1})}let a=`%${e.replace(/'/g,"''").toUpperCase()}%`,i=`
            SELECT OBJNAME AS NAME, SCHEMA, DBNAME AS DATABASE, OBJTYPE AS TYPE, '' AS PARENT, 
                   COALESCE(DESCRIPTION, '') AS DESCRIPTION, 'NAME' AS MATCH_TYPE
            FROM _V_OBJECT_DATA 
            WHERE UPPER(OBJNAME) LIKE '${a}'
            UNION ALL
            SELECT C.ATTNAME AS NAME, O.SCHEMA, O.DBNAME AS DATABASE, 'COLUMN' AS TYPE, O.OBJNAME AS PARENT,
                   COALESCE(C.DESCRIPTION, '') AS DESCRIPTION, 'NAME' AS MATCH_TYPE
            FROM _V_RELATION_COLUMN C
            JOIN _V_OBJECT_DATA O ON C.OBJID = O.OBJID
            WHERE UPPER(C.ATTNAME) LIKE '${a}'
            UNION ALL
            SELECT V.VIEWNAME AS NAME, V.SCHEMA, V.DATABASE, 'VIEW' AS TYPE, '' AS PARENT,
                   'Found in view definition' AS DESCRIPTION, 'DEFINITION' AS MATCH_TYPE
            FROM _V_VIEW V
            WHERE UPPER(V.DEFINITION) LIKE '${a}'
            UNION ALL
            SELECT P.PROCEDURE AS NAME, P.SCHEMA, P.DATABASE, 'PROCEDURE' AS TYPE, '' AS PARENT,
                   'Found in procedure source' AS DESCRIPTION, 'SOURCE' AS MATCH_TYPE
            FROM _V_PROCEDURE P
            WHERE UPPER(P.PROCEDURESOURCE) LIKE '${a}'
            ORDER BY TYPE, NAME
        `;try{let o=await x(this.context,i,!0);if(t.dispose(),this._view&&o){let r=JSON.parse(o);s.size>0&&(r=r.filter(p=>{let u=`${p.NAME}|${p.TYPE}|${p.PARENT||""}`;return!s.has(u)})),r.length>0?this._view.webview.postMessage({type:"results",data:r,append:!0}):s.size}}catch(o){t.dispose(),this._view&&this._view.webview.postMessage({type:"error",message:o.message})}}_getHtmlForWebview(e){return`<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Schema Search</title>
            <style>
                body { font-family: var(--vscode-font-family); padding: 10px; color: var(--vscode-foreground); }
                .search-box { display: flex; gap: 5px; margin-bottom: 10px; }
                input { flex-grow: 1; padding: 5px; background: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); }
                button { 
                    display: inline-flex; 
                    align-items: center; 
                    justify-content: center; 
                    gap: 6px; 
                    background-color: var(--vscode-button-secondaryBackground); 
                    color: var(--vscode-button-secondaryForeground); 
                    border: 1px solid var(--vscode-contrastBorder, transparent); 
                    padding: 4px 10px; 
                    cursor: pointer; 
                    border-radius: 2px; 
                    font-family: var(--vscode-font-family); 
                    font-size: 12px; 
                    line-height: 18px; 
                }
                button:hover { background-color: var(--vscode-button-secondaryHoverBackground); }
                button.primary { background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); }
                button.primary:hover { background-color: var(--vscode-button-hoverBackground); }
                .results { list-style: none; padding: 0; }
                .result-item { padding: 5px; border-bottom: 1px solid var(--vscode-panel-border); display: flex; flex-direction: column; cursor: pointer; position: relative; }
                .result-item:hover { background: var(--vscode-list-hoverBackground); }
                .item-header { display: flex; justify-content: space-between; font-weight: bold; }
                .item-details { font-size: 0.9em; opacity: 0.8; display: flex; gap: 10px; }
                .type-badge { font-size: 0.8em; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); padding: 2px 5px; border-radius: 3px; }
                .tooltip { position: absolute; background: var(--vscode-editorHoverWidget-background); color: var(--vscode-editorHoverWidget-foreground); border: 1px solid var(--vscode-editorHoverWidget-border); padding: 8px; border-radius: 4px; font-size: 0.9em; max-width: 300px; word-wrap: break-word; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; pointer-events: none; }
                .result-item:hover .tooltip { opacity: 1; visibility: visible; }
                .tooltip.top { bottom: 100%; left: 0; margin-bottom: 5px; }
                .tooltip.bottom { top: 100%; left: 0; margin-top: 5px; }
                .cache-badge { background-color: var(--vscode-charts-green); color: white; padding: 1px 4px; border-radius: 2px; font-size: 0.7em; margin-left: 5px; }
            </style>
        </head>
        <body>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search tables, columns, view definitions, procedure source..." />
                <button id="searchBtn" class="primary">Search</button>
            </div>
            <div id="status"></div>
            <ul class="results" id="resultsList"></ul>

            <script>
                const vscode = acquireVsCodeApi();
                const searchInput = document.getElementById('searchInput');
                const searchBtn = document.getElementById('searchBtn');
                const resultsList = document.getElementById('resultsList');
                const status = document.getElementById('status');

                searchBtn.addEventListener('click', () => {
                    const term = searchInput.value;
                    if (term) {
                        status.textContent = 'Searching...';
                        // Keep results until new ones come (or clear? we clear inside search handler if necessary or by postMessage)
                        // resultsList.innerHTML = ''; // Don't clear immediately, let the backend drive it
                        vscode.postMessage({ type: 'search', value: term });
                    }
                });

                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchBtn.click();
                    }
                });

                window.addEventListener('message', event => {
                    const message = event.data;
                    switch (message.type) {
                        case 'results':
                            status.textContent = '';
                            renderResults(message.data, message.append);
                            break;
                        case 'error':
                            status.textContent = 'Error: ' + message.message;
                            break;
                    }
                });

                function renderResults(data, append) {
                    if (!append) {
                        resultsList.innerHTML = '';
                    }

                    if (!data || data.length === 0) {
                        if (!append && resultsList.children.length === 0) {
                            status.textContent = 'No results found.';
                        }
                        return;
                    }
                    
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'result-item';
                        
                        const parentInfo = item.PARENT ? \`Parent: \${item.PARENT}\` : '';
                        const schemaInfo = item.SCHEMA ? \`Schema: \${item.SCHEMA}\` : '';
                        const databaseInfo = item.DATABASE ? \`Database: \${item.DATABASE}\` : '';
                        const description = item.DESCRIPTION && item.DESCRIPTION.trim() ? item.DESCRIPTION : '';
                        
                        // Add match type indicator
                        const matchTypeInfo = item.MATCH_TYPE === 'DEFINITION' ? 'Match in view definition' :
                                            item.MATCH_TYPE === 'SOURCE' ? 'Match in procedure source' :
                                            item.MATCH_TYPE === 'NAME' ? 'Match in name' : '';
                        
                        li.innerHTML = \`
                            <div class="item-header">
                                <span>\${item.NAME}</span>
                                <span class="type-badge">\${item.TYPE}</span>
                            </div>
                            <div class="item-details">
                                <span>\${databaseInfo}</span>
                                <span>\${schemaInfo}</span>
                                <span>\${parentInfo}</span>
                                \${matchTypeInfo ? \`<span style="font-style: italic; color: var(--vscode-descriptionForeground);">\${matchTypeInfo}</span>\` : ''}
                            </div>
                            \${description ? \`<div class="tooltip bottom">\${description}</div>\` : ''}
                        \`;
                        
                        // Add double-click handler to navigate to schema tree
                        li.addEventListener('dblclick', () => {
                            vscode.postMessage({ 
                                type: 'navigate', 
                                name: item.NAME,
                                schema: item.SCHEMA,
                                database: item.DATABASE,
                                objType: item.TYPE,
                                parent: item.PARENT
                            });
                        });
                        
                        resultsList.appendChild(li);
                    });
                }
            </script>
        </body>
        </html>`}};var oe=class{static splitStatements(e){let t=[],s="",n=!1,a=!1,i=!1,o=!1,r=0;for(;r<e.length;){let p=e[r],u=r+1<e.length?e[r+1]:"";if(i)p===`
`&&(i=!1);else if(o){if(p==="*"&&u==="/"){o=!1,s+=p+u,r++,r++;continue}}else if(n)p==="'"&&e[r-1]!=="\\"&&(n=!1);else if(a)p==='"'&&e[r-1]!=="\\"&&(a=!1);else if(p==="-"&&u==="-")i=!0;else if(p==="/"&&u==="*")o=!0;else if(p==="'")n=!0;else if(p==='"')a=!0;else if(p===";"){s.trim()&&t.push(s.trim()),s="",r++;continue}s+=p,r++}return s.trim()&&t.push(s.trim()),t}static getStatementAtPosition(e,t){let s=0,n=e.length,a=!1,i=!1,o=!1,r=!1,p=-1;for(let h=0;h<t;h++){let f=e[h],m=h+1<e.length?e[h+1]:"";o?f===`
`&&(o=!1):r?f==="*"&&m==="/"&&(r=!1,h++):a?f==="'"&&e[h-1]!=="\\"&&(a=!1):i?f==='"'&&e[h-1]!=="\\"&&(i=!1):f==="-"&&m==="-"?o=!0:f==="/"&&m==="*"?r=!0:f==="'"?a=!0:f==='"'?i=!0:f===";"&&(p=h)}s=p+1,a=!1,i=!1,o=!1,r=!1;for(let h=s;h<e.length;h++){let f=e[h],m=h+1<e.length?e[h+1]:"";if(o)f===`
`&&(o=!1);else if(r)f==="*"&&m==="/"&&(r=!1,h++);else if(a)f==="'"&&e[h-1]!=="\\"&&(a=!1);else if(i)f==='"'&&e[h-1]!=="\\"&&(i=!1);else if(f==="-"&&m==="-")o=!0;else if(f==="/"&&m==="*")r=!0;else if(f==="'")a=!0;else if(f==='"')i=!0;else if(f===";"){n=h;break}}let u=e.substring(s,n).trim();return u?{sql:u,start:s,end:n}:null}static getObjectAtPosition(e,t){let s=p=>/[a-zA-Z0-9_."]/i.test(p),n=t;for(;n>0&&s(e[n-1]);)n--;let a=t;for(;a<e.length&&s(e[a]);)a++;let i=e.substring(n,a);if(!i)return null;let o=p=>p?p.replace(/"/g,""):void 0;if(i.includes("..")){let p=i.split("..");if(p.length===2)return{database:o(p[0]),name:o(p[1])}}let r=i.split(".");return r.length===1?{name:o(r[0])}:r.length===2?{schema:o(r[0]),name:o(r[1])}:r.length===3?{database:o(r[0]),schema:o(r[1]),name:o(r[2])}:null}};var me=P(require("vscode"));var $e=class{provideDocumentLinks(e,t){let s=[],n=e.getText(),a=/[a-zA-Z0-9_"]+(\.[a-zA-Z0-9_"]*)+/g,i;for(;(i=a.exec(n))!==null;){let o=e.positionAt(i.index),r=e.positionAt(i.index+i[0].length),p=new me.Range(o,r),u=oe.getObjectAtPosition(n,i.index+Math.floor(i[0].length/2));if(u){if(i[0].split(".").length===2&&!u.database&&this.isLikelyAliasReference(n,i.index))continue;let m={name:u.name,schema:u.schema,database:u.database},v=me.Uri.parse(`command:netezza.revealInSchema?${encodeURIComponent(JSON.stringify(m))}`),b=new me.DocumentLink(p,v);b.tooltip=`Reveal ${u.name} in Schema`,s.push(b)}}return s}isLikelyAliasReference(e,t){let n=e.substring(Math.max(0,t-200),t).replace(/--[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").toUpperCase();return/(?:FROM|JOIN)\s+[a-zA-Z0-9_"]*$/i.test(n)?!1:!!n.match(/\b(SELECT|WHERE|ON|HAVING|ORDER\s+BY|GROUP\s+BY|AND|OR|SET|VALUES)\b(?!.*\b(?:FROM|JOIN)\b)/)}};var xe=P(require("vscode")),Le=class{provideFoldingRanges(e,t,s){let n=[],a=[],i=/^\s*--\s*REGION\b/i,o=/^\s*--\s*ENDREGION\b/i;for(let r=0;r<e.lineCount;r++){let u=e.lineAt(r).text;if(i.test(u))a.push(r);else if(o.test(u)&&a.length>0){let h=a.pop();n.push(new xe.FoldingRange(h,r,xe.FoldingRangeKind.Region))}}return n}};var W=P(require("vscode"));Ie();var Ce=class{constructor(e,t){this._extensionUri=e;this._context=t}static{this.viewType="netezza.queryHistory"}resolveWebviewView(e,t,s){this._view=e,e.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},e.webview.html=this._getHtmlForWebview(e.webview),this.sendHistoryToWebview(),e.webview.onDidReceiveMessage(async n=>{switch(n.type){case"refresh":this.refresh();break;case"clearAll":await this.clearAllHistory();break;case"deleteEntry":await this.deleteEntry(n.id,n.query);break;case"copyQuery":await W.env.clipboard.writeText(n.query),W.window.showInformationMessage("Query copied to clipboard");break;case"executeQuery":await this.executeQuery(n.query);break;case"getHistory":await this.sendHistoryToWebview();break;case"toggleFavorite":await this.toggleFavorite(n.id);break;case"updateEntry":await this.updateEntry(n.id,n.tags,n.description);break;case"requestEdit":await this.requestEdit(n.id);break;case"requestTagFilter":await this.requestTagFilter(n.tags);break;case"showFavoritesOnly":await this.sendFavoritesToWebview();break;case"filterByTag":await this.sendFilteredByTagToWebview(n.tag);break}})}refresh(){this._view&&this.sendHistoryToWebview()}async sendHistoryToWebview(){if(!this._view)return;let e=new J(this._context),t=await e.getHistory(),s=await e.getStats();console.log("QueryHistoryView: sending history to webview, entries=",t.length),this._view.webview.postMessage({type:"historyData",history:t,stats:s})}async clearAllHistory(){await W.window.showWarningMessage("Are you sure you want to clear all query history?",{modal:!0},"Clear All")==="Clear All"&&(await new J(this._context).clearHistory(),this.refresh(),W.window.showInformationMessage("Query history cleared"))}async deleteEntry(e,t){let s=t?`: ${t.substring(0,50)}${t.length>50?"...":""}`:"";await W.window.showWarningMessage(`Are you sure you want to delete this query${s}?`,{modal:!0},"Delete")==="Delete"&&(await new J(this._context).deleteEntry(e),this.refresh())}async executeQuery(e){let t=await W.workspace.openTextDocument({content:e,language:"sql"});await W.window.showTextDocument(t)}async toggleFavorite(e){await new J(this._context).toggleFavorite(e),this.refresh()}async updateEntry(e,t,s){await new J(this._context).updateEntry(e,t,s),this.refresh(),W.window.showInformationMessage("Entry updated successfully")}async requestEdit(e){let n=(await new J(this._context).getHistory()).find(o=>o.id===e);if(!n){W.window.showErrorMessage("Entry not found");return}let a=await W.window.showInputBox({prompt:"Enter tags (comma separated)",value:n.tags||"",placeHolder:"tag1, tag2, tag3"});if(a===void 0)return;let i=await W.window.showInputBox({prompt:"Enter description",value:n.description||"",placeHolder:"Description for this query"});i!==void 0&&await this.updateEntry(e,a,i)}async requestTagFilter(e){if(e.length===1)await this.sendFilteredByTagToWebview(e[0]);else if(e.length>1){let t=await W.window.showQuickPick(e,{placeHolder:"Filter by which tag?"});t&&await this.sendFilteredByTagToWebview(t)}}async sendFavoritesToWebview(){if(!this._view)return;let e=new J(this._context),t=await e.getFavorites(),s=await e.getStats();this._view.webview.postMessage({type:"historyData",history:t,stats:s,filter:"favorites"})}async sendFilteredByTagToWebview(e){if(!this._view)return;let t=new J(this._context),s=await t.getByTag(e),n=await t.getStats();this._view.webview.postMessage({type:"historyData",history:s,stats:n,filter:`tag: ${e}`})}_getHtmlForWebview(e){let t=Mt(),s=e.asWebviewUri(W.Uri.joinPath(this._extensionUri,"media","queryHistory.css")),n=e.asWebviewUri(W.Uri.joinPath(this._extensionUri,"media","queryHistory.js"));return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${e.cspSource}; script-src ${e.cspSource};">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query History</title>
    <link href="${s}" rel="stylesheet">
</head>
<body>
    <div class="toolbar">
        <div class="toolbar-top">
            <input type="search" id="searchInput" placeholder="Search queries..." />
            <span class="stats" id="stats">Loading...</span>
        </div>
        <div class="toolbar-buttons">
            <button class="secondary" id="showAllBtn">\u{1F4DC} All</button>
            <button class="secondary" id="showFavoritesBtn">\u2B50 Favorites</button>
            <button class="secondary" id="refreshBtn">\u21BB Refresh</button>
            <button class="secondary" id="clearAllBtn">\u{1F5D1}\uFE0F Clear All</button>
        </div>
    </div>
    <div class="history-container" id="historyContainer">
        <div class="empty-state">
            <div class="empty-state-icon">\u{1F4DC}</div>
            <div>No query history yet</div>
        </div>
    </div>

    <script src="${n}"></script>
</body>
</html>`}};function Mt(){let l="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)l+=e.charAt(Math.floor(Math.random()*e.length));return l}var Pe=class{constructor(e){this.context=e;this.schemaCache=new Map;this.tableCache=new Map;this.columnCache=new Map;this.tableIdMap=new Map;this.CACHE_TTL=14400*1e3;this.savePending=!1;this.pendingCacheTypes=new Set;this.loadCacheFromWorkspaceState()}loadCacheFromWorkspaceState(){try{let e=Date.now(),t=this.context.workspaceState.get("sqlCompletion.dbCache");t&&e-t.timestamp<this.CACHE_TTL&&(this.dbCache=t);let s=this.context.workspaceState.get("sqlCompletion.schemaCache");if(s)for(let[o,r]of Object.entries(s))e-r.timestamp<this.CACHE_TTL&&this.schemaCache.set(o,r);let n=this.context.workspaceState.get("sqlCompletion.tableCache");if(n)for(let[o,r]of Object.entries(n))e-r.timestamp<this.CACHE_TTL&&this.tableCache.set(o,r);let a=this.context.workspaceState.get("sqlCompletion.tableIdMap");if(a)for(let[o,r]of Object.entries(a))(this.tableCache.has(o)||e-r.timestamp<this.CACHE_TTL)&&this.tableIdMap.set(o,{data:new Map(Object.entries(r.data)),timestamp:r.timestamp});let i=this.context.workspaceState.get("sqlCompletion.columnCache");if(i)for(let[o,r]of Object.entries(i))e-r.timestamp<this.CACHE_TTL&&this.columnCache.set(o,r)}catch(e){console.error("[MetadataCache] Error loading cache from workspace state:",e)}}scheduleSave(e){this.pendingCacheTypes.add(e),this.savePending||(this.savePending=!0,this.saveTimeoutId=setTimeout(()=>this.flushSave(),1e3))}async flushSave(){this.savePending=!1;let e=new Set(this.pendingCacheTypes);this.pendingCacheTypes.clear();try{if(e.has("db")&&this.dbCache&&await this.context.workspaceState.update("sqlCompletion.dbCache",this.dbCache),e.has("schema")&&this.schemaCache.size>0){let t={};this.schemaCache.forEach((s,n)=>{t[n]=s}),await this.context.workspaceState.update("sqlCompletion.schemaCache",t)}if(e.has("table")&&this.tableCache.size>0){let t={};this.tableCache.forEach((n,a)=>{t[a]=n}),await this.context.workspaceState.update("sqlCompletion.tableCache",t);let s={};this.tableIdMap.forEach((n,a)=>{let i={};n.data.forEach((o,r)=>{i[r]=o}),s[a]={data:i,timestamp:n.timestamp}}),await this.context.workspaceState.update("sqlCompletion.tableIdMap",s)}if(e.has("column")&&this.columnCache.size>0){let t={};this.columnCache.forEach((s,n)=>{t[n]=s}),await this.context.workspaceState.update("sqlCompletion.columnCache",t)}}catch(t){console.error("[MetadataCache] Error saving cache to workspace state:",t)}}async clearCache(){this.saveTimeoutId&&(clearTimeout(this.saveTimeoutId),this.saveTimeoutId=void 0),this.savePending=!1,this.pendingCacheTypes.clear(),this.dbCache=void 0,this.schemaCache.clear(),this.tableCache.clear(),this.columnCache.clear(),this.tableIdMap.clear(),await this.context.workspaceState.update("sqlCompletion.dbCache",void 0),await this.context.workspaceState.update("sqlCompletion.schemaCache",void 0),await this.context.workspaceState.update("sqlCompletion.tableCache",void 0),await this.context.workspaceState.update("sqlCompletion.columnCache",void 0),await this.context.workspaceState.update("sqlCompletion.tableIdMap",void 0)}getDatabases(){return this.dbCache?.data}setDatabases(e){this.dbCache={data:e,timestamp:Date.now()},this.scheduleSave("db")}getSchemas(e){return this.schemaCache.get(e)?.data}setSchemas(e,t){this.schemaCache.set(e,{data:t,timestamp:Date.now()}),this.scheduleSave("schema")}getTables(e){return this.tableCache.get(e)?.data}setTables(e,t,s){let n=Date.now();this.tableCache.set(e,{data:t,timestamp:n}),this.tableIdMap.set(e,{data:s,timestamp:n}),this.scheduleSave("table")}getColumns(e){return this.columnCache.get(e)?.data}setColumns(e,t){this.columnCache.set(e,{data:t,timestamp:Date.now()}),this.scheduleSave("column")}findTableId(e){for(let t of this.tableIdMap.values()){let s=t.data.get(e);if(s!==void 0)return s}}search(e){let t=[],s=e.toLowerCase();for(let[n,a]of this.tableCache){let i=n.split("."),o=i[0],r=i.length>1?i[1]:void 0;for(let p of a.data){let u=typeof p.label=="string"?p.label:p.label.label;u&&u.toLowerCase().includes(s)&&t.push({name:u,type:"TABLE",database:o,schema:r||(p.detail&&p.detail.includes("(")?p.detail.match(/\((.*?)\)/)?.[1]:void 0)})}}for(let[n,a]of this.columnCache){let i=n.split("."),o=i[0],r=i[1],p=i[2];for(let u of a.data){let h=typeof u.label=="string"?u.label:u.label.label;h&&h.toLowerCase().includes(s)&&t.push({name:h,type:"COLUMN",database:o,schema:r,parent:p})}}return t}};var Tt=P(require("path"));function Ct(l,e){let t=e.getKeepConnectionOpen();l.text=t?"\u{1F517} Keep Connection ON":"\u26D3\uFE0F\u200D\u{1F4A5} Keep Connection OFF",l.tooltip=t?"Keep Connection Open: ENABLED - Click to disable":"Keep Connection Open: DISABLED - Click to enable",l.backgroundColor=t?new c.ThemeColor("statusBarItem.prominentBackground"):void 0}function Gt(l){console.log("Netezza extension: Activating..."),l.subscriptions.push({dispose:()=>{e.closePersistentConnection()}});let e=new le(l),t=new Pe(l),s=new we(l,e,t),n=new ve(l.extensionUri),a=c.window.createStatusBarItem(c.StatusBarAlignment.Right,100);a.command="netezza.toggleKeepConnectionOpen",Ct(a,e),a.show(),l.subscriptions.push(a),console.log("Netezza extension: Registering SchemaSearchProvider...");let i=new ye(l.extensionUri,l,t);console.log("Netezza extension: Registering QueryHistoryView...");let o=new Ce(l.extensionUri,l),r=c.window.createTreeView("netezza.schema",{treeDataProvider:s,showCollapseAll:!0});l.subscriptions.push(c.window.registerWebviewViewProvider(ve.viewType,n),c.window.registerWebviewViewProvider(ye.viewType,i),c.window.registerWebviewViewProvider(Ce.viewType,o));let p=/(^|\s)(?:[A-Za-z]:\\|\\|\/)?[\w.\-\\\/]+\.py\b|(^|\s)python(?:\.exe)?\s+[^\n]*\.py\b/i;function u(d){return d&&(d.includes(" ")?`"${d.replace(/"/g,'\\"')}"`:d)}function h(d,g,y){let w=/[ \\/]/.test(d)?`& ${u(d)}`:d,T=u(g),S=y.map(E=>u(E)).join(" ");return`${w} ${T}${S?" "+S:""}`.trim()}class f{constructor(){this._onDidChange=new c.EventEmitter;this.onDidChangeCodeLenses=this._onDidChange.event}provideCodeLenses(g){let y=[];for(let C=0;C<g.lineCount;C++){let w=g.lineAt(C);if(p.test(w.text)){let T=w.range,S={title:"Run as script",command:"netezza.runScriptFromLens",arguments:[g.uri,T]};y.push(new c.CodeLens(T,S))}}return y}refresh(){this._onDidChange.fire()}}let m=new f;l.subscriptions.push(c.languages.registerCodeLensProvider({scheme:"file"},m));let v=c.window.createTextEditorDecorationType({backgroundColor:new c.ThemeColor("editor.rangeHighlightBackground"),borderRadius:"3px"});function b(d){let g=d||c.window.activeTextEditor;if(!g)return;let y=g.document,C=[];for(let w=0;w<y.lineCount;w++){let T=y.lineAt(w);p.test(T.text)&&C.push({range:T.range,hoverMessage:"Python script invocation"})}g.setDecorations(v,C)}l.subscriptions.push(c.window.onDidChangeActiveTextEditor(()=>b()),c.workspace.onDidChangeTextDocument(d=>{c.window.activeTextEditor&&d.document===c.window.activeTextEditor.document&&b(c.window.activeTextEditor)})),l.subscriptions.push(c.commands.registerCommand("netezza.runScriptFromLens",async(d,g)=>{try{let y=await c.workspace.openTextDocument(d),C=y.getText(g).trim()||y.lineAt(g.start.line).text.trim();if(!C){c.window.showWarningMessage("No script command found");return}let w=C.split(/\s+/),T=w[0]||"",S=/python(\\.exe)?$/i.test(T)&&w.length>=2&&w[1].toLowerCase().endsWith(".py"),E=T.toLowerCase().endsWith(".py"),D=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",M="";if(S){let k=w[0],z=w[1],Y=w.slice(2);M=h(k,z,Y)}else if(E){let k=T,z=w.slice(1);M=h(D,k,z)}else M=h(D,"",w);let B=c.window.createTerminal({name:"Netezza: Script"});B.show(!0),B.sendText(M,!0),c.window.showInformationMessage(`Running script: ${M}`)}catch(y){c.window.showErrorMessage(`Error running script: ${y.message}`)}})),b(c.window.activeTextEditor),l.subscriptions.push(c.window.onDidChangeActiveTextEditor(d=>{if(d&&d.document){let g=d.document.uri.toString();n.setActiveSource(g)}})),l.subscriptions.push(c.commands.registerCommand("netezza.toggleKeepConnectionOpen",()=>{let d=e.getKeepConnectionOpen();e.setKeepConnectionOpen(!d),Ct(a,e);let g=!d;c.window.showInformationMessage(g?"Keep connection open: ENABLED - connection will remain open after queries":"Keep connection open: DISABLED - connection will be closed after each query")}),c.commands.registerCommand("netezza.openLogin",()=>{Ne.createOrShow(l.extensionUri,e)}),c.commands.registerCommand("netezza.refreshSchema",()=>{s.refresh(),c.window.showInformationMessage("Schema refreshed")}),c.commands.registerCommand("netezza.copySelectAll",d=>{if(d&&d.label&&d.dbName&&d.schema){let g=`SELECT * FROM ${d.dbName}.${d.schema}.${d.label} LIMIT 100;`;c.env.clipboard.writeText(g),c.window.showInformationMessage("Copied to clipboard")}}),c.commands.registerCommand("netezza.copyDrop",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType){let g=`${d.dbName}.${d.schema}.${d.label}`,y=`DROP ${d.objType} ${g};`;if(await c.window.showWarningMessage(`Are you sure you want to delete ${d.objType.toLowerCase()} "${g}"?`,{modal:!0},"Yes, delete","Cancel")==="Yes, delete")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Deleting ${d.objType.toLowerCase()} ${g}...`,cancellable:!1},async T=>{await x(l,y,!0)}),c.window.showInformationMessage(`Deleted ${d.objType.toLowerCase()}: ${g}`),s.refresh()}catch(w){c.window.showErrorMessage(`Error during deletion: ${w.message}`)}}}),c.commands.registerCommand("netezza.copyName",d=>{if(d&&d.label&&d.dbName&&d.schema){let g=`${d.dbName}.${d.schema}.${d.label}`;c.env.clipboard.writeText(g),c.window.showInformationMessage("Copied to clipboard")}}),c.commands.registerCommand("netezza.grantPermissions",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType){let g=`${d.dbName}.${d.schema}.${d.label}`,y=await c.window.showQuickPick([{label:"SELECT",description:"Privileges to read data"},{label:"INSERT",description:"Privileges to insert data"},{label:"UPDATE",description:"Privileges to update data"},{label:"DELETE",description:"Privileges to delete data"},{label:"ALL",description:"All privileges (SELECT, INSERT, UPDATE, DELETE)"},{label:"LIST",description:"Privileges to list objects"}],{placeHolder:"Select privilege type"});if(!y)return;let C=await c.window.showInputBox({prompt:"Enter user or group name",placeHolder:"e.g. SOME_USER or GROUP_NAME",validateInput:S=>!S||S.trim().length===0?"User/group name cannot be empty":/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(S.trim())?null:"Invalid user/group name"});if(!C)return;let w=`GRANT ${y.label} ON ${g} TO ${C.trim().toUpperCase()};`;if(await c.window.showInformationMessage(`Execute: ${w}`,{modal:!0},"Yes, execute","Cancel")==="Yes, execute")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Granting ${y.label} on ${g}...`,cancellable:!1},async E=>{await x(l,w,!0)}),c.window.showInformationMessage(`Granted ${y.label} on ${g} to ${C.trim().toUpperCase()}`)}catch(S){c.window.showErrorMessage(`Error granting privileges: ${S.message}`)}}}),c.commands.registerCommand("netezza.groomTable",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType==="TABLE"){let g=`${d.dbName}.${d.schema}.${d.label}`,y=await c.window.showQuickPick([{label:"RECORDS ALL",description:"Groom all records (reclaim space from deleted rows)"},{label:"RECORDS READY",description:"Groom only ready records"},{label:"PAGES ALL",description:"Groom all pages (reorganize data pages)"},{label:"PAGES START",description:"Groom pages from start"},{label:"VERSIONS",description:"Groom versions (clean up old row versions)"}],{placeHolder:"Select GROOM mode"});if(!y)return;let C=await c.window.showQuickPick([{label:"DEFAULT",description:"Use default backupset",value:"DEFAULT"},{label:"NONE",description:"No backupset",value:"NONE"},{label:"Custom",description:"Specify custom backupset ID",value:"CUSTOM"}],{placeHolder:"Select RECLAIM BACKUPSET option"});if(!C)return;let w=C.value;if(C.value==="CUSTOM"){let E=await c.window.showInputBox({prompt:"Enter backupset ID",placeHolder:"np. 12345",validateInput:R=>!R||R.trim().length===0?"Backupset ID cannot be empty":/^\d+$/.test(R.trim())?null:"Backupset ID must be a number"});if(!E)return;w=E.trim()}let T=`GROOM TABLE ${g} ${y.label} RECLAIM BACKUPSET ${w};`;if(await c.window.showWarningMessage(`Execute GROOM on table "${g}"?

${T}

Warning: This operation may be time-consuming for large tables.`,{modal:!0},"Yes, execute","Cancel")==="Yes, execute")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}let R=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:`GROOM TABLE ${g} (${y.label})...`,cancellable:!1},async M=>{await x(l,T,!0)});let D=((Date.now()-R)/1e3).toFixed(1);c.window.showInformationMessage(`GROOM completed successfully (${D}s): ${g}`)}catch(E){c.window.showErrorMessage(`Error during GROOM: ${E.message}`)}}}),c.commands.registerCommand("netezza.addTableComment",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType==="TABLE"){let g=`${d.dbName}.${d.schema}.${d.label}`,y=await c.window.showInputBox({prompt:"Enter comment for table",placeHolder:"e.g. Table contains customer data",value:d.objectDescription||""});if(y===void 0)return;let C=`COMMENT ON TABLE ${g} IS '${y.replace(/'/g,"''")}';`;try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await x(l,C,!0),c.window.showInformationMessage(`Comment added to table: ${g}`),s.refresh()}catch(w){c.window.showErrorMessage(`Error adding comment: ${w.message}`)}}}),c.commands.registerCommand("netezza.generateStatistics",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType==="TABLE"){let g=`${d.dbName}.${d.schema}.${d.label}`,y=`GENERATE EXPRESS STATISTICS ON ${g};`;if(await c.window.showInformationMessage(`Generate statistics for table "${g}"?

${y}`,{modal:!0},"Yes, generate","Cancel")==="Yes, generate")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}let T=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Generating statistics for ${g}...`,cancellable:!1},async E=>{await x(l,y,!0)});let S=((Date.now()-T)/1e3).toFixed(1);c.window.showInformationMessage(`Statistics generated successfully (${S}s): ${g}`)}catch(w){c.window.showErrorMessage(`Error generating statistics: ${w.message}`)}}}),c.commands.registerCommand("netezza.truncateTable",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType==="TABLE"){let g=`${d.dbName}.${d.schema}.${d.label}`,y=`TRUNCATE TABLE ${g};`;if(await c.window.showWarningMessage(`\u26A0\uFE0F WARNING: Are you sure you want to delete ALL data from the table "${g}"?

${y}

This operation is IRREVERSIBLE!`,{modal:!0},"Yes, delete all data","Cancel")==="Yes, delete all data")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Clearing table ${g}...`,cancellable:!1},async T=>{await x(l,y,!0)}),c.window.showInformationMessage(`Table cleared: ${g}`)}catch(w){c.window.showErrorMessage(`Error clearing table: ${w.message}`)}}}),c.commands.registerCommand("netezza.addPrimaryKey",async d=>{if(d&&d.label&&d.dbName&&d.schema&&d.objType==="TABLE"){let g=`${d.dbName}.${d.schema}.${d.label}`,y=await c.window.showInputBox({prompt:"Enter primary key constraint name",placeHolder:`e.g. PK_${d.label}`,value:`PK_${d.label}`,validateInput:E=>!E||E.trim().length===0?"Constraint name cannot be empty":/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(E.trim())?null:"Invalid constraint name"});if(!y)return;let C=await c.window.showInputBox({prompt:"Enter primary key column names (comma separated)",placeHolder:"e.g. COL1, COL2 or ID",validateInput:E=>!E||E.trim().length===0?"You must provide at least one column":null});if(!C)return;let w=C.split(",").map(E=>E.trim().toUpperCase()).join(", "),T=`ALTER TABLE ${g} ADD CONSTRAINT ${y.trim().toUpperCase()} PRIMARY KEY (${w});`;if(await c.window.showInformationMessage(`Add primary key to table "${g}"?

${T}`,{modal:!0},"Yes, add","Cancel")==="Yes, add")try{if(!await e.getConnectionString()){c.window.showErrorMessage("No database connection");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Adding primary key to ${g}...`,cancellable:!1},async R=>{await x(l,T,!0)}),c.window.showInformationMessage(`Primary key added: ${y.trim().toUpperCase()}`),s.refresh()}catch(E){c.window.showErrorMessage(`Error adding primary key: ${E.message}`)}}}),c.commands.registerCommand("netezza.createDDL",async d=>{try{if(!d||!d.label||!d.dbName||!d.schema||!d.objType){c.window.showErrorMessage("Invalid object selected for DDL generation");return}let g=await e.getConnectionString();if(!g){c.window.showErrorMessage("Connection not configured. Please connect via Netezza: Connect...");return}await c.window.withProgress({location:c.ProgressLocation.Notification,title:`Generating DDL for ${d.objType} ${d.label}...`,cancellable:!1},async()=>{let{generateDDL:y}=await Promise.resolve().then(()=>(pt(),ut)),C=await y(g,d.dbName,d.schema,d.label,d.objType);if(C.success&&C.ddlCode){let w=await c.window.showQuickPick([{label:"Open in Editor",description:"Open DDL code in a new editor",value:"editor"},{label:"Copy to Clipboard",description:"Copy DDL code to clipboard",value:"clipboard"}],{placeHolder:"How would you like to access the DDL code?"});if(w)if(w.value==="editor"){let T=await c.workspace.openTextDocument({content:C.ddlCode,language:"sql"});await c.window.showTextDocument(T),c.window.showInformationMessage(`DDL code generated for ${d.objType} ${d.label}`)}else w.value==="clipboard"&&(await c.env.clipboard.writeText(C.ddlCode),c.window.showInformationMessage("DDL code copied to clipboard"))}else throw new Error(C.error||"DDL generation failed")})}catch(g){c.window.showErrorMessage(`Error generating DDL: ${g.message}`)}}),c.commands.registerCommand("netezza.revealInSchema",async d=>{let g=c.window.setStatusBarMessage(`$(loading~spin) Revealing ${d.name} in schema...`);try{if(!await e.getConnectionString()){g.dispose(),c.window.showWarningMessage("Not connected to database");return}let C=d.name,w=d.objType,T=w?[w]:["TABLE","VIEW","EXTERNAL TABLE","PROCEDURE","FUNCTION","SEQUENCE","SYNONYM"];if(w==="COLUMN"){if(!d.parent){g.dispose(),c.window.showWarningMessage("Cannot find column without parent table");return}C=d.parent}let S=[];if(d.database)S=[d.database];else{let E=await e.getCurrentDatabase();if(E)S=[E];else{let R=await x(l,"SELECT DATABASE FROM system.._v_database ORDER BY DATABASE",!0);if(!R){g.dispose();return}S=JSON.parse(R).map(M=>M.DATABASE)}}for(let E of S)try{let R=w==="COLUMN"?["TABLE","VIEW","EXTERNAL TABLE"]:T;for(let D of R){let M=`SELECT OBJNAME, OBJTYPE, SCHEMA, OBJID FROM ${E}.._V_OBJECT_DATA WHERE UPPER(OBJNAME) = UPPER('${C.replace(/'/g,"''")}') AND UPPER(OBJTYPE) = UPPER('${D}') AND DBNAME = '${E}'`;d.schema&&(M+=` AND UPPER(SCHEMA) = UPPER('${d.schema.replace(/'/g,"''")}')`);let B=await x(l,M,!0);if(B){let k=JSON.parse(B);if(k.length>0){let z=k[0],{SchemaItem:Y}=await Promise.resolve().then(()=>(We(),ct)),Z=new Y(z.OBJNAME,c.TreeItemCollapsibleState.Collapsed,`netezza:${z.OBJTYPE}`,E,z.OBJTYPE,z.SCHEMA,z.OBJID);await r.reveal(Z,{select:!0,focus:!0,expand:!0}),g.dispose(),c.window.setStatusBarMessage(`$(check) Found ${C} in ${E}.${z.SCHEMA}`,3e3);return}}}}catch(R){console.log(`Error searching in ${E}:`,R)}g.dispose(),c.window.showWarningMessage(`Could not find ${w||"object"} ${C}`)}catch(y){g.dispose(),c.window.showErrorMessage(`Error revealing item: ${y.message}`)}}),c.commands.registerCommand("netezza.showQueryHistory",()=>{c.commands.executeCommand("netezza.queryHistory.focus")}),c.commands.registerCommand("netezza.clearQueryHistory",async()=>{let{QueryHistoryManager:d}=await Promise.resolve().then(()=>(Ie(),et)),g=new d(l);await c.window.showWarningMessage("Are you sure you want to clear all query history?",{modal:!0},"Clear All")==="Clear All"&&(await g.clearHistory(),o.refresh(),c.window.showInformationMessage("Query history cleared"))})),l.subscriptions.push(c.languages.registerDocumentLinkProvider({language:"sql"},new $e)),l.subscriptions.push(c.languages.registerFoldingRangeProvider({language:"sql"},new Le)),l.subscriptions.push(c.commands.registerCommand("netezza.jumpToSchema",async()=>{let d=c.window.activeTextEditor;if(!d)return;let g=d.document,y=d.selection,C=g.offsetAt(y.active),w=oe.getObjectAtPosition(g.getText(),C);w?c.commands.executeCommand("netezza.revealInSchema",w):c.window.showWarningMessage("No object found at cursor")}));let N=c.commands.registerCommand("netezza.runQuery",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.document,y=d.selection,C=g.getText(),w=g.uri.toString(),T=[];if(y.isEmpty){let E=g.offsetAt(y.active),R=oe.getStatementAtPosition(C,E);if(R){T=[R.sql];let D=g.positionAt(R.start),M=g.positionAt(R.end);d.selection=new c.Selection(D,M)}else{c.window.showWarningMessage("No SQL statement found at cursor");return}}else{let E=g.getText(y);if(!E.trim()){c.window.showWarningMessage("No SQL query selected");return}T=oe.splitStatements(E)}if(T.length===0)return;let S=T.length===1?T[0].trim():null;if(S){let E=S.split(/\s+/),R=E[0]||"",D=/python(\.exe)?$/i.test(R)&&E.length>=2&&E[1].toLowerCase().endsWith(".py"),M=R.toLowerCase().endsWith(".py");if(D||M){let k=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",z="";if(D){let Z=E[0],fe=E[1],bt=E.slice(2);z=h(Z,fe,bt)}else{let Z=R,fe=E.slice(1);z=h(k,Z,fe)}let Y=c.window.createTerminal({name:"Netezza: Script"});Y.show(!0),Y.sendText(z,!0),c.window.showInformationMessage(`Running script: ${z}`);return}}try{let E=await Xe(l,T,e);n.updateResults(E,w,!1),c.commands.executeCommand("netezza.results.focus")}catch(E){c.window.showErrorMessage(`Error executing query: ${E.message}`)}}),L=c.commands.registerCommand("netezza.runQueryBatch",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.document,y=d.selection,C=g.uri.toString(),w;if(y.isEmpty?w=g.getText():w=g.getText(y),!w.trim()){c.window.showWarningMessage("No SQL query to execute");return}let S=w.trim().split(/\s+/),E=S[0]||"",R=/python(\.exe)?$/i.test(E)&&S.length>=2&&S[1].toLowerCase().endsWith(".py"),D=E.toLowerCase().endsWith(".py");if(R||D){let B=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",k="";if(R){let Y=S[0],Z=S[1],fe=S.slice(2);k=h(Y,Z,fe)}else{let Y=E,Z=S.slice(1);k=h(B,Y,Z)}let z=c.window.createTerminal({name:"Netezza: Script"});z.show(!0),z.sendText(k,!0),c.window.showInformationMessage(`Running script: ${k}`);return}try{let{runQueryRaw:M}=await Promise.resolve().then(()=>(pe(),at)),B=await M(l,w,!1,e);B&&(n.updateResults([B],C,!1),c.commands.executeCommand("netezza.results.focus"))}catch(M){c.window.showErrorMessage(`Error executing query: ${M.message}`)}});l.subscriptions.push(L);let A=c.window.createOutputChannel("Netezza"),I=(d,g)=>{let y=Date.now()-g;A.appendLine(`[${new Date().toLocaleTimeString()}] ${d} completed in ${y}ms`),A.show(!0)},_=c.commands.registerCommand("netezza.exportToXlsb",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.selection,y=g.isEmpty?d.document.getText():d.document.getText(g);if(!y.trim()){c.window.showWarningMessage("No SQL query to export");return}let C=await c.window.showSaveDialog({filters:{"Excel Workbook":["xlsx"]},saveLabel:"Export to XLSX"});if(!C)return;let w=Date.now();try{let T=await e.getConnectionString();if(!T)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSX...",cancellable:!1},async S=>{let{exportQueryToXlsb:E}=await Promise.resolve().then(()=>(be(),Te)),R=await E(T,y,C.fsPath,!1,D=>{S.report({message:D}),A.appendLine(`[XLSX Export] ${D}`)});if(!R.success)throw new Error(R.message)}),I("Export to XLSX",w),c.window.showInformationMessage(`Results exported to ${C.fsPath}`)}catch(T){c.window.showErrorMessage(`Error exporting to XLSX: ${T.message}`)}}),F=c.commands.registerCommand("netezza.exportToCsv",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.selection,y=g.isEmpty?d.document.getText():d.document.getText(g);if(!y.trim()){c.window.showWarningMessage("No SQL query to export");return}let C=await c.window.showSaveDialog({filters:{"CSV Files":["csv"]},saveLabel:"Export to CSV"});if(!C)return;let w=Date.now();try{let T=await e.getConnectionString();if(!T)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to CSV...",cancellable:!1},async S=>{let{exportToCsv:E}=await Promise.resolve().then(()=>(ft(),gt));await E(l,T,y,C.fsPath,S)}),I("Export to CSV",w),c.window.showInformationMessage(`Results exported to ${C.fsPath}`)}catch(T){c.window.showErrorMessage(`Error exporting to CSV: ${T.message}`)}}),ie=c.commands.registerCommand("netezza.copyXlsbToClipboard",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.selection,y=g.isEmpty?d.document.getText():d.document.getText(g);if(!y.trim()){c.window.showWarningMessage("No SQL query to export");return}try{let C=await e.getConnectionString();if(!C)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let w=Date.now();if(await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSX and copying to clipboard...",cancellable:!1},async S=>{let{exportQueryToXlsb:E,getTempFilePath:R}=await Promise.resolve().then(()=>(be(),Te)),D=R(),M=await E(C,y,D,!0,B=>{S.report({message:B}),A.appendLine(`[XLSX Clipboard] ${B}`)});if(!M.success)throw new Error(M.message);if(!M.details?.clipboard_success)throw new Error("Failed to copy file to clipboard")}),I("Copy XLSX to Clipboard",w),await c.window.showInformationMessage("Excel file copied to clipboard! You can now paste it into Excel or Windows Explorer.","Show Temp Folder","OK")==="Show Temp Folder"){let S=require("os").tmpdir();await c.env.openExternal(c.Uri.file(S))}}catch(C){c.window.showErrorMessage(`Error copying XLSX to clipboard: ${C.message}`)}}),G=c.commands.registerCommand("netezza.exportToXlsbAndOpen",async()=>{let d=c.window.activeTextEditor;if(!d){c.window.showErrorMessage("No active editor found");return}let g=d.selection,y=g.isEmpty?d.document.getText():d.document.getText(g);if(!y.trim()){c.window.showWarningMessage("No SQL query to export");return}let C=await c.window.showSaveDialog({filters:{"Excel Workbook":["xlsx"]},saveLabel:"Export to XLSX and Open"});if(!C)return;let w=Date.now();try{let T=await e.getConnectionString();if(!T)throw new Error("Connection not configured. Please connect via Netezza: Connect...");await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Exporting to XLSX and opening...",cancellable:!1},async S=>{let{exportQueryToXlsb:E}=await Promise.resolve().then(()=>(be(),Te)),R=await E(T,y,C.fsPath,!1,D=>{S.report({message:D}),A.appendLine(`[XLSX Export] ${D}`)});if(!R.success)throw new Error(R.message)}),I("Export to XLSX and Open",w),await c.env.openExternal(C),c.window.showInformationMessage(`Results exported and opened: ${C.fsPath}`)}catch(T){c.window.showErrorMessage(`Error exporting to XLSX: ${T.message}`)}}),j=c.commands.registerCommand("netezza.importClipboard",async()=>{try{let d=await e.getConnectionString();if(!d)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let g=await c.window.showInputBox({prompt:"Enter target table name (leave empty for auto-generated name)",placeHolder:"e.g. my_schema.my_table or leave empty",validateInput:T=>!T||T.trim().length===0||/^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)?(\.[a-zA-Z_][a-zA-Z0-9_]*)?$/.test(T.trim())?null:"Invalid table name format. Use: [database.]schema.table"});if(g===void 0)return;let y;if(!g||g.trim().length===0)try{let S=await x(l,"SELECT CURRENT_CATALOG, CURRENT_SCHEMA",!0);if(S){let E=JSON.parse(S);if(E&&E.length>0){let R=E[0].CURRENT_CATALOG||"SYSTEM",D=E[0].CURRENT_SCHEMA||"ADMIN",B=new Date().toISOString().slice(0,10).replace(/-/g,""),k=Math.floor(Math.random()*1e4).toString().padStart(4,"0");y=`${R}.${D}.IMPORT_${B}_${k}`,c.window.showInformationMessage(`Auto-generated table name: ${y}`)}else throw new Error("Could not determine current database/schema")}else throw new Error("Could not determine current database/schema")}catch(T){c.window.showErrorMessage(`Error getting current database/schema: ${T.message}`);return}else y=g.trim();let C=await c.window.showQuickPick([{label:"Auto-detect",description:"Automatically detect clipboard format (text or Excel XML)",value:null},{label:"Excel XML Spreadsheet",description:"Force Excel XML format processing",value:"XML Spreadsheet"},{label:"Plain Text",description:"Force plain text processing with delimiter detection",value:"TEXT"}],{placeHolder:"Select clipboard data format"});if(!C)return;let w=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Importing clipboard data...",cancellable:!1},async T=>{let{importClipboardDataToNetezza:S}=await Promise.resolve().then(()=>(yt(),vt)),E=await S(y,d,C.value,{},R=>{T.report({message:R}),A.appendLine(`[Clipboard Import] ${R}`)});if(!E.success)throw new Error(E.message);E.details&&(A.appendLine(`[Clipboard Import] Rows processed: ${E.details.rowsProcessed}`),A.appendLine(`[Clipboard Import] Columns: ${E.details.columns}`),A.appendLine(`[Clipboard Import] Format: ${E.details.format}`))}),I("Import Clipboard Data",w),c.window.showInformationMessage(`Clipboard data imported successfully to table: ${y}`)}catch(d){c.window.showErrorMessage(`Error importing clipboard data: ${d.message}`)}}),ae=c.commands.registerCommand("netezza.importData",async()=>{try{let d=await e.getConnectionString();if(!d)throw new Error("Connection not configured. Please connect via Netezza: Connect...");let g=await c.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{"Data Files":["csv","txt","xlsx","xlsb","json"],"CSV Files":["csv"],"Excel Files":["xlsx","xlsb"],"Text Files":["txt"],"JSON Files":["json"],"All Files":["*"]},openLabel:"Select file to import"});if(!g||g.length===0)return;let y=g[0].fsPath,C=await c.window.showInputBox({prompt:"Enter target table name (leave empty for auto-generated name)",placeHolder:"e.g. my_schema.my_table or leave empty",validateInput:E=>!E||E.trim().length===0||/^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)?(\.[a-zA-Z_][a-zA-Z0-9_]*)?$/.test(E.trim())?null:"Invalid table name format. Use: [database.]schema.table"});if(C===void 0)return;let w;if(!C||C.trim().length===0)try{let R=await x(l,"SELECT CURRENT_CATALOG, CURRENT_SCHEMA",!0);if(R){let D=JSON.parse(R);if(D&&D.length>0){let M=D[0].CURRENT_CATALOG||"SYSTEM",B=D[0].CURRENT_SCHEMA||"ADMIN",z=new Date().toISOString().slice(0,10).replace(/-/g,""),Y=Math.floor(Math.random()*1e4).toString().padStart(4,"0");w=`${M}.${B}.IMPORT_${z}_${Y}`,c.window.showInformationMessage(`Auto-generated table name: ${w}`)}else throw new Error("Could not determine current database/schema")}else throw new Error("Could not determine current database/schema")}catch(E){c.window.showErrorMessage(`Error getting current database/schema: ${E.message}`);return}else w=C.trim();let T=await c.window.showQuickPick([{label:"Default Import",description:"Use default settings",value:{}},{label:"Custom Options",description:"Configure import settings (coming soon)",value:null}],{placeHolder:"Select import options"});if(!T)return;if(T.value===null){c.window.showInformationMessage("Custom options will be available in future version");return}let S=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Importing data...",cancellable:!1},async E=>{let{importDataToNetezza:R}=await Promise.resolve().then(()=>(Qe(),Et)),D=await R(y,w,d,T.value||{},M=>{E.report({message:M}),A.appendLine(`[Import] ${M}`)});if(!D.success)throw new Error(D.message);D.details&&(A.appendLine(`[Import] Rows processed: ${D.details.rowsProcessed}`),A.appendLine(`[Import] Columns: ${D.details.columns}`),A.appendLine(`[Import] Delimiter: ${D.details.detectedDelimiter}`))}),I("Import Data",S),c.window.showInformationMessage(`Data imported successfully to table: ${w}`)}catch(d){c.window.showErrorMessage(`Error importing data: ${d.message}`)}}),ze=c.commands.registerCommand("netezza.exportCurrentResultToXlsbAndOpen",async d=>{try{if(!d){c.window.showErrorMessage("No data to export");return}let g=require("os"),y=require("path"),C=new Date().toISOString().replace(/[:.]/g,"-"),w=y.join(g.tmpdir(),`netezza_results_${C}.xlsx`),T=Date.now();await c.window.withProgress({location:c.ProgressLocation.Notification,title:"Creating Excel file...",cancellable:!1},async E=>{let{exportCsvToXlsb:R}=await Promise.resolve().then(()=>(be(),Te)),D=await R(d,w,!1,{source:"Query Results Panel"},M=>{E.report({message:M}),A.appendLine(`[CSV to XLSX] ${M}`)});if(!D.success)throw new Error(D.message)});let S=Date.now()-T;A.appendLine(`[${new Date().toLocaleTimeString()}] Export Current Result to Excel completed in ${S}ms`),await c.env.openExternal(c.Uri.file(w)),c.window.showInformationMessage(`Results exported and opened: ${w}`)}catch(g){c.window.showErrorMessage(`Error exporting to Excel: ${g.message}`)}});l.subscriptions.push(N),l.subscriptions.push(_),l.subscriptions.push(F),l.subscriptions.push(ie),l.subscriptions.push(G),l.subscriptions.push(ze),l.subscriptions.push(j),l.subscriptions.push(ae);let H=c.workspace.onWillSaveTextDocument(async d=>{}),ce=c.commands.registerCommand("netezza.smartPaste",async()=>{try{let d=c.window.activeTextEditor;if(!d)return;let y=c.workspace.getConfiguration("netezza").get("pythonPath")||"python",C=Tt.join(l.extensionPath,"python","check_clipboard_format.py"),w=require("child_process");if(await new Promise(S=>{let E=w.spawn(y,[C]);E.on("close",R=>{S(R===1)}),E.on("error",()=>{S(!1)})})){let S=await c.window.showQuickPick([{label:"\u{1F4CA} import to Netezza table",description:'Detected "XML Spreadsheet" format - import data to database',value:"import"},{label:"\u{1F4DD} Paste as text",description:"Paste clipboard content as plain text",value:"paste"}],{placeHolder:'Detected "XML Spreadsheet" format in clipboard - choose an action'});if(S?.value==="import")c.commands.executeCommand("netezza.importClipboard");else if(S?.value==="paste"){let E=await c.env.clipboard.readText(),R=d.selection;await d.edit(D=>{D.replace(R,E)})}}else{let S=await c.env.clipboard.readText(),E=d.selection;await d.edit(R=>{R.replace(E,S)})}}catch(d){c.window.showErrorMessage(`Error during paste: ${d.message}`)}}),Q=c.workspace.onDidChangeTextDocument(async d=>{if(d.document.languageId!=="sql"&&d.document.languageId!=="mssql"||d.contentChanges.length!==1)return;let g=d.contentChanges[0];if(g.text!==" ")return;let y=c.window.activeTextEditor;if(!y||y.document!==d.document)return;let w=d.document.lineAt(g.range.start.line).text,T=new Map([["SX","SELECT"],["WX","WHERE"],["GX","GROUP BY"],["HX","HAVING"],["OX","ORDER BY"],["FX","FROM"],["JX","JOIN"],["LX","LIMIT"],["IX","INSERT INTO"],["UX","UPDATE"],["DX","DELETE FROM"],["CX","CREATE TABLE"]]);for(let[S,E]of T)if(new RegExp(`\\b${S}\\s$`,"i").test(w)){let D=w.toUpperCase().lastIndexOf(S.toUpperCase());if(D>=0){let M=new c.Position(g.range.start.line,D),B=new c.Position(g.range.start.line,D+S.length+1);await y.edit(k=>{k.replace(new c.Range(M,B),E+" ")}),["SELECT","FROM","JOIN"].includes(E)&&setTimeout(()=>{c.commands.executeCommand("editor.action.triggerSuggest")},100);break}}});l.subscriptions.push(ce),l.subscriptions.push(Q);let Fe=new Me(l,t);l.subscriptions.push(c.languages.registerCompletionItemProvider(["sql","mssql"],Fe,"."," ")),l.subscriptions.push(c.commands.registerCommand("netezza.clearAutocompleteCache",async()=>{await c.window.showWarningMessage("Are you sure you want to clear the autocomplete cache? This will remove all cached databases, schemas, tables, and columns.",{modal:!0},"Clear Cache")==="Clear Cache"&&(await t.clearCache(),c.window.showInformationMessage("Autocomplete cache cleared successfully. Cache will be rebuilt on next use."))}))}function Kt(){}0&&(module.exports={activate,deactivate});
